<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="robots" content="noindex,noarchive">
	<meta name="generator" content="Nette Tester">

	<title>Code coverage</title>

	<style type="text/css">
	html {
		font: 14px/1.5 Verdana,"Geneva CE",lucida,sans-serif;
		border-top: 4.7em solid #f4ebdb;
	}

	body {
		max-width: 990px;
		margin: -4.7em auto 0;
		background: #fcfaf5;
		color: #333;
	}

	footer {
		margin-left: .5em;
	}

	h1 {
		font-family: "Trebuchet MS","Geneva CE",lucida,sans-serif;
		font-size: 1.9em;
		margin: .5em .5em 1.5em;
		color: #7a7772;
		text-shadow: 1px 1px 0 white;
	}

	div.code {
		background: white;
		border: 1px dotted silver;
		padding: .4em 0;
		display: none;
		color: #333;
		overflow: auto;
	}

	code,
	div.code {
		font: 13px/1.3 monospace;
	}

	div.code > div {
		float: left;
		min-width: 100%;
		position: relative;
	}

	aside {
		min-width: 100%;
		position: absolute;
	}

	aside div {
		white-space: pre;
		padding-left: .7em;
	}

	aside a {
		color: #c0c0c0;
	}

	aside a:hover {
		color: inherit;
		font-weight: bold;
		text-decoration: none;
	}

	code {
		display: block;
		white-space: nowrap;
		position: relative;
	}

	a {
		color: #006aeb;
		text-decoration: none;
	}

	a:active,
	a:hover {
		text-decoration: underline;
	}

	td {
		vertical-align: middle;
	}

	small {
		color: gray;
	}

	.number {
		text-align: right;
		width: 50px;
	}

	.bar {
		border: 1px solid #acacac;
		background: #e50400;
		width: 35px;
		height: 1em;
	}

	.bar div {
		background: #1a7e1e;
		height: 1em;
	}

	.light td {
		opacity: .5;
	}

	.light td * {
		color: gray;
	}

	.not-loaded td * {
		color: red;
	}

	.t { background-color: #e0ffe0; }
	.u { background-color: #ffe0e0; }

	code .hc { color: #929292; }
	code .hd { color: #333; }
	code .hh { color: #06B; }
	code .hk { color: #e71818; }
	code .hs { color: #008000; }
	</style>
</head>

<body>
	<h1>Code coverage 100&nbsp;%</h1>

		<div>
		<table>
		<tr>
			<td class="number"><small>100 %</small></td>
			<td><div class="bar"><div style="width: 100%"></div></div></td>
			<td><a href="#F0" class="toggle">ImageStore/Directory/Directory.php</a></td>
		</tr>
		</table>

		<div class="code" id="F0">
		<div>
			<aside>
			<div><a href='#F0L1' id='F0L1'>  1</a>
<a href='#F0L2' id='F0L2'>  2</a>
<a href='#F0L3' id='F0L3'>  3</a>
<a href='#F0L4' id='F0L4'>  4</a>
<a href='#F0L5' id='F0L5'>  5</a>
<a href='#F0L6' id='F0L6'>  6</a>
<a href='#F0L7' id='F0L7'>  7</a>
<a href='#F0L8' id='F0L8'>  8</a>
<a href='#F0L9' id='F0L9'>  9</a>
<a href='#F0L10' id='F0L10'> 10</a>
<a href='#F0L11' id='F0L11'> 11</a>
<a href='#F0L12' id='F0L12'> 12</a></div><div class='t'><a href='#F0L13' id='F0L13'> 13</a></div><div><a href='#F0L14' id='F0L14'> 14</a>
<a href='#F0L15' id='F0L15'> 15</a>
<a href='#F0L16' id='F0L16'> 16</a>
<a href='#F0L17' id='F0L17'> 17</a>
<a href='#F0L18' id='F0L18'> 18</a>
<a href='#F0L19' id='F0L19'> 19</a>
<a href='#F0L20' id='F0L20'> 20</a>
<a href='#F0L21' id='F0L21'> 21</a>
<a href='#F0L22' id='F0L22'> 22</a>
<a href='#F0L23' id='F0L23'> 23</a>
<a href='#F0L24' id='F0L24'> 24</a>
<a href='#F0L25' id='F0L25'> 25</a>
<a href='#F0L26' id='F0L26'> 26</a></div><div class='t'><a href='#F0L27' id='F0L27'> 27</a>
<a href='#F0L28' id='F0L28'> 28</a></div><div><a href='#F0L29' id='F0L29'> 29</a>
<a href='#F0L30' id='F0L30'> 30</a>
<a href='#F0L31' id='F0L31'> 31</a>
<a href='#F0L32' id='F0L32'> 32</a>
<a href='#F0L33' id='F0L33'> 33</a>
<a href='#F0L34' id='F0L34'> 34</a>
<a href='#F0L35' id='F0L35'> 35</a>
<a href='#F0L36' id='F0L36'> 36</a>
<a href='#F0L37' id='F0L37'> 37</a>
<a href='#F0L38' id='F0L38'> 38</a>
<a href='#F0L39' id='F0L39'> 39</a>
<a href='#F0L40' id='F0L40'> 40</a></div><div class='t'><a href='#F0L41' id='F0L41'> 41</a>
<a href='#F0L42' id='F0L42'> 42</a></div><div><a href='#F0L43' id='F0L43'> 43</a></div><div class='t'><a href='#F0L44' id='F0L44'> 44</a>
<a href='#F0L45' id='F0L45'> 45</a>
<a href='#F0L46' id='F0L46'> 46</a>
<a href='#F0L47' id='F0L47'> 47</a>
<a href='#F0L48' id='F0L48'> 48</a>
<a href='#F0L49' id='F0L49'> 49</a>
<a href='#F0L50' id='F0L50'> 50</a>
<a href='#F0L51' id='F0L51'> 51</a>
<a href='#F0L52' id='F0L52'> 52</a>
<a href='#F0L53' id='F0L53'> 53</a></div><div><a href='#F0L54' id='F0L54'> 54</a></div><div class='t'><a href='#F0L55' id='F0L55'> 55</a>
<a href='#F0L56' id='F0L56'> 56</a></div><div class='dead'><a href='#F0L57' id='F0L57'> 57</a></div><div><a href='#F0L58' id='F0L58'> 58</a></div><div class='t'><a href='#F0L59' id='F0L59'> 59</a></div><div class='dead'><a href='#F0L60' id='F0L60'> 60</a></div><div><a href='#F0L61' id='F0L61'> 61</a>
<a href='#F0L62' id='F0L62'> 62</a>
<a href='#F0L63' id='F0L63'> 63</a>
<a href='#F0L64' id='F0L64'> 64</a>
<a href='#F0L65' id='F0L65'> 65</a>
<a href='#F0L66' id='F0L66'> 66</a>
<a href='#F0L67' id='F0L67'> 67</a></div><div class='t'><a href='#F0L68' id='F0L68'> 68</a></div><div class='dead'><a href='#F0L69' id='F0L69'> 69</a></div><div><a href='#F0L70' id='F0L70'> 70</a>
<a href='#F0L71' id='F0L71'> 71</a>
<a href='#F0L72' id='F0L72'> 72</a>
<a href='#F0L73' id='F0L73'> 73</a>
<a href='#F0L74' id='F0L74'> 74</a>
<a href='#F0L75' id='F0L75'> 75</a>
<a href='#F0L76' id='F0L76'> 76</a>
<a href='#F0L77' id='F0L77'> 77</a>
<a href='#F0L78' id='F0L78'> 78</a></div><div class='t'><a href='#F0L79' id='F0L79'> 79</a></div><div><a href='#F0L80' id='F0L80'> 80</a></div><div class='t'><a href='#F0L81' id='F0L81'> 81</a></div><div class='dead'><a href='#F0L82' id='F0L82'> 82</a></div><div><a href='#F0L83' id='F0L83'> 83</a>
<a href='#F0L84' id='F0L84'> 84</a>
<a href='#F0L85' id='F0L85'> 85</a>
<a href='#F0L86' id='F0L86'> 86</a>
<a href='#F0L87' id='F0L87'> 87</a>
<a href='#F0L88' id='F0L88'> 88</a>
<a href='#F0L89' id='F0L89'> 89</a>
<a href='#F0L90' id='F0L90'> 90</a>
<a href='#F0L91' id='F0L91'> 91</a></div><div class='t'><a href='#F0L92' id='F0L92'> 92</a></div><div><a href='#F0L93' id='F0L93'> 93</a></div><div class='t'><a href='#F0L94' id='F0L94'> 94</a></div><div class='dead'><a href='#F0L95' id='F0L95'> 95</a></div><div><a href='#F0L96' id='F0L96'> 96</a>
<a href='#F0L97' id='F0L97'> 97</a>
</div>			</aside>
			<code style='margin-left: 3em'><span class="hh">
<span class="hd">&lt;?php<br /><br /></span><span class="hk">namespace&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Directory</span><span class="hk">;<br /><br /><br />use&nbsp;</span><span class="hd">Nette</span><span class="hk">\</span><span class="hd">Object</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Directory</span><span class="hk">\</span><span class="hd">Exceptions</span><span class="hk">\</span><span class="hd">DirectoryException</span><span class="hk">;<br /><br /></span><span class="hc">/**<br />&nbsp;*&nbsp;Directory&nbsp;wrapper<br />&nbsp;*/<br /></span><span class="hk">class&nbsp;</span><span class="hd">Directory&nbsp;</span><span class="hk">extends&nbsp;</span><span class="hd">Object<br /></span><span class="hk">{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;</span><span class="hd">$name</span><span class="hk">;<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;&nbsp;$name<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;boolean&nbsp;$tryCreateDirectories<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">__construct</span><span class="hk">(</span><span class="hd">$name</span><span class="hk">,&nbsp;</span><span class="hd">$tryCreateDirectories&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">TRUE</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">name&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">check</span><span class="hk">(</span><span class="hd">$name</span><span class="hk">,&nbsp;</span><span class="hd">$tryCreateDirectories</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Checks&nbsp;a&nbsp;directory&nbsp;to&nbsp;be&nbsp;existing&nbsp;and&nbsp;writable.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Tries&nbsp;to&nbsp;create&nbsp;it&nbsp;if&nbsp;it&nbsp;does&nbsp;not&nbsp;exist.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;&nbsp;$name&nbsp;Directory&nbsp;name<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;boolean&nbsp;$tryCreateDirectories<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string&nbsp;Existing&nbsp;and&nbsp;writable&nbsp;directory&nbsp;name<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;function&nbsp;</span><span class="hd">check</span><span class="hk">(</span><span class="hd">$name</span><span class="hk">,&nbsp;</span><span class="hd">$tryCreateDirectories&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">TRUE</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$exists&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">TRUE</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$isWritable&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">TRUE</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span class="hd">file_exists</span><span class="hk">(</span><span class="hd">$name</span><span class="hk">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$exists&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">FALSE</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span class="hd">$tryCreateDirectories</span><span class="hk">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">umask</span><span class="hk">(</span><span class="hd">0002</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$exists&nbsp;</span><span class="hk">=&nbsp;@</span><span class="hd">mkdir</span><span class="hk">(</span><span class="hd">$name</span><span class="hk">,&nbsp;</span><span class="hd">0750</span><span class="hk">,&nbsp;</span><span class="hd">TRUE</span><span class="hk">);&nbsp;</span><span class="hc">//&nbsp;@:&nbsp;will&nbsp;be&nbsp;escalated&nbsp;to&nbsp;exception&nbsp;on&nbsp;failure<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span class="hd">is_writable</span><span class="hk">(</span><span class="hd">$name</span><span class="hk">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$isWritable&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">FALSE</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span class="hd">$exists&nbsp;</span><span class="hk">||&nbsp;!</span><span class="hd">$isWritable</span><span class="hk">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span class="hd">DirectoryException</span><span class="hk">(</span><span class="hd">$name</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$name</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">__toString</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(string)&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">name</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Erases&nbsp;the&nbsp;directory.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;Directory&nbsp;Fluent&nbsp;interface.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">erase</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">exec</span><span class="hk">(</span><span class="hd">sprintf</span><span class="hk">(</span><span class="hs">"rm&nbsp;-rf&nbsp;%s"</span><span class="hk">,&nbsp;</span><span class="hd">escapeshellarg</span><span class="hk">(</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">name</span><span class="hk">)&nbsp;.&nbsp;</span><span class="hs">"/*"</span><span class="hk">));<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Removes&nbsp;the&nbsp;directory.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;Directory&nbsp;Fluent&nbsp;interface.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">remove</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">exec</span><span class="hk">(</span><span class="hd">sprintf</span><span class="hk">(</span><span class="hs">"rm&nbsp;-rf&nbsp;%s"</span><span class="hk">,&nbsp;</span><span class="hd">escapeshellarg</span><span class="hk">(</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">name</span><span class="hk">)));<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />}<br /></span>
</span>
</code>		</div>
		</div>
	</div>
		<div>
		<table>
		<tr class='light'>
			<td class="number"><small>100 %</small></td>
			<td><div class="bar"><div style="width: 100%"></div></div></td>
			<td><a href="#F1" class="toggle">ImageStore/Directory/Exceptions/DirectoryException.php</a></td>
		</tr>
		</table>

		<div class="code" id="F1">
		<div>
			<aside>
			<div><a href='#F1L1' id='F1L1'>  1</a>
<a href='#F1L2' id='F1L2'>  2</a>
<a href='#F1L3' id='F1L3'>  3</a>
<a href='#F1L4' id='F1L4'>  4</a>
<a href='#F1L5' id='F1L5'>  5</a>
<a href='#F1L6' id='F1L6'>  6</a>
<a href='#F1L7' id='F1L7'>  7</a>
<a href='#F1L8' id='F1L8'>  8</a>
<a href='#F1L9' id='F1L9'>  9</a>
<a href='#F1L10' id='F1L10'> 10</a>
<a href='#F1L11' id='F1L11'> 11</a></div><div class='t'><a href='#F1L12' id='F1L12'> 12</a></div><div><a href='#F1L13' id='F1L13'> 13</a>
<a href='#F1L14' id='F1L14'> 14</a>
<a href='#F1L15' id='F1L15'> 15</a>
<a href='#F1L16' id='F1L16'> 16</a>
<a href='#F1L17' id='F1L17'> 17</a>
<a href='#F1L18' id='F1L18'> 18</a>
<a href='#F1L19' id='F1L19'> 19</a></div><div class='t'><a href='#F1L20' id='F1L20'> 20</a>
<a href='#F1L21' id='F1L21'> 21</a></div><div><a href='#F1L22' id='F1L22'> 22</a>
<a href='#F1L23' id='F1L23'> 23</a>
</div>			</aside>
			<code style='margin-left: 3em'><span class="hh">
<span class="hd">&lt;?php<br /><br /></span><span class="hk">namespace&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Directory</span><span class="hk">\</span><span class="hd">Exceptions</span><span class="hk">;<br /><br /><br />use&nbsp;</span><span class="hd">InvalidArgumentException</span><span class="hk">;<br /><br /></span><span class="hc">/**<br />&nbsp;*&nbsp;Directory&nbsp;exception<br />&nbsp;*/<br /></span><span class="hk">class&nbsp;</span><span class="hd">DirectoryException&nbsp;</span><span class="hk">extends&nbsp;</span><span class="hd">InvalidArgumentException<br /></span><span class="hk">{<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;$directory<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">__construct</span><span class="hk">(</span><span class="hd">$directory</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">parent</span><span class="hk">::</span><span class="hd">__construct</span><span class="hk">(</span><span class="hd">sprintf</span><span class="hk">(</span><span class="hs">'Directory&nbsp;"%s"&nbsp;does&nbsp;not&nbsp;exist&nbsp;and&nbsp;cannot&nbsp;be&nbsp;created&nbsp;or&nbsp;it&nbsp;is&nbsp;not&nbsp;writable.'</span><span class="hk">,&nbsp;</span><span class="hd">var_export</span><span class="hk">(</span><span class="hd">$directory</span><span class="hk">,&nbsp;</span><span class="hd">TRUE</span><span class="hk">)));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />}<br /></span>
</span>
</code>		</div>
		</div>
	</div>
		<div>
		<table>
		<tr class='light'>
			<td class="number"><small>100 %</small></td>
			<td><div class="bar"><div style="width: 100%"></div></div></td>
			<td><a href="#F2" class="toggle">ImageStore/Meta.php</a></td>
		</tr>
		</table>

		<div class="code" id="F2">
		<div>
			<aside>
			<div><a href='#F2L1' id='F2L1'>  1</a>
<a href='#F2L2' id='F2L2'>  2</a>
<a href='#F2L3' id='F2L3'>  3</a>
<a href='#F2L4' id='F2L4'>  4</a>
<a href='#F2L5' id='F2L5'>  5</a>
<a href='#F2L6' id='F2L6'>  6</a>
<a href='#F2L7' id='F2L7'>  7</a>
<a href='#F2L8' id='F2L8'>  8</a></div><div class='t'><a href='#F2L9' id='F2L9'>  9</a></div><div><a href='#F2L10' id='F2L10'> 10</a>
<a href='#F2L11' id='F2L11'> 11</a>
<a href='#F2L12' id='F2L12'> 12</a>
<a href='#F2L13' id='F2L13'> 13</a>
<a href='#F2L14' id='F2L14'> 14</a>
<a href='#F2L15' id='F2L15'> 15</a>
<a href='#F2L16' id='F2L16'> 16</a>
<a href='#F2L17' id='F2L17'> 17</a>
<a href='#F2L18' id='F2L18'> 18</a>
<a href='#F2L19' id='F2L19'> 19</a>
<a href='#F2L20' id='F2L20'> 20</a>
<a href='#F2L21' id='F2L21'> 21</a>
<a href='#F2L22' id='F2L22'> 22</a>
<a href='#F2L23' id='F2L23'> 23</a>
<a href='#F2L24' id='F2L24'> 24</a>
<a href='#F2L25' id='F2L25'> 25</a>
<a href='#F2L26' id='F2L26'> 26</a>
<a href='#F2L27' id='F2L27'> 27</a>
<a href='#F2L28' id='F2L28'> 28</a>
<a href='#F2L29' id='F2L29'> 29</a>
<a href='#F2L30' id='F2L30'> 30</a>
<a href='#F2L31' id='F2L31'> 31</a>
<a href='#F2L32' id='F2L32'> 32</a>
<a href='#F2L33' id='F2L33'> 33</a>
<a href='#F2L34' id='F2L34'> 34</a>
<a href='#F2L35' id='F2L35'> 35</a>
<a href='#F2L36' id='F2L36'> 36</a>
<a href='#F2L37' id='F2L37'> 37</a>
<a href='#F2L38' id='F2L38'> 38</a>
<a href='#F2L39' id='F2L39'> 39</a>
<a href='#F2L40' id='F2L40'> 40</a>
<a href='#F2L41' id='F2L41'> 41</a>
<a href='#F2L42' id='F2L42'> 42</a>
</div>			</aside>
			<code style='margin-left: 3em'><span class="hh">
<span class="hd">&lt;?php<br /><br /></span><span class="hk">namespace&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">;<br /><br /><br /></span><span class="hc">/**<br />&nbsp;*&nbsp;Image&nbsp;meta&nbsp;information&nbsp;interface<br />&nbsp;*/<br /></span><span class="hk">interface&nbsp;</span><span class="hd">Meta<br /></span><span class="hk">{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;image&nbsp;SHA1&nbsp;hash.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">getHash</span><span class="hk">();<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;image&nbsp;type.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;integer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">getType</span><span class="hk">();<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Sets&nbsp;the&nbsp;image&nbsp;SHA1&nbsp;hash.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;$hash<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">setHash</span><span class="hk">(</span><span class="hd">$hash</span><span class="hk">);<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Sets&nbsp;the&nbsp;image&nbsp;type.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;integer&nbsp;$type<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">setType</span><span class="hk">(</span><span class="hd">$type</span><span class="hk">);<br />}<br /></span>
</span>
</code>		</div>
		</div>
	</div>
		<div>
		<table>
		<tr class='light'>
			<td class="number"><small>100 %</small></td>
			<td><div class="bar"><div style="width: 100%"></div></div></td>
			<td><a href="#F3" class="toggle">ImageStore/Files/Exceptions/ImageFileException.php</a></td>
		</tr>
		</table>

		<div class="code" id="F3">
		<div>
			<aside>
			<div><a href='#F3L1' id='F3L1'>  1</a>
<a href='#F3L2' id='F3L2'>  2</a>
<a href='#F3L3' id='F3L3'>  3</a>
<a href='#F3L4' id='F3L4'>  4</a>
<a href='#F3L5' id='F3L5'>  5</a>
<a href='#F3L6' id='F3L6'>  6</a>
<a href='#F3L7' id='F3L7'>  7</a>
<a href='#F3L8' id='F3L8'>  8</a>
<a href='#F3L9' id='F3L9'>  9</a>
<a href='#F3L10' id='F3L10'> 10</a>
<a href='#F3L11' id='F3L11'> 11</a></div><div class='t'><a href='#F3L12' id='F3L12'> 12</a></div><div><a href='#F3L13' id='F3L13'> 13</a>
<a href='#F3L14' id='F3L14'> 14</a>
<a href='#F3L15' id='F3L15'> 15</a>
<a href='#F3L16' id='F3L16'> 16</a>
<a href='#F3L17' id='F3L17'> 17</a>
<a href='#F3L18' id='F3L18'> 18</a></div><div class='t'><a href='#F3L19' id='F3L19'> 19</a>
<a href='#F3L20' id='F3L20'> 20</a></div><div><a href='#F3L21' id='F3L21'> 21</a>
<a href='#F3L22' id='F3L22'> 22</a>
</div>			</aside>
			<code style='margin-left: 3em'><span class="hh">
<span class="hd">&lt;?php<br /><br /></span><span class="hk">namespace&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Files</span><span class="hk">\</span><span class="hd">Exceptions</span><span class="hk">;<br /><br /><br />use&nbsp;</span><span class="hd">InvalidArgumentException</span><span class="hk">;<br /><br /></span><span class="hc">/**<br />&nbsp;*&nbsp;Invalid&nbsp;image&nbsp;type&nbsp;exception<br />&nbsp;*/<br /></span><span class="hk">class&nbsp;</span><span class="hd">ImageFileException&nbsp;</span><span class="hk">extends&nbsp;</span><span class="hd">InvalidArgumentException<br /></span><span class="hk">{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;$filename<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">__construct</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">parent</span><span class="hk">::</span><span class="hd">__construct</span><span class="hk">(</span><span class="hd">sprintf</span><span class="hk">(</span><span class="hs">'File&nbsp;%s&nbsp;does&nbsp;not&nbsp;exist&nbsp;or&nbsp;it&nbsp;is&nbsp;not&nbsp;an&nbsp;image.'</span><span class="hk">,&nbsp;</span><span class="hd">var_export</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">,&nbsp;</span><span class="hd">TRUE</span><span class="hk">)));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />}<br /></span>
</span>
</code>		</div>
		</div>
	</div>
		<div>
		<table>
		<tr>
			<td class="number"><small>100 %</small></td>
			<td><div class="bar"><div style="width: 100%"></div></div></td>
			<td><a href="#F4" class="toggle">ImageStore/Files/ImageFile.php</a></td>
		</tr>
		</table>

		<div class="code" id="F4">
		<div>
			<aside>
			<div><a href='#F4L1' id='F4L1'>  1</a>
<a href='#F4L2' id='F4L2'>  2</a>
<a href='#F4L3' id='F4L3'>  3</a>
<a href='#F4L4' id='F4L4'>  4</a>
<a href='#F4L5' id='F4L5'>  5</a>
<a href='#F4L6' id='F4L6'>  6</a>
<a href='#F4L7' id='F4L7'>  7</a>
<a href='#F4L8' id='F4L8'>  8</a>
<a href='#F4L9' id='F4L9'>  9</a>
<a href='#F4L10' id='F4L10'> 10</a></div><div class='t'><a href='#F4L11' id='F4L11'> 11</a></div><div><a href='#F4L12' id='F4L12'> 12</a>
<a href='#F4L13' id='F4L13'> 13</a>
<a href='#F4L14' id='F4L14'> 14</a>
<a href='#F4L15' id='F4L15'> 15</a>
<a href='#F4L16' id='F4L16'> 16</a>
<a href='#F4L17' id='F4L17'> 17</a>
<a href='#F4L18' id='F4L18'> 18</a>
<a href='#F4L19' id='F4L19'> 19</a>
<a href='#F4L20' id='F4L20'> 20</a>
<a href='#F4L21' id='F4L21'> 21</a>
<a href='#F4L22' id='F4L22'> 22</a>
<a href='#F4L23' id='F4L23'> 23</a>
<a href='#F4L24' id='F4L24'> 24</a>
<a href='#F4L25' id='F4L25'> 25</a>
<a href='#F4L26' id='F4L26'> 26</a>
<a href='#F4L27' id='F4L27'> 27</a>
<a href='#F4L28' id='F4L28'> 28</a>
<a href='#F4L29' id='F4L29'> 29</a>
<a href='#F4L30' id='F4L30'> 30</a></div><div class='t'><a href='#F4L31' id='F4L31'> 31</a></div><div><a href='#F4L32' id='F4L32'> 32</a></div><div class='t'><a href='#F4L33' id='F4L33'> 33</a>
<a href='#F4L34' id='F4L34'> 34</a></div><div class='dead'><a href='#F4L35' id='F4L35'> 35</a></div><div class='t'><a href='#F4L36' id='F4L36'> 36</a>
<a href='#F4L37' id='F4L37'> 37</a>
<a href='#F4L38' id='F4L38'> 38</a></div><div><a href='#F4L39' id='F4L39'> 39</a>
<a href='#F4L40' id='F4L40'> 40</a>
<a href='#F4L41' id='F4L41'> 41</a>
<a href='#F4L42' id='F4L42'> 42</a></div><div class='t'><a href='#F4L43' id='F4L43'> 43</a></div><div class='dead'><a href='#F4L44' id='F4L44'> 44</a></div><div><a href='#F4L45' id='F4L45'> 45</a>
<a href='#F4L46' id='F4L46'> 46</a>
<a href='#F4L47' id='F4L47'> 47</a>
<a href='#F4L48' id='F4L48'> 48</a></div><div class='t'><a href='#F4L49' id='F4L49'> 49</a>
<a href='#F4L50' id='F4L50'> 50</a></div><div><a href='#F4L51' id='F4L51'> 51</a>
<a href='#F4L52' id='F4L52'> 52</a>
<a href='#F4L53' id='F4L53'> 53</a>
<a href='#F4L54' id='F4L54'> 54</a></div><div class='t'><a href='#F4L55' id='F4L55'> 55</a></div><div class='dead'><a href='#F4L56' id='F4L56'> 56</a></div><div><a href='#F4L57' id='F4L57'> 57</a>
<a href='#F4L58' id='F4L58'> 58</a>
<a href='#F4L59' id='F4L59'> 59</a>
<a href='#F4L60' id='F4L60'> 60</a></div><div class='t'><a href='#F4L61' id='F4L61'> 61</a>
<a href='#F4L62' id='F4L62'> 62</a></div><div><a href='#F4L63' id='F4L63'> 63</a>
<a href='#F4L64' id='F4L64'> 64</a>
</div>			</aside>
			<code style='margin-left: 3em'><span class="hh">
<span class="hd">&lt;?php<br /><br /></span><span class="hk">namespace&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Files</span><span class="hk">;<br /><br /><br />use&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">File</span><span class="hk">;<br /><br /></span><span class="hc">/**<br />&nbsp;*&nbsp;Simple&nbsp;image&nbsp;file&nbsp;wrapper<br />&nbsp;*/<br /></span><span class="hk">class&nbsp;</span><span class="hd">ImageFile&nbsp;</span><span class="hk">implements&nbsp;</span><span class="hd">File<br /></span><span class="hk">{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;file&nbsp;name<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;</span><span class="hd">$name</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;image&nbsp;type<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;integer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;</span><span class="hd">$type</span><span class="hk">;<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span class="hd">__construct</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$info&nbsp;</span><span class="hk">=&nbsp;@</span><span class="hd">getimagesize</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">);&nbsp;</span><span class="hc">//&nbsp;@:&nbsp;will&nbsp;be&nbsp;escalated&nbsp;to&nbsp;exception&nbsp;on&nbsp;failure<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">if&nbsp;(</span><span class="hd">$info&nbsp;</span><span class="hk">===&nbsp;</span><span class="hd">FALSE</span><span class="hk">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span class="hd">Exceptions</span><span class="hk">\</span><span class="hd">ImageFileException</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">setName</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">setType</span><span class="hk">(</span><span class="hd">$info</span><span class="hk">[</span><span class="hd">2</span><span class="hk">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span class="hd">getType</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">type</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span class="hd">setType</span><span class="hk">(</span><span class="hd">$type</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">type&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$type</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span class="hd">getName</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">name</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span class="hd">setName</span><span class="hk">(</span><span class="hd">$name</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">name&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$name</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />}<br /></span>
</span>
</code>		</div>
		</div>
	</div>
		<div>
		<table>
		<tr>
			<td class="number"><small>100 %</small></td>
			<td><div class="bar"><div style="width: 100%"></div></div></td>
			<td><a href="#F5" class="toggle">ImageStore/ImageStorage.php</a></td>
		</tr>
		</table>

		<div class="code" id="F5">
		<div>
			<aside>
			<div><a href='#F5L1' id='F5L1'>   1</a>
<a href='#F5L2' id='F5L2'>   2</a>
<a href='#F5L3' id='F5L3'>   3</a>
<a href='#F5L4' id='F5L4'>   4</a>
<a href='#F5L5' id='F5L5'>   5</a>
<a href='#F5L6' id='F5L6'>   6</a>
<a href='#F5L7' id='F5L7'>   7</a>
<a href='#F5L8' id='F5L8'>   8</a>
<a href='#F5L9' id='F5L9'>   9</a>
<a href='#F5L10' id='F5L10'>  10</a>
<a href='#F5L11' id='F5L11'>  11</a>
<a href='#F5L12' id='F5L12'>  12</a>
<a href='#F5L13' id='F5L13'>  13</a>
<a href='#F5L14' id='F5L14'>  14</a>
<a href='#F5L15' id='F5L15'>  15</a>
<a href='#F5L16' id='F5L16'>  16</a>
<a href='#F5L17' id='F5L17'>  17</a>
<a href='#F5L18' id='F5L18'>  18</a>
<a href='#F5L19' id='F5L19'>  19</a>
<a href='#F5L20' id='F5L20'>  20</a>
<a href='#F5L21' id='F5L21'>  21</a>
<a href='#F5L22' id='F5L22'>  22</a>
<a href='#F5L23' id='F5L23'>  23</a>
<a href='#F5L24' id='F5L24'>  24</a>
<a href='#F5L25' id='F5L25'>  25</a>
<a href='#F5L26' id='F5L26'>  26</a>
<a href='#F5L27' id='F5L27'>  27</a></div><div class='t'><a href='#F5L28' id='F5L28'>  28</a></div><div><a href='#F5L29' id='F5L29'>  29</a>
<a href='#F5L30' id='F5L30'>  30</a>
<a href='#F5L31' id='F5L31'>  31</a>
<a href='#F5L32' id='F5L32'>  32</a>
<a href='#F5L33' id='F5L33'>  33</a>
<a href='#F5L34' id='F5L34'>  34</a>
<a href='#F5L35' id='F5L35'>  35</a>
<a href='#F5L36' id='F5L36'>  36</a>
<a href='#F5L37' id='F5L37'>  37</a>
<a href='#F5L38' id='F5L38'>  38</a>
<a href='#F5L39' id='F5L39'>  39</a>
<a href='#F5L40' id='F5L40'>  40</a>
<a href='#F5L41' id='F5L41'>  41</a>
<a href='#F5L42' id='F5L42'>  42</a>
<a href='#F5L43' id='F5L43'>  43</a>
<a href='#F5L44' id='F5L44'>  44</a>
<a href='#F5L45' id='F5L45'>  45</a>
<a href='#F5L46' id='F5L46'>  46</a>
<a href='#F5L47' id='F5L47'>  47</a>
<a href='#F5L48' id='F5L48'>  48</a>
<a href='#F5L49' id='F5L49'>  49</a>
<a href='#F5L50' id='F5L50'>  50</a>
<a href='#F5L51' id='F5L51'>  51</a>
<a href='#F5L52' id='F5L52'>  52</a>
<a href='#F5L53' id='F5L53'>  53</a>
<a href='#F5L54' id='F5L54'>  54</a>
<a href='#F5L55' id='F5L55'>  55</a>
<a href='#F5L56' id='F5L56'>  56</a>
<a href='#F5L57' id='F5L57'>  57</a>
<a href='#F5L58' id='F5L58'>  58</a>
<a href='#F5L59' id='F5L59'>  59</a>
<a href='#F5L60' id='F5L60'>  60</a>
<a href='#F5L61' id='F5L61'>  61</a>
<a href='#F5L62' id='F5L62'>  62</a>
<a href='#F5L63' id='F5L63'>  63</a>
<a href='#F5L64' id='F5L64'>  64</a>
<a href='#F5L65' id='F5L65'>  65</a>
<a href='#F5L66' id='F5L66'>  66</a>
<a href='#F5L67' id='F5L67'>  67</a>
<a href='#F5L68' id='F5L68'>  68</a>
<a href='#F5L69' id='F5L69'>  69</a>
<a href='#F5L70' id='F5L70'>  70</a>
<a href='#F5L71' id='F5L71'>  71</a>
<a href='#F5L72' id='F5L72'>  72</a>
<a href='#F5L73' id='F5L73'>  73</a>
<a href='#F5L74' id='F5L74'>  74</a>
<a href='#F5L75' id='F5L75'>  75</a>
<a href='#F5L76' id='F5L76'>  76</a></div><div class='t'><a href='#F5L77' id='F5L77'>  77</a>
<a href='#F5L78' id='F5L78'>  78</a>
<a href='#F5L79' id='F5L79'>  79</a>
<a href='#F5L80' id='F5L80'>  80</a></div><div><a href='#F5L81' id='F5L81'>  81</a>
<a href='#F5L82' id='F5L82'>  82</a>
<a href='#F5L83' id='F5L83'>  83</a>
<a href='#F5L84' id='F5L84'>  84</a>
<a href='#F5L85' id='F5L85'>  85</a>
<a href='#F5L86' id='F5L86'>  86</a>
<a href='#F5L87' id='F5L87'>  87</a>
<a href='#F5L88' id='F5L88'>  88</a>
<a href='#F5L89' id='F5L89'>  89</a>
<a href='#F5L90' id='F5L90'>  90</a>
<a href='#F5L91' id='F5L91'>  91</a></div><div class='t'><a href='#F5L92' id='F5L92'>  92</a></div><div><a href='#F5L93' id='F5L93'>  93</a></div><div class='t'><a href='#F5L94' id='F5L94'>  94</a></div><div class='dead'><a href='#F5L95' id='F5L95'>  95</a></div><div><a href='#F5L96' id='F5L96'>  96</a>
<a href='#F5L97' id='F5L97'>  97</a>
<a href='#F5L98' id='F5L98'>  98</a>
<a href='#F5L99' id='F5L99'>  99</a>
<a href='#F5L100' id='F5L100'> 100</a>
<a href='#F5L101' id='F5L101'> 101</a>
<a href='#F5L102' id='F5L102'> 102</a>
<a href='#F5L103' id='F5L103'> 103</a>
<a href='#F5L104' id='F5L104'> 104</a>
<a href='#F5L105' id='F5L105'> 105</a>
<a href='#F5L106' id='F5L106'> 106</a></div><div class='t'><a href='#F5L107' id='F5L107'> 107</a>
<a href='#F5L108' id='F5L108'> 108</a>
<a href='#F5L109' id='F5L109'> 109</a>
<a href='#F5L110' id='F5L110'> 110</a>
<a href='#F5L111' id='F5L111'> 111</a>
<a href='#F5L112' id='F5L112'> 112</a></div><div><a href='#F5L113' id='F5L113'> 113</a>
<a href='#F5L114' id='F5L114'> 114</a>
<a href='#F5L115' id='F5L115'> 115</a>
<a href='#F5L116' id='F5L116'> 116</a>
<a href='#F5L117' id='F5L117'> 117</a>
<a href='#F5L118' id='F5L118'> 118</a>
<a href='#F5L119' id='F5L119'> 119</a>
<a href='#F5L120' id='F5L120'> 120</a>
<a href='#F5L121' id='F5L121'> 121</a>
<a href='#F5L122' id='F5L122'> 122</a></div><div class='t'><a href='#F5L123' id='F5L123'> 123</a>
<a href='#F5L124' id='F5L124'> 124</a>
<a href='#F5L125' id='F5L125'> 125</a></div><div><a href='#F5L126' id='F5L126'> 126</a></div><div class='t'><a href='#F5L127' id='F5L127'> 127</a></div><div><a href='#F5L128' id='F5L128'> 128</a></div><div class='t'><a href='#F5L129' id='F5L129'> 129</a></div><div><a href='#F5L130' id='F5L130'> 130</a></div><div class='t'><a href='#F5L131' id='F5L131'> 131</a></div><div class='dead'><a href='#F5L132' id='F5L132'> 132</a></div><div><a href='#F5L133' id='F5L133'> 133</a>
<a href='#F5L134' id='F5L134'> 134</a>
<a href='#F5L135' id='F5L135'> 135</a>
<a href='#F5L136' id='F5L136'> 136</a>
<a href='#F5L137' id='F5L137'> 137</a>
<a href='#F5L138' id='F5L138'> 138</a>
<a href='#F5L139' id='F5L139'> 139</a>
<a href='#F5L140' id='F5L140'> 140</a>
<a href='#F5L141' id='F5L141'> 141</a>
<a href='#F5L142' id='F5L142'> 142</a></div><div class='t'><a href='#F5L143' id='F5L143'> 143</a></div><div class='dead'><a href='#F5L144' id='F5L144'> 144</a></div><div><a href='#F5L145' id='F5L145'> 145</a>
<a href='#F5L146' id='F5L146'> 146</a>
<a href='#F5L147' id='F5L147'> 147</a>
<a href='#F5L148' id='F5L148'> 148</a>
<a href='#F5L149' id='F5L149'> 149</a>
<a href='#F5L150' id='F5L150'> 150</a>
<a href='#F5L151' id='F5L151'> 151</a>
<a href='#F5L152' id='F5L152'> 152</a>
<a href='#F5L153' id='F5L153'> 153</a>
<a href='#F5L154' id='F5L154'> 154</a>
<a href='#F5L155' id='F5L155'> 155</a>
<a href='#F5L156' id='F5L156'> 156</a>
<a href='#F5L157' id='F5L157'> 157</a>
<a href='#F5L158' id='F5L158'> 158</a></div><div class='t'><a href='#F5L159' id='F5L159'> 159</a>
<a href='#F5L160' id='F5L160'> 160</a></div><div class='dead'><a href='#F5L161' id='F5L161'> 161</a></div><div><a href='#F5L162' id='F5L162'> 162</a></div><div class='t'><a href='#F5L163' id='F5L163'> 163</a>
<a href='#F5L164' id='F5L164'> 164</a></div><div><a href='#F5L165' id='F5L165'> 165</a>
<a href='#F5L166' id='F5L166'> 166</a>
<a href='#F5L167' id='F5L167'> 167</a>
<a href='#F5L168' id='F5L168'> 168</a>
<a href='#F5L169' id='F5L169'> 169</a>
<a href='#F5L170' id='F5L170'> 170</a>
<a href='#F5L171' id='F5L171'> 171</a>
<a href='#F5L172' id='F5L172'> 172</a>
<a href='#F5L173' id='F5L173'> 173</a>
<a href='#F5L174' id='F5L174'> 174</a>
<a href='#F5L175' id='F5L175'> 175</a></div><div class='t'><a href='#F5L176' id='F5L176'> 176</a></div><div class='dead'><a href='#F5L177' id='F5L177'> 177</a></div><div><a href='#F5L178' id='F5L178'> 178</a>
<a href='#F5L179' id='F5L179'> 179</a>
<a href='#F5L180' id='F5L180'> 180</a>
<a href='#F5L181' id='F5L181'> 181</a>
<a href='#F5L182' id='F5L182'> 182</a>
<a href='#F5L183' id='F5L183'> 183</a>
<a href='#F5L184' id='F5L184'> 184</a>
<a href='#F5L185' id='F5L185'> 185</a>
<a href='#F5L186' id='F5L186'> 186</a>
<a href='#F5L187' id='F5L187'> 187</a></div><div class='t'><a href='#F5L188' id='F5L188'> 188</a>
<a href='#F5L189' id='F5L189'> 189</a></div><div><a href='#F5L190' id='F5L190'> 190</a></div><div class='t'><a href='#F5L191' id='F5L191'> 191</a></div><div class='dead'><a href='#F5L192' id='F5L192'> 192</a></div><div><a href='#F5L193' id='F5L193'> 193</a>
<a href='#F5L194' id='F5L194'> 194</a>
<a href='#F5L195' id='F5L195'> 195</a>
<a href='#F5L196' id='F5L196'> 196</a>
<a href='#F5L197' id='F5L197'> 197</a>
<a href='#F5L198' id='F5L198'> 198</a>
<a href='#F5L199' id='F5L199'> 199</a>
<a href='#F5L200' id='F5L200'> 200</a>
<a href='#F5L201' id='F5L201'> 201</a>
<a href='#F5L202' id='F5L202'> 202</a></div><div class='t'><a href='#F5L203' id='F5L203'> 203</a>
<a href='#F5L204' id='F5L204'> 204</a></div><div><a href='#F5L205' id='F5L205'> 205</a></div><div class='t'><a href='#F5L206' id='F5L206'> 206</a></div><div class='dead'><a href='#F5L207' id='F5L207'> 207</a></div><div><a href='#F5L208' id='F5L208'> 208</a>
<a href='#F5L209' id='F5L209'> 209</a>
<a href='#F5L210' id='F5L210'> 210</a>
<a href='#F5L211' id='F5L211'> 211</a>
<a href='#F5L212' id='F5L212'> 212</a>
<a href='#F5L213' id='F5L213'> 213</a>
<a href='#F5L214' id='F5L214'> 214</a>
<a href='#F5L215' id='F5L215'> 215</a>
<a href='#F5L216' id='F5L216'> 216</a>
<a href='#F5L217' id='F5L217'> 217</a></div><div class='t'><a href='#F5L218' id='F5L218'> 218</a>
<a href='#F5L219' id='F5L219'> 219</a></div><div><a href='#F5L220' id='F5L220'> 220</a></div><div class='t'><a href='#F5L221' id='F5L221'> 221</a></div><div class='dead'><a href='#F5L222' id='F5L222'> 222</a></div><div><a href='#F5L223' id='F5L223'> 223</a>
<a href='#F5L224' id='F5L224'> 224</a>
<a href='#F5L225' id='F5L225'> 225</a>
<a href='#F5L226' id='F5L226'> 226</a>
<a href='#F5L227' id='F5L227'> 227</a>
<a href='#F5L228' id='F5L228'> 228</a>
<a href='#F5L229' id='F5L229'> 229</a>
<a href='#F5L230' id='F5L230'> 230</a>
<a href='#F5L231' id='F5L231'> 231</a>
<a href='#F5L232' id='F5L232'> 232</a></div><div class='t'><a href='#F5L233' id='F5L233'> 233</a></div><div class='dead'><a href='#F5L234' id='F5L234'> 234</a></div><div><a href='#F5L235' id='F5L235'> 235</a>
<a href='#F5L236' id='F5L236'> 236</a>
<a href='#F5L237' id='F5L237'> 237</a>
<a href='#F5L238' id='F5L238'> 238</a>
<a href='#F5L239' id='F5L239'> 239</a>
<a href='#F5L240' id='F5L240'> 240</a>
<a href='#F5L241' id='F5L241'> 241</a>
<a href='#F5L242' id='F5L242'> 242</a>
<a href='#F5L243' id='F5L243'> 243</a>
<a href='#F5L244' id='F5L244'> 244</a></div><div class='t'><a href='#F5L245' id='F5L245'> 245</a></div><div><a href='#F5L246' id='F5L246'> 246</a></div><div class='t'><a href='#F5L247' id='F5L247'> 247</a></div><div class='dead'><a href='#F5L248' id='F5L248'> 248</a></div><div><a href='#F5L249' id='F5L249'> 249</a>
<a href='#F5L250' id='F5L250'> 250</a>
<a href='#F5L251' id='F5L251'> 251</a>
<a href='#F5L252' id='F5L252'> 252</a>
<a href='#F5L253' id='F5L253'> 253</a>
<a href='#F5L254' id='F5L254'> 254</a>
<a href='#F5L255' id='F5L255'> 255</a>
<a href='#F5L256' id='F5L256'> 256</a>
<a href='#F5L257' id='F5L257'> 257</a>
<a href='#F5L258' id='F5L258'> 258</a></div><div class='t'><a href='#F5L259' id='F5L259'> 259</a></div><div class='dead'><a href='#F5L260' id='F5L260'> 260</a></div><div><a href='#F5L261' id='F5L261'> 261</a>
<a href='#F5L262' id='F5L262'> 262</a>
<a href='#F5L263' id='F5L263'> 263</a>
<a href='#F5L264' id='F5L264'> 264</a>
<a href='#F5L265' id='F5L265'> 265</a>
<a href='#F5L266' id='F5L266'> 266</a>
<a href='#F5L267' id='F5L267'> 267</a>
<a href='#F5L268' id='F5L268'> 268</a>
<a href='#F5L269' id='F5L269'> 269</a>
<a href='#F5L270' id='F5L270'> 270</a>
<a href='#F5L271' id='F5L271'> 271</a>
<a href='#F5L272' id='F5L272'> 272</a></div><div class='t'><a href='#F5L273' id='F5L273'> 273</a>
<a href='#F5L274' id='F5L274'> 274</a></div><div class='dead'><a href='#F5L275' id='F5L275'> 275</a></div><div><a href='#F5L276' id='F5L276'> 276</a></div><div class='t'><a href='#F5L277' id='F5L277'> 277</a>
<a href='#F5L278' id='F5L278'> 278</a>
<a href='#F5L279' id='F5L279'> 279</a></div><div><a href='#F5L280' id='F5L280'> 280</a></div><div class='t'><a href='#F5L281' id='F5L281'> 281</a>
<a href='#F5L282' id='F5L282'> 282</a>
<a href='#F5L283' id='F5L283'> 283</a>
<a href='#F5L284' id='F5L284'> 284</a>
<a href='#F5L285' id='F5L285'> 285</a>
<a href='#F5L286' id='F5L286'> 286</a></div><div><a href='#F5L287' id='F5L287'> 287</a></div><div class='t'><a href='#F5L288' id='F5L288'> 288</a>
<a href='#F5L289' id='F5L289'> 289</a></div><div><a href='#F5L290' id='F5L290'> 290</a></div><div class='t'><a href='#F5L291' id='F5L291'> 291</a></div><div class='dead'><a href='#F5L292' id='F5L292'> 292</a></div><div><a href='#F5L293' id='F5L293'> 293</a>
<a href='#F5L294' id='F5L294'> 294</a>
<a href='#F5L295' id='F5L295'> 295</a>
<a href='#F5L296' id='F5L296'> 296</a>
<a href='#F5L297' id='F5L297'> 297</a>
<a href='#F5L298' id='F5L298'> 298</a>
<a href='#F5L299' id='F5L299'> 299</a>
<a href='#F5L300' id='F5L300'> 300</a>
<a href='#F5L301' id='F5L301'> 301</a>
<a href='#F5L302' id='F5L302'> 302</a></div><div class='t'><a href='#F5L303' id='F5L303'> 303</a>
<a href='#F5L304' id='F5L304'> 304</a></div><div><a href='#F5L305' id='F5L305'> 305</a></div><div class='t'><a href='#F5L306' id='F5L306'> 306</a></div><div class='dead'><a href='#F5L307' id='F5L307'> 307</a></div><div><a href='#F5L308' id='F5L308'> 308</a>
<a href='#F5L309' id='F5L309'> 309</a>
<a href='#F5L310' id='F5L310'> 310</a>
<a href='#F5L311' id='F5L311'> 311</a>
<a href='#F5L312' id='F5L312'> 312</a>
<a href='#F5L313' id='F5L313'> 313</a>
<a href='#F5L314' id='F5L314'> 314</a>
<a href='#F5L315' id='F5L315'> 315</a>
<a href='#F5L316' id='F5L316'> 316</a>
<a href='#F5L317' id='F5L317'> 317</a></div><div class='t'><a href='#F5L318' id='F5L318'> 318</a>
<a href='#F5L319' id='F5L319'> 319</a></div><div><a href='#F5L320' id='F5L320'> 320</a></div><div class='t'><a href='#F5L321' id='F5L321'> 321</a></div><div class='dead'><a href='#F5L322' id='F5L322'> 322</a></div><div><a href='#F5L323' id='F5L323'> 323</a>
<a href='#F5L324' id='F5L324'> 324</a>
<a href='#F5L325' id='F5L325'> 325</a>
<a href='#F5L326' id='F5L326'> 326</a>
<a href='#F5L327' id='F5L327'> 327</a>
<a href='#F5L328' id='F5L328'> 328</a>
<a href='#F5L329' id='F5L329'> 329</a>
<a href='#F5L330' id='F5L330'> 330</a>
<a href='#F5L331' id='F5L331'> 331</a>
<a href='#F5L332' id='F5L332'> 332</a></div><div class='t'><a href='#F5L333' id='F5L333'> 333</a>
<a href='#F5L334' id='F5L334'> 334</a>
<a href='#F5L335' id='F5L335'> 335</a>
<a href='#F5L336' id='F5L336'> 336</a>
<a href='#F5L337' id='F5L337'> 337</a>
<a href='#F5L338' id='F5L338'> 338</a></div><div><a href='#F5L339' id='F5L339'> 339</a></div><div class='t'><a href='#F5L340' id='F5L340'> 340</a></div><div class='dead'><a href='#F5L341' id='F5L341'> 341</a></div><div><a href='#F5L342' id='F5L342'> 342</a>
<a href='#F5L343' id='F5L343'> 343</a>
<a href='#F5L344' id='F5L344'> 344</a>
<a href='#F5L345' id='F5L345'> 345</a>
<a href='#F5L346' id='F5L346'> 346</a>
<a href='#F5L347' id='F5L347'> 347</a>
<a href='#F5L348' id='F5L348'> 348</a>
<a href='#F5L349' id='F5L349'> 349</a>
<a href='#F5L350' id='F5L350'> 350</a></div><div class='t'><a href='#F5L351' id='F5L351'> 351</a></div><div><a href='#F5L352' id='F5L352'> 352</a></div><div class='t'><a href='#F5L353' id='F5L353'> 353</a></div><div class='dead'><a href='#F5L354' id='F5L354'> 354</a></div><div><a href='#F5L355' id='F5L355'> 355</a>
<a href='#F5L356' id='F5L356'> 356</a>
<a href='#F5L357' id='F5L357'> 357</a>
<a href='#F5L358' id='F5L358'> 358</a>
<a href='#F5L359' id='F5L359'> 359</a>
<a href='#F5L360' id='F5L360'> 360</a>
<a href='#F5L361' id='F5L361'> 361</a>
<a href='#F5L362' id='F5L362'> 362</a>
<a href='#F5L363' id='F5L363'> 363</a>
<a href='#F5L364' id='F5L364'> 364</a></div><div class='t'><a href='#F5L365' id='F5L365'> 365</a></div><div><a href='#F5L366' id='F5L366'> 366</a></div><div class='t'><a href='#F5L367' id='F5L367'> 367</a></div><div><a href='#F5L368' id='F5L368'> 368</a></div><div class='t'><a href='#F5L369' id='F5L369'> 369</a></div><div><a href='#F5L370' id='F5L370'> 370</a></div><div class='t'><a href='#F5L371' id='F5L371'> 371</a></div><div><a href='#F5L372' id='F5L372'> 372</a>
<a href='#F5L373' id='F5L373'> 373</a></div><div class='t'><a href='#F5L374' id='F5L374'> 374</a>
<a href='#F5L375' id='F5L375'> 375</a>
<a href='#F5L376' id='F5L376'> 376</a></div><div><a href='#F5L377' id='F5L377'> 377</a></div><div class='t'><a href='#F5L378' id='F5L378'> 378</a></div><div><a href='#F5L379' id='F5L379'> 379</a></div><div class='t'><a href='#F5L380' id='F5L380'> 380</a></div><div><a href='#F5L381' id='F5L381'> 381</a></div><div class='t'><a href='#F5L382' id='F5L382'> 382</a>
<a href='#F5L383' id='F5L383'> 383</a>
<a href='#F5L384' id='F5L384'> 384</a>
<a href='#F5L385' id='F5L385'> 385</a></div><div><a href='#F5L386' id='F5L386'> 386</a></div><div class='t'><a href='#F5L387' id='F5L387'> 387</a>
<a href='#F5L388' id='F5L388'> 388</a>
<a href='#F5L389' id='F5L389'> 389</a>
<a href='#F5L390' id='F5L390'> 390</a></div><div><a href='#F5L391' id='F5L391'> 391</a>
<a href='#F5L392' id='F5L392'> 392</a>
<a href='#F5L393' id='F5L393'> 393</a>
<a href='#F5L394' id='F5L394'> 394</a>
<a href='#F5L395' id='F5L395'> 395</a>
<a href='#F5L396' id='F5L396'> 396</a>
<a href='#F5L397' id='F5L397'> 397</a>
<a href='#F5L398' id='F5L398'> 398</a>
<a href='#F5L399' id='F5L399'> 399</a>
<a href='#F5L400' id='F5L400'> 400</a></div><div class='t'><a href='#F5L401' id='F5L401'> 401</a></div><div><a href='#F5L402' id='F5L402'> 402</a></div><div class='t'><a href='#F5L403' id='F5L403'> 403</a></div><div class='dead'><a href='#F5L404' id='F5L404'> 404</a></div><div><a href='#F5L405' id='F5L405'> 405</a>
<a href='#F5L406' id='F5L406'> 406</a>
<a href='#F5L407' id='F5L407'> 407</a>
<a href='#F5L408' id='F5L408'> 408</a>
<a href='#F5L409' id='F5L409'> 409</a>
<a href='#F5L410' id='F5L410'> 410</a>
<a href='#F5L411' id='F5L411'> 411</a>
<a href='#F5L412' id='F5L412'> 412</a>
<a href='#F5L413' id='F5L413'> 413</a>
<a href='#F5L414' id='F5L414'> 414</a>
<a href='#F5L415' id='F5L415'> 415</a></div><div class='t'><a href='#F5L416' id='F5L416'> 416</a></div><div><a href='#F5L417' id='F5L417'> 417</a></div><div class='t'><a href='#F5L418' id='F5L418'> 418</a></div><div class='dead'><a href='#F5L419' id='F5L419'> 419</a></div><div><a href='#F5L420' id='F5L420'> 420</a></div><div class='t'><a href='#F5L421' id='F5L421'> 421</a></div><div><a href='#F5L422' id='F5L422'> 422</a></div><div class='t'><a href='#F5L423' id='F5L423'> 423</a>
<a href='#F5L424' id='F5L424'> 424</a></div><div><a href='#F5L425' id='F5L425'> 425</a></div><div class='t'><a href='#F5L426' id='F5L426'> 426</a>
<a href='#F5L427' id='F5L427'> 427</a>
<a href='#F5L428' id='F5L428'> 428</a></div><div><a href='#F5L429' id='F5L429'> 429</a></div><div class='t'><a href='#F5L430' id='F5L430'> 430</a>
<a href='#F5L431' id='F5L431'> 431</a></div><div><a href='#F5L432' id='F5L432'> 432</a></div><div class='t'><a href='#F5L433' id='F5L433'> 433</a></div><div><a href='#F5L434' id='F5L434'> 434</a></div><div class='t'><a href='#F5L435' id='F5L435'> 435</a></div><div><a href='#F5L436' id='F5L436'> 436</a></div><div class='t'><a href='#F5L437' id='F5L437'> 437</a>
<a href='#F5L438' id='F5L438'> 438</a></div><div><a href='#F5L439' id='F5L439'> 439</a></div><div class='t'><a href='#F5L440' id='F5L440'> 440</a>
<a href='#F5L441' id='F5L441'> 441</a></div><div><a href='#F5L442' id='F5L442'> 442</a></div><div class='t'><a href='#F5L443' id='F5L443'> 443</a>
<a href='#F5L444' id='F5L444'> 444</a>
<a href='#F5L445' id='F5L445'> 445</a></div><div><a href='#F5L446' id='F5L446'> 446</a></div><div class='t'><a href='#F5L447' id='F5L447'> 447</a>
<a href='#F5L448' id='F5L448'> 448</a>
<a href='#F5L449' id='F5L449'> 449</a></div><div><a href='#F5L450' id='F5L450'> 450</a></div><div class='t'><a href='#F5L451' id='F5L451'> 451</a></div><div><a href='#F5L452' id='F5L452'> 452</a></div><div class='t'><a href='#F5L453' id='F5L453'> 453</a>
<a href='#F5L454' id='F5L454'> 454</a></div><div><a href='#F5L455' id='F5L455'> 455</a></div><div class='t'><a href='#F5L456' id='F5L456'> 456</a>
<a href='#F5L457' id='F5L457'> 457</a></div><div><a href='#F5L458' id='F5L458'> 458</a>
<a href='#F5L459' id='F5L459'> 459</a></div><div class='t'><a href='#F5L460' id='F5L460'> 460</a></div><div><a href='#F5L461' id='F5L461'> 461</a></div><div class='t'><a href='#F5L462' id='F5L462'> 462</a></div><div><a href='#F5L463' id='F5L463'> 463</a></div><div class='t'><a href='#F5L464' id='F5L464'> 464</a>
<a href='#F5L465' id='F5L465'> 465</a></div><div><a href='#F5L466' id='F5L466'> 466</a></div><div class='t'><a href='#F5L467' id='F5L467'> 467</a>
<a href='#F5L468' id='F5L468'> 468</a></div><div><a href='#F5L469' id='F5L469'> 469</a></div><div class='t'><a href='#F5L470' id='F5L470'> 470</a></div><div><a href='#F5L471' id='F5L471'> 471</a></div><div class='t'><a href='#F5L472' id='F5L472'> 472</a>
<a href='#F5L473' id='F5L473'> 473</a></div><div><a href='#F5L474' id='F5L474'> 474</a></div><div class='t'><a href='#F5L475' id='F5L475'> 475</a>
<a href='#F5L476' id='F5L476'> 476</a></div><div><a href='#F5L477' id='F5L477'> 477</a>
<a href='#F5L478' id='F5L478'> 478</a>
<a href='#F5L479' id='F5L479'> 479</a>
<a href='#F5L480' id='F5L480'> 480</a></div><div class='t'><a href='#F5L481' id='F5L481'> 481</a>
<a href='#F5L482' id='F5L482'> 482</a></div><div><a href='#F5L483' id='F5L483'> 483</a></div><div class='t'><a href='#F5L484' id='F5L484'> 484</a></div><div class='dead'><a href='#F5L485' id='F5L485'> 485</a></div><div><a href='#F5L486' id='F5L486'> 486</a>
<a href='#F5L487' id='F5L487'> 487</a>
<a href='#F5L488' id='F5L488'> 488</a>
<a href='#F5L489' id='F5L489'> 489</a>
<a href='#F5L490' id='F5L490'> 490</a>
<a href='#F5L491' id='F5L491'> 491</a>
<a href='#F5L492' id='F5L492'> 492</a>
<a href='#F5L493' id='F5L493'> 493</a>
<a href='#F5L494' id='F5L494'> 494</a>
<a href='#F5L495' id='F5L495'> 495</a>
<a href='#F5L496' id='F5L496'> 496</a></div><div class='t'><a href='#F5L497' id='F5L497'> 497</a></div><div><a href='#F5L498' id='F5L498'> 498</a></div><div class='t'><a href='#F5L499' id='F5L499'> 499</a></div><div class='dead'><a href='#F5L500' id='F5L500'> 500</a></div><div><a href='#F5L501' id='F5L501'> 501</a></div><div class='t'><a href='#F5L502' id='F5L502'> 502</a></div><div><a href='#F5L503' id='F5L503'> 503</a></div><div class='t'><a href='#F5L504' id='F5L504'> 504</a></div><div class='dead'><a href='#F5L505' id='F5L505'> 505</a></div><div><a href='#F5L506' id='F5L506'> 506</a>
<a href='#F5L507' id='F5L507'> 507</a>
<a href='#F5L508' id='F5L508'> 508</a>
<a href='#F5L509' id='F5L509'> 509</a>
<a href='#F5L510' id='F5L510'> 510</a>
<a href='#F5L511' id='F5L511'> 511</a>
<a href='#F5L512' id='F5L512'> 512</a>
<a href='#F5L513' id='F5L513'> 513</a>
<a href='#F5L514' id='F5L514'> 514</a>
<a href='#F5L515' id='F5L515'> 515</a></div><div class='t'><a href='#F5L516' id='F5L516'> 516</a>
<a href='#F5L517' id='F5L517'> 517</a>
<a href='#F5L518' id='F5L518'> 518</a></div><div><a href='#F5L519' id='F5L519'> 519</a></div><div class='t'><a href='#F5L520' id='F5L520'> 520</a>
<a href='#F5L521' id='F5L521'> 521</a>
<a href='#F5L522' id='F5L522'> 522</a></div><div><a href='#F5L523' id='F5L523'> 523</a></div><div class='t'><a href='#F5L524' id='F5L524'> 524</a></div><div class='dead'><a href='#F5L525' id='F5L525'> 525</a></div><div><a href='#F5L526' id='F5L526'> 526</a>
<a href='#F5L527' id='F5L527'> 527</a>
<a href='#F5L528' id='F5L528'> 528</a>
<a href='#F5L529' id='F5L529'> 529</a>
<a href='#F5L530' id='F5L530'> 530</a>
<a href='#F5L531' id='F5L531'> 531</a>
<a href='#F5L532' id='F5L532'> 532</a>
<a href='#F5L533' id='F5L533'> 533</a>
<a href='#F5L534' id='F5L534'> 534</a>
<a href='#F5L535' id='F5L535'> 535</a></div><div class='t'><a href='#F5L536' id='F5L536'> 536</a>
<a href='#F5L537' id='F5L537'> 537</a>
<a href='#F5L538' id='F5L538'> 538</a>
<a href='#F5L539' id='F5L539'> 539</a>
<a href='#F5L540' id='F5L540'> 540</a>
<a href='#F5L541' id='F5L541'> 541</a>
<a href='#F5L542' id='F5L542'> 542</a></div><div><a href='#F5L543' id='F5L543'> 543</a>
<a href='#F5L544' id='F5L544'> 544</a></div><div class='t'><a href='#F5L545' id='F5L545'> 545</a></div><div class='dead'><a href='#F5L546' id='F5L546'> 546</a></div><div><a href='#F5L547' id='F5L547'> 547</a>
<a href='#F5L548' id='F5L548'> 548</a>
<a href='#F5L549' id='F5L549'> 549</a>
<a href='#F5L550' id='F5L550'> 550</a>
<a href='#F5L551' id='F5L551'> 551</a>
<a href='#F5L552' id='F5L552'> 552</a>
<a href='#F5L553' id='F5L553'> 553</a>
<a href='#F5L554' id='F5L554'> 554</a>
<a href='#F5L555' id='F5L555'> 555</a>
<a href='#F5L556' id='F5L556'> 556</a>
<a href='#F5L557' id='F5L557'> 557</a>
<a href='#F5L558' id='F5L558'> 558</a>
<a href='#F5L559' id='F5L559'> 559</a>
<a href='#F5L560' id='F5L560'> 560</a></div><div class='t'><a href='#F5L561' id='F5L561'> 561</a>
<a href='#F5L562' id='F5L562'> 562</a></div><div class='dead'><a href='#F5L563' id='F5L563'> 563</a></div><div><a href='#F5L564' id='F5L564'> 564</a></div><div class='t'><a href='#F5L565' id='F5L565'> 565</a></div><div class='dead'><a href='#F5L566' id='F5L566'> 566</a></div><div><a href='#F5L567' id='F5L567'> 567</a>
<a href='#F5L568' id='F5L568'> 568</a>
<a href='#F5L569' id='F5L569'> 569</a>
<a href='#F5L570' id='F5L570'> 570</a>
<a href='#F5L571' id='F5L571'> 571</a>
<a href='#F5L572' id='F5L572'> 572</a>
<a href='#F5L573' id='F5L573'> 573</a>
<a href='#F5L574' id='F5L574'> 574</a>
<a href='#F5L575' id='F5L575'> 575</a>
<a href='#F5L576' id='F5L576'> 576</a></div><div class='t'><a href='#F5L577' id='F5L577'> 577</a></div><div class='dead'><a href='#F5L578' id='F5L578'> 578</a></div><div><a href='#F5L579' id='F5L579'> 579</a>
<a href='#F5L580' id='F5L580'> 580</a>
<a href='#F5L581' id='F5L581'> 581</a>
<a href='#F5L582' id='F5L582'> 582</a>
<a href='#F5L583' id='F5L583'> 583</a>
<a href='#F5L584' id='F5L584'> 584</a>
<a href='#F5L585' id='F5L585'> 585</a>
<a href='#F5L586' id='F5L586'> 586</a>
<a href='#F5L587' id='F5L587'> 587</a>
<a href='#F5L588' id='F5L588'> 588</a></div><div class='t'><a href='#F5L589' id='F5L589'> 589</a></div><div class='dead'><a href='#F5L590' id='F5L590'> 590</a></div><div><a href='#F5L591' id='F5L591'> 591</a>
<a href='#F5L592' id='F5L592'> 592</a>
<a href='#F5L593' id='F5L593'> 593</a>
<a href='#F5L594' id='F5L594'> 594</a>
<a href='#F5L595' id='F5L595'> 595</a>
<a href='#F5L596' id='F5L596'> 596</a>
<a href='#F5L597' id='F5L597'> 597</a>
<a href='#F5L598' id='F5L598'> 598</a>
<a href='#F5L599' id='F5L599'> 599</a></div><div class='t'><a href='#F5L600' id='F5L600'> 600</a></div><div class='dead'><a href='#F5L601' id='F5L601'> 601</a></div><div><a href='#F5L602' id='F5L602'> 602</a>
<a href='#F5L603' id='F5L603'> 603</a>
<a href='#F5L604' id='F5L604'> 604</a>
<a href='#F5L605' id='F5L605'> 605</a>
<a href='#F5L606' id='F5L606'> 606</a>
<a href='#F5L607' id='F5L607'> 607</a>
<a href='#F5L608' id='F5L608'> 608</a>
<a href='#F5L609' id='F5L609'> 609</a>
<a href='#F5L610' id='F5L610'> 610</a>
<a href='#F5L611' id='F5L611'> 611</a></div><div class='t'><a href='#F5L612' id='F5L612'> 612</a>
<a href='#F5L613' id='F5L613'> 613</a>
<a href='#F5L614' id='F5L614'> 614</a>
<a href='#F5L615' id='F5L615'> 615</a></div><div><a href='#F5L616' id='F5L616'> 616</a></div><div class='t'><a href='#F5L617' id='F5L617'> 617</a></div><div class='dead'><a href='#F5L618' id='F5L618'> 618</a></div><div><a href='#F5L619' id='F5L619'> 619</a>
<a href='#F5L620' id='F5L620'> 620</a>
<a href='#F5L621' id='F5L621'> 621</a>
</div>			</aside>
			<code style='margin-left: 4em'><span class="hh">
<span class="hd">&lt;?php<br /><br /></span><span class="hk">namespace&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">;<br /><br /><br />use&nbsp;</span><span class="hd">Nette</span><span class="hk">\</span><span class="hd">Application</span><span class="hk">\</span><span class="hd">AbortException</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Nette</span><span class="hk">\</span><span class="hd">Application</span><span class="hk">\</span><span class="hd">Responses</span><span class="hk">\</span><span class="hd">FileResponse</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Nette</span><span class="hk">\</span><span class="hd">Http</span><span class="hk">\</span><span class="hd">FileUpload</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Nette</span><span class="hk">\</span><span class="hd">Object</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Nette</span><span class="hk">\</span><span class="hd">Utils</span><span class="hk">\</span><span class="hd">Image</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Nette</span><span class="hk">\</span><span class="hd">Utils</span><span class="hk">\</span><span class="hd">Strings</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Directory</span><span class="hk">\</span><span class="hd">Directory</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Entity</span><span class="hk">\</span><span class="hd">EmptyImage</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Entity</span><span class="hk">\</span><span class="hd">Exceptions</span><span class="hk">\</span><span class="hd">ImageTypeException</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Entity</span><span class="hk">\</span><span class="hd">ImageEnvelope</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Files</span><span class="hk">\</span><span class="hd">ImageFile</span><span class="hk">;<br /><br /></span><span class="hc">/**<br />&nbsp;*&nbsp;Image&nbsp;file&nbsp;storage<br />&nbsp;*<br />&nbsp;*&nbsp;-&nbsp;The&nbsp;images&nbsp;are&nbsp;stored&nbsp;in&nbsp;a&nbsp;regular&nbsp;files&nbsp;in&nbsp;the&nbsp;given&nbsp;`$directory`.<br />&nbsp;*&nbsp;-&nbsp;The&nbsp;files&nbsp;are&nbsp;organized&nbsp;in&nbsp;a&nbsp;2-level&nbsp;directory&nbsp;structure&nbsp;with&nbsp;maximum&nbsp;of&nbsp;256²&nbsp;directories.<br />&nbsp;*&nbsp;-&nbsp;The&nbsp;directory&nbsp;tree&nbsp;is&nbsp;well&nbsp;balanced&nbsp;thanks&nbsp;to&nbsp;the&nbsp;image&nbsp;hashes&nbsp;used&nbsp;for&nbsp;the&nbsp;directory&nbsp;path&nbsp;creation.<br />&nbsp;*&nbsp;-&nbsp;The&nbsp;storage&nbsp;stores&nbsp;only&nbsp;one&nbsp;file&nbsp;even&nbsp;if&nbsp;the&nbsp;same&nbsp;image&nbsp;is&nbsp;stored&nbsp;multiple&nbsp;times,&nbsp;thus&nbsp;images&nbsp;should&nbsp;be<br />&nbsp;*&nbsp;&nbsp;&nbsp;deleted&nbsp;only&nbsp;after&nbsp;it&nbsp;is&nbsp;sure&nbsp;it&nbsp;is&nbsp;not&nbsp;referenced&nbsp;from&nbsp;other&nbsp;entities.<br />&nbsp;*&nbsp;-&nbsp;The&nbsp;image&nbsp;thumbnails&nbsp;are&nbsp;created&nbsp;on&nbsp;demand&nbsp;and&nbsp;cached&nbsp;in&nbsp;the&nbsp;`$cacheDirectory`.<br />&nbsp;*/<br /></span><span class="hk">class&nbsp;</span><span class="hd">ImageStorage&nbsp;</span><span class="hk">extends&nbsp;</span><span class="hd">Object&nbsp;</span><span class="hk">implements&nbsp;</span><span class="hd">Storage<br /></span><span class="hk">{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;directory&nbsp;to&nbsp;store&nbsp;the&nbsp;images&nbsp;in<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;Directory<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;</span><span class="hd">$directory</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;image&nbsp;type&nbsp;-&gt;&nbsp;file&nbsp;extension&nbsp;map<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;array<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;</span><span class="hd">$extensions&nbsp;</span><span class="hk">=&nbsp;array(</span><span class="hd">Image</span><span class="hk">::</span><span class="hd">JPEG&nbsp;</span><span class="hk">=&gt;&nbsp;</span><span class="hs">'jpg'</span><span class="hk">,&nbsp;</span><span class="hd">Image</span><span class="hk">::</span><span class="hd">PNG&nbsp;</span><span class="hk">=&gt;&nbsp;</span><span class="hs">'png'</span><span class="hk">,&nbsp;</span><span class="hd">Image</span><span class="hk">::</span><span class="hd">GIF&nbsp;</span><span class="hk">=&gt;&nbsp;</span><span class="hs">'gif'</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;image&nbsp;type&nbsp;-&gt;&nbsp;MIME&nbsp;type&nbsp;map<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;array<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;</span><span class="hd">$mimeTypes&nbsp;</span><span class="hk">=&nbsp;array(</span><span class="hd">Image</span><span class="hk">::</span><span class="hd">JPEG&nbsp;</span><span class="hk">=&gt;&nbsp;</span><span class="hs">'image/jpeg'</span><span class="hk">,&nbsp;</span><span class="hd">Image</span><span class="hk">::</span><span class="hd">PNG&nbsp;</span><span class="hk">=&gt;&nbsp;</span><span class="hs">'image/png'</span><span class="hk">,&nbsp;</span><span class="hd">Image</span><span class="hk">::</span><span class="hd">GIF&nbsp;</span><span class="hk">=&gt;&nbsp;</span><span class="hs">'image/gif'</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;public&nbsp;accessible&nbsp;URL&nbsp;of&nbsp;the&nbsp;cache&nbsp;directory<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;</span><span class="hd">$baseUrl</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;cache&nbsp;directory<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;Directory<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;</span><span class="hd">$cacheDirectory</span><span class="hk">;<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;the&nbsp;image&nbsp;file&nbsp;storage&nbsp;from&nbsp;the&nbsp;given&nbsp;arguments.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;&nbsp;$directory&nbsp;The&nbsp;directory&nbsp;to&nbsp;store&nbsp;the&nbsp;images&nbsp;in<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;&nbsp;$cacheDirectory<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;&nbsp;$baseUrl<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;boolean&nbsp;$tryCreateDirectories<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">__construct</span><span class="hk">(</span><span class="hd">$directory</span><span class="hk">,&nbsp;</span><span class="hd">$cacheDirectory</span><span class="hk">,&nbsp;</span><span class="hd">$baseUrl&nbsp;</span><span class="hk">=&nbsp;</span><span class="hs">'/cache/'</span><span class="hk">,&nbsp;</span><span class="hd">$tryCreateDirectories&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">TRUE</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">directory&nbsp;</span><span class="hk">=&nbsp;new&nbsp;</span><span class="hd">Directory</span><span class="hk">(</span><span class="hd">$directory</span><span class="hk">,&nbsp;</span><span class="hd">$tryCreateDirectories</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">cacheDirectory&nbsp;</span><span class="hk">=&nbsp;new&nbsp;</span><span class="hd">Directory</span><span class="hk">(</span><span class="hd">$cacheDirectory</span><span class="hk">,&nbsp;</span><span class="hd">$tryCreateDirectories</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">setBaseUrl</span><span class="hk">(</span><span class="hd">$baseUrl</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Adds&nbsp;an&nbsp;image&nbsp;from&nbsp;the&nbsp;given&nbsp;file&nbsp;to&nbsp;the&nbsp;storage.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;ImageFile&nbsp;$file&nbsp;The&nbsp;image&nbsp;file&nbsp;to&nbsp;add<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;Meta&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$meta<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;boolean&nbsp;TRUE&nbsp;on&nbsp;success&nbsp;or&nbsp;FALSE&nbsp;on&nbsp;failure<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">add</span><span class="hk">(</span><span class="hd">ImageFile&nbsp;$file</span><span class="hk">,&nbsp;</span><span class="hd">Meta&nbsp;$meta</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">readMeta</span><span class="hk">(</span><span class="hd">$file</span><span class="hk">-&gt;</span><span class="hd">getName</span><span class="hk">(),&nbsp;</span><span class="hd">$meta</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">copy</span><span class="hk">(</span><span class="hd">$file</span><span class="hk">-&gt;</span><span class="hd">getName</span><span class="hk">(),&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">createFilename</span><span class="hk">(</span><span class="hd">$meta</span><span class="hk">));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Reads&nbsp;the&nbsp;image&nbsp;type&nbsp;from&nbsp;the&nbsp;given&nbsp;`$filename`,&nbsp;computes&nbsp;the&nbsp;image&nbsp;hash<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;and&nbsp;store&nbsp;these&nbsp;information&nbsp;in&nbsp;the&nbsp;given&nbsp;`$meta`.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;$filename&nbsp;The&nbsp;file&nbsp;to&nbsp;read&nbsp;the&nbsp;meta-data&nbsp;from<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;Meta&nbsp;&nbsp;&nbsp;$meta&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;object&nbsp;to&nbsp;store&nbsp;meta-data&nbsp;in<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;function&nbsp;</span><span class="hd">readMeta</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">,&nbsp;</span><span class="hd">Meta&nbsp;$meta</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$info&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">getimagesize</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$meta</span><span class="hk">-&gt;</span><span class="hd">setHash</span><span class="hk">(</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">hash</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$meta</span><span class="hk">-&gt;</span><span class="hd">setWidth</span><span class="hk">(</span><span class="hd">$info</span><span class="hk">[</span><span class="hd">0</span><span class="hk">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$meta</span><span class="hk">-&gt;</span><span class="hd">setHeight</span><span class="hk">(</span><span class="hd">$info</span><span class="hk">[</span><span class="hd">1</span><span class="hk">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$meta</span><span class="hk">-&gt;</span><span class="hd">setType</span><span class="hk">(</span><span class="hd">$info</span><span class="hk">[</span><span class="hd">2</span><span class="hk">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;the&nbsp;absolute&nbsp;file&nbsp;name&nbsp;from&nbsp;the&nbsp;given&nbsp;meta&nbsp;information.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;Meta&nbsp;$meta&nbsp;The&nbsp;image&nbsp;meta&nbsp;information<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string&nbsp;The&nbsp;absolute&nbsp;file&nbsp;name<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;function&nbsp;</span><span class="hd">createFilename</span><span class="hk">(</span><span class="hd">Meta&nbsp;$meta</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$path&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">createDirectoryPath</span><span class="hk">(</span><span class="hd">$meta</span><span class="hk">-&gt;</span><span class="hd">getHash</span><span class="hk">());<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$ext&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">getExtension</span><span class="hk">(</span><span class="hd">$meta</span><span class="hk">-&gt;</span><span class="hd">getType</span><span class="hk">());<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$hash&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$meta</span><span class="hk">-&gt;</span><span class="hd">getHash</span><span class="hk">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$filename&nbsp;</span><span class="hk">=&nbsp;</span><span class="hs">"</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">directory</span><span class="hs">/</span><span class="hd">$path</span><span class="hs">/</span><span class="hd">$hash</span><span class="hs">.</span><span class="hd">$ext</span><span class="hs">"</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;</span><span class="hd">Directory</span><span class="hk">(</span><span class="hd">dirname</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">));<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$filename</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Computes&nbsp;the&nbsp;SHA1&nbsp;hash&nbsp;for&nbsp;the&nbsp;given&nbsp;file.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;$filename&nbsp;The&nbsp;file&nbsp;to&nbsp;compute&nbsp;the&nbsp;hash&nbsp;from<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string&nbsp;The&nbsp;SHA1&nbsp;hash&nbsp;of&nbsp;a&nbsp;file<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;function&nbsp;</span><span class="hd">hash</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">sha1_file</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;the&nbsp;internal&nbsp;directory&nbsp;path&nbsp;from&nbsp;the&nbsp;given&nbsp;hash.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Some&nbsp;special&nbsp;images&nbsp;like&nbsp;the&nbsp;"Image&nbsp;Not&nbsp;Available"&nbsp;image&nbsp;are&nbsp;stored<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;in&nbsp;directories&nbsp;prefixed&nbsp;with&nbsp;an&nbsp;underscore.&nbsp;Those&nbsp;directories&nbsp;are&nbsp;not<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;fragmented&nbsp;to&nbsp;hash&nbsp;based&nbsp;structure.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;string&nbsp;$hash&nbsp;Tha&nbsp;SHA1&nbsp;hash<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;function&nbsp;</span><span class="hd">createDirectoryPath</span><span class="hk">(</span><span class="hd">$hash</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span class="hd">$hash</span><span class="hk">{</span><span class="hd">0</span><span class="hk">}&nbsp;===&nbsp;</span><span class="hs">'_'</span><span class="hk">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$hash</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hs">"</span><span class="hd">$hash</span><span class="hk">[</span><span class="hd">0</span><span class="hk">]</span><span class="hd">$hash</span><span class="hk">[</span><span class="hd">1</span><span class="hk">]</span><span class="hs">/</span><span class="hd">$hash</span><span class="hk">[</span><span class="hd">2</span><span class="hk">]</span><span class="hd">$hash</span><span class="hk">[</span><span class="hd">3</span><span class="hk">]</span><span class="hs">"</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;file&nbsp;extension&nbsp;for&nbsp;the&nbsp;given&nbsp;image&nbsp;type.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;integer&nbsp;$type&nbsp;The&nbsp;image&nbsp;type<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;file&nbsp;extension<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;ImageTypeException<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;function&nbsp;</span><span class="hd">getExtension</span><span class="hk">(</span><span class="hd">$type</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">extensions</span><span class="hk">[</span><span class="hd">$type</span><span class="hk">];<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Effectively&nbsp;destroys&nbsp;te&nbsp;image&nbsp;storage&nbsp;by&nbsp;removing&nbsp;the&nbsp;storage&nbsp;and&nbsp;the&nbsp;cache&nbsp;directories.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Warning:&nbsp;Use&nbsp;with&nbsp;caution!<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;ImageStorage&nbsp;Fluent&nbsp;interface<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">destroy</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">directory</span><span class="hk">-&gt;</span><span class="hd">remove</span><span class="hk">();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">cacheDirectory</span><span class="hk">-&gt;</span><span class="hd">remove</span><span class="hk">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Erases&nbsp;the&nbsp;entire&nbsp;storage&nbsp;directory&nbsp;(and&nbsp;also&nbsp;the&nbsp;cache&nbsp;directory).<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Warning:&nbsp;Use&nbsp;with&nbsp;caution!<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;ImageStorage&nbsp;Fluent&nbsp;interface<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">erase</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">directory</span><span class="hk">-&gt;</span><span class="hd">erase</span><span class="hk">();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">cacheDirectory</span><span class="hk">-&gt;</span><span class="hd">erase</span><span class="hk">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Fetches&nbsp;the&nbsp;cached&nbsp;copy&nbsp;of&nbsp;an&nbsp;image&nbsp;by&nbsp;given&nbsp;request.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;Request&nbsp;$request&nbsp;The&nbsp;image&nbsp;request<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;Image<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">fetch</span><span class="hk">(</span><span class="hd">Request&nbsp;$request</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">checkImage</span><span class="hk">(</span><span class="hd">$request</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$filename&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">createCacheFilename</span><span class="hk">(</span><span class="hd">$request</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">Image</span><span class="hk">::</span><span class="hd">fromFile</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Fetches&nbsp;the&nbsp;original&nbsp;image&nbsp;by&nbsp;the&nbsp;given&nbsp;image&nbsp;meta&nbsp;information.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;Meta&nbsp;$meta&nbsp;The&nbsp;stored&nbsp;image&nbsp;meta&nbsp;information<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;Image&nbsp;The&nbsp;stored&nbsp;image<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">original</span><span class="hk">(</span><span class="hd">Meta&nbsp;$meta</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">Image</span><span class="hk">::</span><span class="hd">fromFile</span><span class="hk">(</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">createFilename</span><span class="hk">(</span><span class="hd">$meta</span><span class="hk">));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Removes&nbsp;the&nbsp;image&nbsp;from&nbsp;the&nbsp;storage&nbsp;by&nbsp;the&nbsp;given&nbsp;image&nbsp;meta&nbsp;information.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;Meta&nbsp;$meta&nbsp;The&nbsp;image&nbsp;information<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;ImageStorage&nbsp;Fluent&nbsp;interface<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">remove</span><span class="hk">(</span><span class="hd">Meta&nbsp;$meta</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">unlink</span><span class="hk">(</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">createFilename</span><span class="hk">(</span><span class="hd">$meta</span><span class="hk">));<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Checks&nbsp;if&nbsp;an&nbsp;image&nbsp;of&nbsp;the&nbsp;given&nbsp;meta&nbsp;information&nbsp;is&nbsp;stored&nbsp;in&nbsp;the&nbsp;storage.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;Meta&nbsp;$meta&nbsp;The&nbsp;image&nbsp;meta&nbsp;information<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;boolean&nbsp;TRUE&nbsp;if&nbsp;image&nbsp;is&nbsp;present&nbsp;in&nbsp;the&nbsp;storage&nbsp;or&nbsp;FALSE&nbsp;otherwise<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">contains</span><span class="hk">(</span><span class="hd">Meta&nbsp;$meta</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">file_exists</span><span class="hk">(</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">createFilename</span><span class="hk">(</span><span class="hd">$meta</span><span class="hk">));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Stores&nbsp;the&nbsp;given&nbsp;uploaded&nbsp;file.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;FileUpload&nbsp;$upload<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;meta&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$meta<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;ImageStorage&nbsp;Fluent&nbsp;interface<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;AbortException<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">upload</span><span class="hk">(</span><span class="hd">FileUpload&nbsp;$upload</span><span class="hk">,&nbsp;</span><span class="hd">Meta&nbsp;$meta</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span class="hd">$upload</span><span class="hk">-&gt;</span><span class="hd">getError</span><span class="hk">())&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span class="hd">UploaderException</span><span class="hk">(</span><span class="hd">$upload</span><span class="hk">-&gt;</span><span class="hd">getError</span><span class="hk">());<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$source&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$upload</span><span class="hk">-&gt;</span><span class="hd">getTemporaryFile</span><span class="hk">();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">readMeta</span><span class="hk">(</span><span class="hd">$source</span><span class="hk">,&nbsp;</span><span class="hd">$meta</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$target&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">createFilename</span><span class="hk">(</span><span class="hd">$meta</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">contains</span><span class="hk">(</span><span class="hd">$meta</span><span class="hk">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$image&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">Image</span><span class="hk">::</span><span class="hd">fromFile</span><span class="hk">(</span><span class="hd">$source</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$image</span><span class="hk">-&gt;</span><span class="hd">resize</span><span class="hk">(</span><span class="hd">1920</span><span class="hk">,&nbsp;</span><span class="hd">1080</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$image</span><span class="hk">-&gt;</span><span class="hd">save</span><span class="hk">(</span><span class="hd">$target</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span class="hd">file_exists</span><span class="hk">(</span><span class="hd">$source</span><span class="hk">))&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">unlink</span><span class="hk">(</span><span class="hd">$source</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;URL&nbsp;of&nbsp;the&nbsp;cached&nbsp;version&nbsp;of&nbsp;the&nbsp;image.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;Request&nbsp;$request&nbsp;The&nbsp;image&nbsp;request<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string&nbsp;&nbsp;The&nbsp;URL&nbsp;of&nbsp;the&nbsp;image<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">link</span><span class="hk">(</span><span class="hd">Request&nbsp;$request</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">checkImage</span><span class="hk">(</span><span class="hd">$request</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$filePath&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">createFilePath</span><span class="hk">(</span><span class="hd">$request</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hs">"</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">baseUrl$filePath</span><span class="hs">"</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;the&nbsp;file&nbsp;download&nbsp;HTTP&nbsp;response&nbsp;which&nbsp;can&nbsp;be&nbsp;easily&nbsp;sent&nbsp;using&nbsp;the&nbsp;`send()`&nbsp;method.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;Request&nbsp;$request&nbsp;The&nbsp;image&nbsp;request<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;FileResponse<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">download</span><span class="hk">(</span><span class="hd">Request&nbsp;$request</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">checkImage</span><span class="hk">(</span><span class="hd">$request</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$filename&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">createCacheFilename</span><span class="hk">(</span><span class="hd">$request</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;</span><span class="hd">FileResponse</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">,&nbsp;</span><span class="hd">basename</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">),&nbsp;</span><span class="hd">$request</span><span class="hk">-&gt;</span><span class="hd">getMeta</span><span class="hk">()-&gt;</span><span class="hd">getType</span><span class="hk">());<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Renders&nbsp;the&nbsp;image&nbsp;directly&nbsp;to&nbsp;the&nbsp;standard&nbsp;output.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;Request&nbsp;$request&nbsp;The&nbsp;image&nbsp;request<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;ImageStorage&nbsp;Fluent&nbsp;interface<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">send</span><span class="hk">(</span><span class="hd">Request&nbsp;$request</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">checkImage</span><span class="hk">(</span><span class="hd">$request</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$filename&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">createCacheFilename</span><span class="hk">(</span><span class="hd">$request</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$fp&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">fopen</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">,&nbsp;</span><span class="hs">'r'</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">header</span><span class="hk">(</span><span class="hs">"Content-type:&nbsp;"&nbsp;</span><span class="hk">.&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">getMimeType</span><span class="hk">(</span><span class="hd">$request</span><span class="hk">-&gt;</span><span class="hd">getMeta</span><span class="hk">()-&gt;</span><span class="hd">getType</span><span class="hk">()));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">fpassthru</span><span class="hk">(</span><span class="hd">$fp</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">fclose</span><span class="hk">(</span><span class="hd">$fp</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Flushes&nbsp;the&nbsp;entire&nbsp;cache&nbsp;by&nbsp;erasing&nbsp;the&nbsp;cache&nbsp;directory&nbsp;contents.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;ImageStorage&nbsp;Fluent&nbsp;interface<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">flush</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">cacheDirectory</span><span class="hk">-&gt;</span><span class="hd">erase</span><span class="hk">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Checks&nbsp;that&nbsp;the&nbsp;cached&nbsp;version&nbsp;of&nbsp;the&nbsp;image&nbsp;exists&nbsp;and&nbsp;creates&nbsp;it&nbsp;if&nbsp;not.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;Request&nbsp;$request&nbsp;The&nbsp;image&nbsp;request<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string&nbsp;&nbsp;The&nbsp;file&nbsp;name&nbsp;of&nbsp;the&nbsp;existing&nbsp;cached&nbsp;version&nbsp;of&nbsp;an&nbsp;image<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;function&nbsp;</span><span class="hd">checkImage</span><span class="hk">(</span><span class="hd">Request&nbsp;$request</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$filename&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">createCacheFilename</span><span class="hk">(</span><span class="hd">$request</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span class="hd">file_exists</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">))&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$meta&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$request</span><span class="hk">-&gt;</span><span class="hd">getMeta</span><span class="hk">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">contains</span><span class="hk">(</span><span class="hd">$meta</span><span class="hk">))&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">//&nbsp;Use&nbsp;another&nbsp;meta<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$meta&nbsp;</span><span class="hk">=&nbsp;new&nbsp;</span><span class="hd">EmptyImage</span><span class="hk">();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$request</span><span class="hk">-&gt;</span><span class="hd">setMeta</span><span class="hk">(</span><span class="hd">$meta</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$filename&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">createCacheFilename</span><span class="hk">(</span><span class="hd">$request</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$original&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">original</span><span class="hk">(</span><span class="hd">$meta</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span class="hd">$request</span><span class="hk">-&gt;</span><span class="hd">getCrop</span><span class="hk">())&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$image&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">crop</span><span class="hk">(</span><span class="hd">$original</span><span class="hk">,&nbsp;</span><span class="hd">$request</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$image&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">resize</span><span class="hk">(</span><span class="hd">$original</span><span class="hk">,&nbsp;</span><span class="hd">$request</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;</span><span class="hd">Directory</span><span class="hk">(</span><span class="hd">dirname</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$image</span><span class="hk">-&gt;</span><span class="hd">save</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">,&nbsp;</span><span class="hd">75</span><span class="hk">,&nbsp;</span><span class="hd">$meta</span><span class="hk">-&gt;</span><span class="hd">getType</span><span class="hk">());<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;file&nbsp;name&nbsp;of&nbsp;the&nbsp;cached&nbsp;version&nbsp;of&nbsp;the&nbsp;image.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;Request&nbsp;$request<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string&nbsp;The&nbsp;file&nbsp;name&nbsp;of&nbsp;the&nbsp;cached&nbsp;version&nbsp;of&nbsp;the&nbsp;image<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;function&nbsp;</span><span class="hd">createCacheFilename</span><span class="hk">(</span><span class="hd">Request&nbsp;$request</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$filePath&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">createFilePath</span><span class="hk">(</span><span class="hd">$request</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hs">"</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">cacheDirectory</span><span class="hs">/</span><span class="hd">$filePath</span><span class="hs">"</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Crops&nbsp;the&nbsp;given&nbsp;image&nbsp;using&nbsp;the&nbsp;given&nbsp;image&nbsp;request&nbsp;options.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;Image&nbsp;&nbsp;&nbsp;$image&nbsp;&nbsp;&nbsp;The&nbsp;image&nbsp;to&nbsp;resize<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;Request&nbsp;$request&nbsp;The&nbsp;image&nbsp;request<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;Image&nbsp;&nbsp;&nbsp;The&nbsp;image&nbsp;thumbnail<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;function&nbsp;</span><span class="hd">crop</span><span class="hk">(</span><span class="hd">Image&nbsp;$image</span><span class="hk">,&nbsp;</span><span class="hd">Request&nbsp;$request</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span class="hd">$request</span><span class="hk">-&gt;</span><span class="hd">getDimensions</span><span class="hk">()&nbsp;===&nbsp;</span><span class="hd">Request</span><span class="hk">::</span><span class="hd">ORIGINAL</span><span class="hk">)&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$image</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list(</span><span class="hd">$width</span><span class="hk">,&nbsp;</span><span class="hd">$height</span><span class="hk">)&nbsp;=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">processDimensions</span><span class="hk">(</span><span class="hd">$request</span><span class="hk">-&gt;</span><span class="hd">getDimensions</span><span class="hk">());<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$resizeWidth&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$width</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$resizeHeight&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$height</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$originalWidth&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$request</span><span class="hk">-&gt;</span><span class="hd">getMeta</span><span class="hk">()-&gt;</span><span class="hd">getWidth</span><span class="hk">();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$originalHeight&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$request</span><span class="hk">-&gt;</span><span class="hd">getMeta</span><span class="hk">()-&gt;</span><span class="hd">getHeight</span><span class="hk">();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$originalLandscape&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$originalWidth&nbsp;</span><span class="hk">&gt;&nbsp;</span><span class="hd">$originalHeight</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$cropLandscape&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$width&nbsp;</span><span class="hk">&gt;&nbsp;</span><span class="hd">$height</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$equals&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$width&nbsp;</span><span class="hk">===&nbsp;</span><span class="hd">$height</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span class="hd">$originalLandscape</span><span class="hk">)&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span class="hd">$cropLandscape</span><span class="hk">)&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$coefficient&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$originalHeight&nbsp;</span><span class="hk">/&nbsp;</span><span class="hd">$height</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$scaledWidth&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">round</span><span class="hk">(</span><span class="hd">$originalWidth&nbsp;</span><span class="hk">/&nbsp;</span><span class="hd">$coefficient</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$left&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">round</span><span class="hk">((</span><span class="hd">$scaledWidth&nbsp;</span><span class="hk">-&nbsp;</span><span class="hd">$width</span><span class="hk">)&nbsp;/&nbsp;</span><span class="hd">2</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$top&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">0</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span class="hd">$scaledWidth&nbsp;</span><span class="hk">&lt;&nbsp;</span><span class="hd">$width</span><span class="hk">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$coefficient&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$originalWidth&nbsp;</span><span class="hk">/&nbsp;</span><span class="hd">$width</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$scaledHeight&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">round</span><span class="hk">(</span><span class="hd">$originalHeight&nbsp;</span><span class="hk">/&nbsp;</span><span class="hd">$coefficient</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$left&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">0</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$top&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">round</span><span class="hk">((</span><span class="hd">$scaledHeight&nbsp;</span><span class="hk">-&nbsp;</span><span class="hd">$height</span><span class="hk">)&nbsp;/&nbsp;</span><span class="hd">2</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$coefficient&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$originalHeight&nbsp;</span><span class="hk">/&nbsp;</span><span class="hd">$height</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$scaledWidth&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">round</span><span class="hk">(</span><span class="hd">$originalWidth&nbsp;</span><span class="hk">/&nbsp;</span><span class="hd">$coefficient</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$left&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">round</span><span class="hk">((</span><span class="hd">$scaledWidth&nbsp;</span><span class="hk">-&nbsp;</span><span class="hd">$width</span><span class="hk">)&nbsp;/&nbsp;</span><span class="hd">2</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$top&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">0</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span class="hd">$cropLandscape&nbsp;</span><span class="hk">||&nbsp;</span><span class="hd">$equals</span><span class="hk">)&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$coefficient&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$originalWidth&nbsp;</span><span class="hk">/&nbsp;</span><span class="hd">$width</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$scaledHeight&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">round</span><span class="hk">(</span><span class="hd">$originalHeight&nbsp;</span><span class="hk">/&nbsp;</span><span class="hd">$coefficient</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$left&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">0</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$top&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">round</span><span class="hk">((</span><span class="hd">$scaledHeight&nbsp;</span><span class="hk">-&nbsp;</span><span class="hd">$height</span><span class="hk">)&nbsp;/&nbsp;</span><span class="hd">2</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$coefficient&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$originalHeight&nbsp;</span><span class="hk">/&nbsp;</span><span class="hd">$height</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$scaledWidth&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">round</span><span class="hk">(</span><span class="hd">$originalWidth&nbsp;</span><span class="hk">/&nbsp;</span><span class="hd">$coefficient</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$left&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">round</span><span class="hk">((</span><span class="hd">$scaledWidth&nbsp;</span><span class="hk">-&nbsp;</span><span class="hd">$width</span><span class="hk">)&nbsp;/&nbsp;</span><span class="hd">2</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$top&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">0</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$image</span><span class="hk">-&gt;</span><span class="hd">resize</span><span class="hk">(</span><span class="hd">$resizeWidth</span><span class="hk">,&nbsp;</span><span class="hd">$resizeHeight</span><span class="hk">,&nbsp;</span><span class="hd">Image</span><span class="hk">::</span><span class="hd">FILL</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$image</span><span class="hk">-&gt;</span><span class="hd">crop</span><span class="hk">(</span><span class="hd">$left</span><span class="hk">,&nbsp;</span><span class="hd">$top</span><span class="hk">,&nbsp;</span><span class="hd">$width</span><span class="hk">,&nbsp;</span><span class="hd">$height</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$image</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Resizes&nbsp;the&nbsp;given&nbsp;image&nbsp;to&nbsp;the&nbsp;given&nbsp;dimensions&nbsp;using&nbsp;given&nbsp;flags.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;Image&nbsp;&nbsp;&nbsp;$image&nbsp;&nbsp;&nbsp;The&nbsp;image&nbsp;to&nbsp;resize<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;Request&nbsp;$request&nbsp;The&nbsp;image&nbsp;request<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;Image&nbsp;&nbsp;&nbsp;The&nbsp;image&nbsp;thumbnail<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;function&nbsp;</span><span class="hd">resize</span><span class="hk">(</span><span class="hd">Image&nbsp;$image</span><span class="hk">,&nbsp;</span><span class="hd">Request&nbsp;$request</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span class="hd">$request</span><span class="hk">-&gt;</span><span class="hd">getDimensions</span><span class="hk">()&nbsp;===&nbsp;</span><span class="hd">Request</span><span class="hk">::</span><span class="hd">ORIGINAL</span><span class="hk">)&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$image</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list(</span><span class="hd">$width</span><span class="hk">,&nbsp;</span><span class="hd">$height</span><span class="hk">)&nbsp;=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">processDimensions</span><span class="hk">(</span><span class="hd">$request</span><span class="hk">-&gt;</span><span class="hd">getDimensions</span><span class="hk">());<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$image</span><span class="hk">-&gt;</span><span class="hd">resize</span><span class="hk">(</span><span class="hd">$width</span><span class="hk">,&nbsp;</span><span class="hd">$height</span><span class="hk">,&nbsp;</span><span class="hd">$request</span><span class="hk">-&gt;</span><span class="hd">getFlags</span><span class="hk">());<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;part&nbsp;of&nbsp;the&nbsp;image&nbsp;filename&nbsp;relative&nbsp;to&nbsp;the&nbsp;cache&nbsp;directory.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;Request&nbsp;$request&nbsp;The&nbsp;image&nbsp;request<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;function&nbsp;</span><span class="hd">createFilePath</span><span class="hk">(</span><span class="hd">Request&nbsp;$request</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$dimensions&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$request</span><span class="hk">-&gt;</span><span class="hd">getDimensions</span><span class="hk">();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$flags&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$request</span><span class="hk">-&gt;</span><span class="hd">getFlags</span><span class="hk">();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$crop&nbsp;</span><span class="hk">=&nbsp;(int)&nbsp;</span><span class="hd">$request</span><span class="hk">-&gt;</span><span class="hd">getCrop</span><span class="hk">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$meta&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$request</span><span class="hk">-&gt;</span><span class="hd">getMeta</span><span class="hk">();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$ext&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">getExtension</span><span class="hk">(</span><span class="hd">$meta</span><span class="hk">-&gt;</span><span class="hd">getType</span><span class="hk">());<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$baseFilePath&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">createCacheDirectoryPath</span><span class="hk">(</span><span class="hd">$meta</span><span class="hk">-&gt;</span><span class="hd">getHash</span><span class="hk">());<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hs">"</span><span class="hd">$baseFilePath</span><span class="hs">.</span><span class="hd">$dimensions</span><span class="hs">.</span><span class="hd">$flags</span><span class="hs">.</span><span class="hd">$crop</span><span class="hs">.</span><span class="hd">$ext</span><span class="hs">"</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Parses&nbsp;the&nbsp;given&nbsp;dimensions&nbsp;string&nbsp;for&nbsp;the&nbsp;image&nbsp;width&nbsp;and&nbsp;height.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;string&nbsp;$dimensions&nbsp;The&nbsp;dimensions&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;array&nbsp;&nbsp;The&nbsp;width&nbsp;and&nbsp;height&nbsp;of&nbsp;the&nbsp;image&nbsp;in&nbsp;pixels<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;function&nbsp;</span><span class="hd">processDimensions</span><span class="hk">(</span><span class="hd">$dimensions</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span class="hd">strpos</span><span class="hk">(</span><span class="hd">$dimensions</span><span class="hk">,&nbsp;</span><span class="hs">'x'</span><span class="hk">)&nbsp;!==&nbsp;</span><span class="hd">FALSE</span><span class="hk">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list(</span><span class="hd">$width</span><span class="hk">,&nbsp;</span><span class="hd">$height</span><span class="hk">)&nbsp;=&nbsp;</span><span class="hd">explode</span><span class="hk">(</span><span class="hs">'x'</span><span class="hk">,&nbsp;</span><span class="hd">$dimensions</span><span class="hk">);&nbsp;</span><span class="hc">//&nbsp;different&nbsp;dimensions,&nbsp;eg.&nbsp;"210x150"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$width&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">intval</span><span class="hk">(</span><span class="hd">$width</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$height&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">intval</span><span class="hk">(</span><span class="hd">$height</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$width&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">intval</span><span class="hk">(</span><span class="hd">$dimensions</span><span class="hk">);&nbsp;</span><span class="hc">//&nbsp;same&nbsp;dimensions,&nbsp;eg.&nbsp;"210"&nbsp;=&gt;&nbsp;210x210<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$height&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$width</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array(</span><span class="hd">$width</span><span class="hk">,&nbsp;</span><span class="hd">$height</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;the&nbsp;internal&nbsp;directory&nbsp;path&nbsp;from&nbsp;the&nbsp;given&nbsp;hash.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Some&nbsp;special&nbsp;images&nbsp;like&nbsp;the&nbsp;"Image&nbsp;Not&nbsp;Available"&nbsp;image&nbsp;are&nbsp;stored<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;in&nbsp;directories&nbsp;prefixed&nbsp;with&nbsp;an&nbsp;underscore.&nbsp;Those&nbsp;directories&nbsp;are&nbsp;not<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;fragmented&nbsp;to&nbsp;hash&nbsp;based&nbsp;structure.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;string&nbsp;$hash&nbsp;Tha&nbsp;SHA1&nbsp;hash<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;function&nbsp;</span><span class="hd">createCacheDirectoryPath</span><span class="hk">(</span><span class="hd">$hash</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span class="hd">$hash</span><span class="hk">{</span><span class="hd">0</span><span class="hk">}&nbsp;===&nbsp;</span><span class="hs">'_'</span><span class="hk">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hs">"</span><span class="hd">$hash</span><span class="hs">/</span><span class="hd">$hash</span><span class="hs">"</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hs">"</span><span class="hd">$hash</span><span class="hk">[</span><span class="hd">0</span><span class="hk">]</span><span class="hd">$hash</span><span class="hk">[</span><span class="hd">1</span><span class="hk">]</span><span class="hs">/</span><span class="hd">$hash</span><span class="hk">[</span><span class="hd">2</span><span class="hk">]</span><span class="hd">$hash</span><span class="hk">[</span><span class="hd">3</span><span class="hk">]</span><span class="hs">"&nbsp;</span><span class="hk">.&nbsp;</span><span class="hs">'/'&nbsp;</span><span class="hk">.&nbsp;</span><span class="hd">$hash</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;image&nbsp;MIME&nbsp;type&nbsp;according&nbsp;to&nbsp;the&nbsp;given&nbsp;image&nbsp;type.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;integer&nbsp;$imageType&nbsp;Image&nbsp;type<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">protected&nbsp;function&nbsp;</span><span class="hd">getMimeType</span><span class="hk">(</span><span class="hd">$imageType</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">mimeTypes</span><span class="hk">[</span><span class="hd">$imageType</span><span class="hk">];<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;original&nbsp;stored&nbsp;image&nbsp;filename.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;Meta&nbsp;$meta&nbsp;Image&nbsp;meta&nbsp;information<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">file</span><span class="hk">(</span><span class="hd">Meta&nbsp;$meta</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">createFilename</span><span class="hk">(</span><span class="hd">$meta</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;public&nbsp;accessible&nbsp;cache&nbsp;directory&nbsp;URL.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">getBaseUrl</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">baseUrl</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Sets&nbsp;the&nbsp;public&nbsp;accessible&nbsp;cache&nbsp;directory&nbsp;URL.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;$baseUrl<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;$this<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">setBaseUrl</span><span class="hk">(</span><span class="hd">$baseUrl</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span class="hd">Strings</span><span class="hk">::</span><span class="hd">endsWith</span><span class="hk">(</span><span class="hd">$baseUrl</span><span class="hk">,&nbsp;</span><span class="hs">'/'</span><span class="hk">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$baseUrl&nbsp;</span><span class="hk">.=&nbsp;</span><span class="hs">'/'</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">baseUrl&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$baseUrl</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />}<br /></span>
</span>
</code>		</div>
		</div>
	</div>
		<div>
		<table>
		<tr>
			<td class="number"><small>100 %</small></td>
			<td><div class="bar"><div style="width: 100%"></div></div></td>
			<td><a href="#F6" class="toggle">ImageStore/Macro/ImageMacro.php</a></td>
		</tr>
		</table>

		<div class="code" id="F6">
		<div>
			<aside>
			<div><a href='#F6L1' id='F6L1'>   1</a>
<a href='#F6L2' id='F6L2'>   2</a>
<a href='#F6L3' id='F6L3'>   3</a>
<a href='#F6L4' id='F6L4'>   4</a>
<a href='#F6L5' id='F6L5'>   5</a>
<a href='#F6L6' id='F6L6'>   6</a>
<a href='#F6L7' id='F6L7'>   7</a>
<a href='#F6L8' id='F6L8'>   8</a>
<a href='#F6L9' id='F6L9'>   9</a>
<a href='#F6L10' id='F6L10'>  10</a>
<a href='#F6L11' id='F6L11'>  11</a>
<a href='#F6L12' id='F6L12'>  12</a>
<a href='#F6L13' id='F6L13'>  13</a>
<a href='#F6L14' id='F6L14'>  14</a></div><div class='t'><a href='#F6L15' id='F6L15'>  15</a></div><div><a href='#F6L16' id='F6L16'>  16</a>
<a href='#F6L17' id='F6L17'>  17</a>
<a href='#F6L18' id='F6L18'>  18</a>
<a href='#F6L19' id='F6L19'>  19</a>
<a href='#F6L20' id='F6L20'>  20</a>
<a href='#F6L21' id='F6L21'>  21</a>
<a href='#F6L22' id='F6L22'>  22</a>
<a href='#F6L23' id='F6L23'>  23</a>
<a href='#F6L24' id='F6L24'>  24</a>
<a href='#F6L25' id='F6L25'>  25</a></div><div class='t'><a href='#F6L26' id='F6L26'>  26</a>
<a href='#F6L27' id='F6L27'>  27</a>
<a href='#F6L28' id='F6L28'>  28</a></div><div><a href='#F6L29' id='F6L29'>  29</a>
<a href='#F6L30' id='F6L30'>  30</a>
<a href='#F6L31' id='F6L31'>  31</a>
<a href='#F6L32' id='F6L32'>  32</a>
<a href='#F6L33' id='F6L33'>  33</a>
<a href='#F6L34' id='F6L34'>  34</a>
<a href='#F6L35' id='F6L35'>  35</a></div><div class='t'><a href='#F6L36' id='F6L36'>  36</a>
<a href='#F6L37' id='F6L37'>  37</a>
<a href='#F6L38' id='F6L38'>  38</a>
<a href='#F6L39' id='F6L39'>  39</a>
<a href='#F6L40' id='F6L40'>  40</a></div><div><a href='#F6L41' id='F6L41'>  41</a>
<a href='#F6L42' id='F6L42'>  42</a>
<a href='#F6L43' id='F6L43'>  43</a>
<a href='#F6L44' id='F6L44'>  44</a>
<a href='#F6L45' id='F6L45'>  45</a>
<a href='#F6L46' id='F6L46'>  46</a>
<a href='#F6L47' id='F6L47'>  47</a>
<a href='#F6L48' id='F6L48'>  48</a>
<a href='#F6L49' id='F6L49'>  49</a>
<a href='#F6L50' id='F6L50'>  50</a>
<a href='#F6L51' id='F6L51'>  51</a></div><div class='t'><a href='#F6L52' id='F6L52'>  52</a></div><div class='dead'><a href='#F6L53' id='F6L53'>  53</a></div><div><a href='#F6L54' id='F6L54'>  54</a>
<a href='#F6L55' id='F6L55'>  55</a>
<a href='#F6L56' id='F6L56'>  56</a>
<a href='#F6L57' id='F6L57'>  57</a>
<a href='#F6L58' id='F6L58'>  58</a>
<a href='#F6L59' id='F6L59'>  59</a>
<a href='#F6L60' id='F6L60'>  60</a>
<a href='#F6L61' id='F6L61'>  61</a>
<a href='#F6L62' id='F6L62'>  62</a>
<a href='#F6L63' id='F6L63'>  63</a>
<a href='#F6L64' id='F6L64'>  64</a></div><div class='t'><a href='#F6L65' id='F6L65'>  65</a></div><div class='dead'><a href='#F6L66' id='F6L66'>  66</a></div><div><a href='#F6L67' id='F6L67'>  67</a>
<a href='#F6L68' id='F6L68'>  68</a>
<a href='#F6L69' id='F6L69'>  69</a>
<a href='#F6L70' id='F6L70'>  70</a>
<a href='#F6L71' id='F6L71'>  71</a>
<a href='#F6L72' id='F6L72'>  72</a>
<a href='#F6L73' id='F6L73'>  73</a>
<a href='#F6L74' id='F6L74'>  74</a>
<a href='#F6L75' id='F6L75'>  75</a>
<a href='#F6L76' id='F6L76'>  76</a>
<a href='#F6L77' id='F6L77'>  77</a></div><div class='t'><a href='#F6L78' id='F6L78'>  78</a></div><div class='dead'><a href='#F6L79' id='F6L79'>  79</a></div><div><a href='#F6L80' id='F6L80'>  80</a>
<a href='#F6L81' id='F6L81'>  81</a>
<a href='#F6L82' id='F6L82'>  82</a>
<a href='#F6L83' id='F6L83'>  83</a>
<a href='#F6L84' id='F6L84'>  84</a>
<a href='#F6L85' id='F6L85'>  85</a>
<a href='#F6L86' id='F6L86'>  86</a>
<a href='#F6L87' id='F6L87'>  87</a>
<a href='#F6L88' id='F6L88'>  88</a>
<a href='#F6L89' id='F6L89'>  89</a>
<a href='#F6L90' id='F6L90'>  90</a></div><div class='t'><a href='#F6L91' id='F6L91'>  91</a></div><div class='dead'><a href='#F6L92' id='F6L92'>  92</a></div><div><a href='#F6L93' id='F6L93'>  93</a>
<a href='#F6L94' id='F6L94'>  94</a>
<a href='#F6L95' id='F6L95'>  95</a>
<a href='#F6L96' id='F6L96'>  96</a>
<a href='#F6L97' id='F6L97'>  97</a>
<a href='#F6L98' id='F6L98'>  98</a>
<a href='#F6L99' id='F6L99'>  99</a>
<a href='#F6L100' id='F6L100'> 100</a>
<a href='#F6L101' id='F6L101'> 101</a>
<a href='#F6L102' id='F6L102'> 102</a>
<a href='#F6L103' id='F6L103'> 103</a></div><div class='t'><a href='#F6L104' id='F6L104'> 104</a></div><div class='dead'><a href='#F6L105' id='F6L105'> 105</a></div><div><a href='#F6L106' id='F6L106'> 106</a>
<a href='#F6L107' id='F6L107'> 107</a>
<a href='#F6L108' id='F6L108'> 108</a>
<a href='#F6L109' id='F6L109'> 109</a>
<a href='#F6L110' id='F6L110'> 110</a>
<a href='#F6L111' id='F6L111'> 111</a>
<a href='#F6L112' id='F6L112'> 112</a>
<a href='#F6L113' id='F6L113'> 113</a>
<a href='#F6L114' id='F6L114'> 114</a>
<a href='#F6L115' id='F6L115'> 115</a>
<a href='#F6L116' id='F6L116'> 116</a></div><div class='t'><a href='#F6L117' id='F6L117'> 117</a></div><div class='dead'><a href='#F6L118' id='F6L118'> 118</a></div><div><a href='#F6L119' id='F6L119'> 119</a>
<a href='#F6L120' id='F6L120'> 120</a>
</div>			</aside>
			<code style='margin-left: 4em'><span class="hh">
<span class="hd">&lt;?php<br /><br /></span><span class="hk">namespace&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Macro</span><span class="hk">;<br /><br /><br />use&nbsp;</span><span class="hd">Latte</span><span class="hk">\</span><span class="hd">Compiler</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Latte</span><span class="hk">\</span><span class="hd">MacroNode</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Latte</span><span class="hk">\</span><span class="hd">Macros</span><span class="hk">\</span><span class="hd">MacroSet</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Latte</span><span class="hk">\</span><span class="hd">PhpWriter</span><span class="hk">;<br /><br /></span><span class="hc">/**<br />&nbsp;*&nbsp;Latte&nbsp;template&nbsp;engine&nbsp;image&nbsp;macros<br />&nbsp;*/<br /></span><span class="hk">class&nbsp;</span><span class="hd">ImageMacro&nbsp;</span><span class="hk">extends&nbsp;</span><span class="hd">MacroSet<br /></span><span class="hk">{<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Installs&nbsp;the&nbsp;macro&nbsp;set&nbsp;into&nbsp;the&nbsp;template&nbsp;compiler.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;Compiler&nbsp;$compiler<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;void|static<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;static&nbsp;function&nbsp;</span><span class="hd">install</span><span class="hk">(</span><span class="hd">Compiler&nbsp;$compiler</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$macroSet&nbsp;</span><span class="hk">=&nbsp;new&nbsp;static(</span><span class="hd">$compiler</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$macroSet</span><span class="hk">-&gt;</span><span class="hd">setup</span><span class="hk">();<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Sets&nbsp;the&nbsp;template&nbsp;macros&nbsp;up.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">setup</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">addMacro</span><span class="hk">(</span><span class="hs">'src'</span><span class="hk">,&nbsp;</span><span class="hd">NULL</span><span class="hk">,&nbsp;</span><span class="hd">NULL</span><span class="hk">,&nbsp;[</span><span class="hd">$this</span><span class="hk">,&nbsp;</span><span class="hs">'macroSrc'</span><span class="hk">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">addMacro</span><span class="hk">(</span><span class="hs">'bg'</span><span class="hk">,&nbsp;</span><span class="hd">NULL</span><span class="hk">,&nbsp;</span><span class="hd">NULL</span><span class="hk">,&nbsp;[</span><span class="hd">$this</span><span class="hk">,&nbsp;</span><span class="hs">'macroBg'</span><span class="hk">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">addMacro</span><span class="hk">(</span><span class="hs">'image'</span><span class="hk">,&nbsp;[</span><span class="hd">$this</span><span class="hk">,&nbsp;</span><span class="hs">'macroImageBegin'</span><span class="hk">],&nbsp;</span><span class="hd">NULL</span><span class="hk">,&nbsp;[</span><span class="hd">$this</span><span class="hk">,&nbsp;</span><span class="hs">'macroImage'</span><span class="hk">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">addMacro</span><span class="hk">(</span><span class="hs">'crop'</span><span class="hk">,&nbsp;[</span><span class="hd">$this</span><span class="hk">,&nbsp;</span><span class="hs">'macroCropBegin'</span><span class="hk">],&nbsp;</span><span class="hd">NULL</span><span class="hk">,&nbsp;[</span><span class="hd">$this</span><span class="hk">,&nbsp;</span><span class="hs">'macroCrop'</span><span class="hk">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Renders&nbsp;the&nbsp;`n:src="$image"`&nbsp;macro.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;MacroNode&nbsp;$node<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;PhpWriter&nbsp;$writer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">macroBg</span><span class="hk">(</span><span class="hd">MacroNode&nbsp;$node</span><span class="hk">,&nbsp;</span><span class="hd">PhpWriter&nbsp;$writer</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$writer</span><span class="hk">-&gt;</span><span class="hd">write</span><span class="hk">(</span><span class="hs">'&nbsp;?&gt;&nbsp;style="background-image:&nbsp;url(\'&lt;?php&nbsp;$imageRequest&nbsp;=&nbsp;Rostenkowski\ImageStore\Requests\ImageRequest::crop(%node.word,&nbsp;%node.array?);&nbsp;echo&nbsp;%escape($__imagestore-&gt;link($imageRequest));&nbsp;?&gt;\');"&lt;?php&nbsp;'</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Renders&nbsp;the&nbsp;`n:crop="$image"`&nbsp;macro.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;MacroNode&nbsp;$node<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;PhpWriter&nbsp;$writer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">macroCrop</span><span class="hk">(</span><span class="hd">MacroNode&nbsp;$node</span><span class="hk">,&nbsp;</span><span class="hd">PhpWriter&nbsp;$writer</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$writer</span><span class="hk">-&gt;</span><span class="hd">write</span><span class="hk">(</span><span class="hs">'&nbsp;?&gt;&nbsp;src="&lt;?php&nbsp;$imageRequest&nbsp;=&nbsp;Rostenkowski\ImageStore\Requests\ImageRequest::crop(%node.word,&nbsp;%node.array?);&nbsp;echo&nbsp;%escape($__imagestore-&gt;link($imageRequest));&nbsp;?&gt;"&lt;?php&nbsp;'</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Renders&nbsp;the&nbsp;`{crop&nbsp;$image&nbsp;...}`&nbsp;macro.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;MacroNode&nbsp;$node<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;PhpWriter&nbsp;$writer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">macroCropBegin</span><span class="hk">(</span><span class="hd">MacroNode&nbsp;$node</span><span class="hk">,&nbsp;</span><span class="hd">PhpWriter&nbsp;$writer</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$writer</span><span class="hk">-&gt;</span><span class="hd">write</span><span class="hk">(</span><span class="hs">'$imageRequest&nbsp;=&nbsp;Rostenkowski\ImageStore\Requests\ImageRequest::crop(%node.word,&nbsp;%node.array?);&nbsp;echo&nbsp;%escape($__imagestore-&gt;link($imageRequest));'</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Renders&nbsp;the&nbsp;`n:image="$image"`&nbsp;macro.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;MacroNode&nbsp;$node<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;PhpWriter&nbsp;$writer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">macroImage</span><span class="hk">(</span><span class="hd">MacroNode&nbsp;$node</span><span class="hk">,&nbsp;</span><span class="hd">PhpWriter&nbsp;$writer</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$writer</span><span class="hk">-&gt;</span><span class="hd">write</span><span class="hk">(</span><span class="hs">'&nbsp;?&gt;&nbsp;href="&lt;?php&nbsp;$imageRequest&nbsp;=&nbsp;Rostenkowski\ImageStore\Requests\ImageRequest::fromMacro(%node.word,&nbsp;%node.array?);&nbsp;echo&nbsp;%escape($__imagestore-&gt;link($imageRequest));&nbsp;?&gt;"&lt;?php&nbsp;'</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Renders&nbsp;the&nbsp;`{image&nbsp;$image&nbsp;...}`&nbsp;macro.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;MacroNode&nbsp;$node<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;PhpWriter&nbsp;$writer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">macroImageBegin</span><span class="hk">(</span><span class="hd">MacroNode&nbsp;$node</span><span class="hk">,&nbsp;</span><span class="hd">PhpWriter&nbsp;$writer</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$writer</span><span class="hk">-&gt;</span><span class="hd">write</span><span class="hk">(</span><span class="hs">'$imageRequest&nbsp;=&nbsp;Rostenkowski\ImageStore\Requests\ImageRequest::fromMacro(%node.word,&nbsp;%node.array?);&nbsp;echo&nbsp;%escape($__imagestore-&gt;link($imageRequest));'</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Renders&nbsp;the&nbsp;`n:src="$image"`&nbsp;macro.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;MacroNode&nbsp;$node<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;PhpWriter&nbsp;$writer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">macroSrc</span><span class="hk">(</span><span class="hd">MacroNode&nbsp;$node</span><span class="hk">,&nbsp;</span><span class="hd">PhpWriter&nbsp;$writer</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$writer</span><span class="hk">-&gt;</span><span class="hd">write</span><span class="hk">(</span><span class="hs">'$imageRequest&nbsp;=&nbsp;Rostenkowski\ImageStore\Requests\ImageRequest::fromMacro(%node.word,&nbsp;%node.array?);&nbsp;?&gt;&nbsp;src="&lt;?php&nbsp;echo&nbsp;%escape($__imagestore-&gt;link($imageRequest));&nbsp;?&gt;"&lt;?php&nbsp;'</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />}<br /></span>
</span>
</code>		</div>
		</div>
	</div>
		<div>
		<table>
		<tr class='light'>
			<td class="number"><small>100 %</small></td>
			<td><div class="bar"><div style="width: 100%"></div></div></td>
			<td><a href="#F7" class="toggle">ImageStore/Request.php</a></td>
		</tr>
		</table>

		<div class="code" id="F7">
		<div>
			<aside>
			<div><a href='#F7L1' id='F7L1'>  1</a>
<a href='#F7L2' id='F7L2'>  2</a>
<a href='#F7L3' id='F7L3'>  3</a>
<a href='#F7L4' id='F7L4'>  4</a>
<a href='#F7L5' id='F7L5'>  5</a>
<a href='#F7L6' id='F7L6'>  6</a>
<a href='#F7L7' id='F7L7'>  7</a>
<a href='#F7L8' id='F7L8'>  8</a></div><div class='t'><a href='#F7L9' id='F7L9'>  9</a></div><div><a href='#F7L10' id='F7L10'> 10</a>
<a href='#F7L11' id='F7L11'> 11</a>
<a href='#F7L12' id='F7L12'> 12</a>
<a href='#F7L13' id='F7L13'> 13</a>
<a href='#F7L14' id='F7L14'> 14</a>
<a href='#F7L15' id='F7L15'> 15</a>
<a href='#F7L16' id='F7L16'> 16</a>
<a href='#F7L17' id='F7L17'> 17</a>
<a href='#F7L18' id='F7L18'> 18</a>
<a href='#F7L19' id='F7L19'> 19</a>
<a href='#F7L20' id='F7L20'> 20</a>
<a href='#F7L21' id='F7L21'> 21</a>
<a href='#F7L22' id='F7L22'> 22</a>
<a href='#F7L23' id='F7L23'> 23</a>
<a href='#F7L24' id='F7L24'> 24</a>
<a href='#F7L25' id='F7L25'> 25</a>
<a href='#F7L26' id='F7L26'> 26</a>
<a href='#F7L27' id='F7L27'> 27</a>
<a href='#F7L28' id='F7L28'> 28</a>
<a href='#F7L29' id='F7L29'> 29</a>
<a href='#F7L30' id='F7L30'> 30</a>
<a href='#F7L31' id='F7L31'> 31</a>
<a href='#F7L32' id='F7L32'> 32</a>
<a href='#F7L33' id='F7L33'> 33</a>
<a href='#F7L34' id='F7L34'> 34</a>
<a href='#F7L35' id='F7L35'> 35</a>
<a href='#F7L36' id='F7L36'> 36</a>
<a href='#F7L37' id='F7L37'> 37</a>
<a href='#F7L38' id='F7L38'> 38</a>
<a href='#F7L39' id='F7L39'> 39</a>
<a href='#F7L40' id='F7L40'> 40</a>
<a href='#F7L41' id='F7L41'> 41</a>
<a href='#F7L42' id='F7L42'> 42</a>
<a href='#F7L43' id='F7L43'> 43</a>
<a href='#F7L44' id='F7L44'> 44</a>
<a href='#F7L45' id='F7L45'> 45</a>
<a href='#F7L46' id='F7L46'> 46</a>
<a href='#F7L47' id='F7L47'> 47</a>
<a href='#F7L48' id='F7L48'> 48</a>
<a href='#F7L49' id='F7L49'> 49</a>
<a href='#F7L50' id='F7L50'> 50</a>
<a href='#F7L51' id='F7L51'> 51</a>
<a href='#F7L52' id='F7L52'> 52</a>
<a href='#F7L53' id='F7L53'> 53</a>
<a href='#F7L54' id='F7L54'> 54</a>
<a href='#F7L55' id='F7L55'> 55</a>
<a href='#F7L56' id='F7L56'> 56</a>
</div>			</aside>
			<code style='margin-left: 3em'><span class="hh">
<span class="hd">&lt;?php<br /><br /></span><span class="hk">namespace&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">;<br /><br /><br /></span><span class="hc">/**<br />&nbsp;*&nbsp;Image&nbsp;request&nbsp;interface<br />&nbsp;*/<br /></span><span class="hk">interface&nbsp;</span><span class="hd">Request<br /></span><span class="hk">{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;</span><span class="hd">ORIGINAL&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">0</span><span class="hk">;<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;requested&nbsp;image&nbsp;thumbnail&nbsp;cropping&nbsp;flag.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;integer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">getCrop</span><span class="hk">();<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;requested&nbsp;image&nbsp;thumbnail&nbsp;dimensions.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">getDimensions</span><span class="hk">();<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;requested&nbsp;image&nbsp;thumbnail&nbsp;flags.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;integer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">getFlags</span><span class="hk">();<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;requested&nbsp;image&nbsp;meta&nbsp;information.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;Meta<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">getMeta</span><span class="hk">();<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Sets&nbsp;the&nbsp;requested&nbsp;image&nbsp;meta&nbsp;information.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;Meta&nbsp;$meta<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;Request<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">setMeta</span><span class="hk">(</span><span class="hd">Meta&nbsp;$meta</span><span class="hk">);<br /><br /><br />}<br /></span>
</span>
</code>		</div>
		</div>
	</div>
		<div>
		<table>
		<tr>
			<td class="number"><small>100 %</small></td>
			<td><div class="bar"><div style="width: 100%"></div></div></td>
			<td><a href="#F8" class="toggle">ImageStore/Entity/ImageEntity.php</a></td>
		</tr>
		</table>

		<div class="code" id="F8">
		<div>
			<aside>
			<div><a href='#F8L1' id='F8L1'>   1</a>
<a href='#F8L2' id='F8L2'>   2</a>
<a href='#F8L3' id='F8L3'>   3</a>
<a href='#F8L4' id='F8L4'>   4</a>
<a href='#F8L5' id='F8L5'>   5</a>
<a href='#F8L6' id='F8L6'>   6</a>
<a href='#F8L7' id='F8L7'>   7</a>
<a href='#F8L8' id='F8L8'>   8</a>
<a href='#F8L9' id='F8L9'>   9</a>
<a href='#F8L10' id='F8L10'>  10</a>
<a href='#F8L11' id='F8L11'>  11</a>
<a href='#F8L12' id='F8L12'>  12</a>
<a href='#F8L13' id='F8L13'>  13</a>
<a href='#F8L14' id='F8L14'>  14</a>
<a href='#F8L15' id='F8L15'>  15</a>
<a href='#F8L16' id='F8L16'>  16</a></div><div class='t'><a href='#F8L17' id='F8L17'>  17</a></div><div><a href='#F8L18' id='F8L18'>  18</a>
<a href='#F8L19' id='F8L19'>  19</a>
<a href='#F8L20' id='F8L20'>  20</a>
<a href='#F8L21' id='F8L21'>  21</a>
<a href='#F8L22' id='F8L22'>  22</a>
<a href='#F8L23' id='F8L23'>  23</a>
<a href='#F8L24' id='F8L24'>  24</a>
<a href='#F8L25' id='F8L25'>  25</a>
<a href='#F8L26' id='F8L26'>  26</a>
<a href='#F8L27' id='F8L27'>  27</a>
<a href='#F8L28' id='F8L28'>  28</a>
<a href='#F8L29' id='F8L29'>  29</a>
<a href='#F8L30' id='F8L30'>  30</a>
<a href='#F8L31' id='F8L31'>  31</a>
<a href='#F8L32' id='F8L32'>  32</a>
<a href='#F8L33' id='F8L33'>  33</a>
<a href='#F8L34' id='F8L34'>  34</a>
<a href='#F8L35' id='F8L35'>  35</a>
<a href='#F8L36' id='F8L36'>  36</a>
<a href='#F8L37' id='F8L37'>  37</a>
<a href='#F8L38' id='F8L38'>  38</a>
<a href='#F8L39' id='F8L39'>  39</a>
<a href='#F8L40' id='F8L40'>  40</a>
<a href='#F8L41' id='F8L41'>  41</a>
<a href='#F8L42' id='F8L42'>  42</a>
<a href='#F8L43' id='F8L43'>  43</a>
<a href='#F8L44' id='F8L44'>  44</a>
<a href='#F8L45' id='F8L45'>  45</a>
<a href='#F8L46' id='F8L46'>  46</a>
<a href='#F8L47' id='F8L47'>  47</a>
<a href='#F8L48' id='F8L48'>  48</a>
<a href='#F8L49' id='F8L49'>  49</a>
<a href='#F8L50' id='F8L50'>  50</a>
<a href='#F8L51' id='F8L51'>  51</a>
<a href='#F8L52' id='F8L52'>  52</a>
<a href='#F8L53' id='F8L53'>  53</a>
<a href='#F8L54' id='F8L54'>  54</a>
<a href='#F8L55' id='F8L55'>  55</a></div><div class='t'><a href='#F8L56' id='F8L56'>  56</a></div><div class='dead'><a href='#F8L57' id='F8L57'>  57</a></div><div><a href='#F8L58' id='F8L58'>  58</a>
<a href='#F8L59' id='F8L59'>  59</a>
<a href='#F8L60' id='F8L60'>  60</a>
<a href='#F8L61' id='F8L61'>  61</a>
<a href='#F8L62' id='F8L62'>  62</a>
<a href='#F8L63' id='F8L63'>  63</a>
<a href='#F8L64' id='F8L64'>  64</a>
<a href='#F8L65' id='F8L65'>  65</a></div><div class='t'><a href='#F8L66' id='F8L66'>  66</a></div><div><a href='#F8L67' id='F8L67'>  67</a></div><div class='t'><a href='#F8L68' id='F8L68'>  68</a></div><div class='dead'><a href='#F8L69' id='F8L69'>  69</a></div><div><a href='#F8L70' id='F8L70'>  70</a>
<a href='#F8L71' id='F8L71'>  71</a>
<a href='#F8L72' id='F8L72'>  72</a>
<a href='#F8L73' id='F8L73'>  73</a>
<a href='#F8L74' id='F8L74'>  74</a>
<a href='#F8L75' id='F8L75'>  75</a>
<a href='#F8L76' id='F8L76'>  76</a></div><div class='t'><a href='#F8L77' id='F8L77'>  77</a></div><div class='dead'><a href='#F8L78' id='F8L78'>  78</a></div><div><a href='#F8L79' id='F8L79'>  79</a>
<a href='#F8L80' id='F8L80'>  80</a>
<a href='#F8L81' id='F8L81'>  81</a>
<a href='#F8L82' id='F8L82'>  82</a>
<a href='#F8L83' id='F8L83'>  83</a>
<a href='#F8L84' id='F8L84'>  84</a>
<a href='#F8L85' id='F8L85'>  85</a>
<a href='#F8L86' id='F8L86'>  86</a>
<a href='#F8L87' id='F8L87'>  87</a>
<a href='#F8L88' id='F8L88'>  88</a>
<a href='#F8L89' id='F8L89'>  89</a></div><div class='t'><a href='#F8L90' id='F8L90'>  90</a>
<a href='#F8L91' id='F8L91'>  91</a></div><div class='dead'><a href='#F8L92' id='F8L92'>  92</a></div><div class='t'><a href='#F8L93' id='F8L93'>  93</a>
<a href='#F8L94' id='F8L94'>  94</a>
<a href='#F8L95' id='F8L95'>  95</a></div><div class='dead'><a href='#F8L96' id='F8L96'>  96</a></div><div><a href='#F8L97' id='F8L97'>  97</a></div><div class='t'><a href='#F8L98' id='F8L98'>  98</a></div><div class='dead'><a href='#F8L99' id='F8L99'>  99</a></div><div><a href='#F8L100' id='F8L100'> 100</a>
<a href='#F8L101' id='F8L101'> 101</a>
<a href='#F8L102' id='F8L102'> 102</a>
<a href='#F8L103' id='F8L103'> 103</a>
<a href='#F8L104' id='F8L104'> 104</a>
<a href='#F8L105' id='F8L105'> 105</a>
<a href='#F8L106' id='F8L106'> 106</a>
<a href='#F8L107' id='F8L107'> 107</a></div><div class='t'><a href='#F8L108' id='F8L108'> 108</a></div><div><a href='#F8L109' id='F8L109'> 109</a></div><div class='t'><a href='#F8L110' id='F8L110'> 110</a></div><div class='dead'><a href='#F8L111' id='F8L111'> 111</a></div><div><a href='#F8L112' id='F8L112'> 112</a>
<a href='#F8L113' id='F8L113'> 113</a>
<a href='#F8L114' id='F8L114'> 114</a>
<a href='#F8L115' id='F8L115'> 115</a>
<a href='#F8L116' id='F8L116'> 116</a>
<a href='#F8L117' id='F8L117'> 117</a>
<a href='#F8L118' id='F8L118'> 118</a>
<a href='#F8L119' id='F8L119'> 119</a>
<a href='#F8L120' id='F8L120'> 120</a>
<a href='#F8L121' id='F8L121'> 121</a>
<a href='#F8L122' id='F8L122'> 122</a></div><div class='t'><a href='#F8L123' id='F8L123'> 123</a>
<a href='#F8L124' id='F8L124'> 124</a></div><div class='dead'><a href='#F8L125' id='F8L125'> 125</a></div><div><a href='#F8L126' id='F8L126'> 126</a></div><div class='t'><a href='#F8L127' id='F8L127'> 127</a></div><div class='dead'><a href='#F8L128' id='F8L128'> 128</a></div><div><a href='#F8L129' id='F8L129'> 129</a>
<a href='#F8L130' id='F8L130'> 130</a>
<a href='#F8L131' id='F8L131'> 131</a>
<a href='#F8L132' id='F8L132'> 132</a>
<a href='#F8L133' id='F8L133'> 133</a>
<a href='#F8L134' id='F8L134'> 134</a>
<a href='#F8L135' id='F8L135'> 135</a></div><div class='t'><a href='#F8L136' id='F8L136'> 136</a></div><div class='dead'><a href='#F8L137' id='F8L137'> 137</a></div><div><a href='#F8L138' id='F8L138'> 138</a>
<a href='#F8L139' id='F8L139'> 139</a>
<a href='#F8L140' id='F8L140'> 140</a>
<a href='#F8L141' id='F8L141'> 141</a>
<a href='#F8L142' id='F8L142'> 142</a>
<a href='#F8L143' id='F8L143'> 143</a>
<a href='#F8L144' id='F8L144'> 144</a></div><div class='t'><a href='#F8L145' id='F8L145'> 145</a>
<a href='#F8L146' id='F8L146'> 146</a></div><div><a href='#F8L147' id='F8L147'> 147</a>
<a href='#F8L148' id='F8L148'> 148</a>
<a href='#F8L149' id='F8L149'> 149</a>
<a href='#F8L150' id='F8L150'> 150</a>
<a href='#F8L151' id='F8L151'> 151</a>
<a href='#F8L152' id='F8L152'> 152</a>
<a href='#F8L153' id='F8L153'> 153</a></div><div class='t'><a href='#F8L154' id='F8L154'> 154</a></div><div class='dead'><a href='#F8L155' id='F8L155'> 155</a></div><div><a href='#F8L156' id='F8L156'> 156</a>
<a href='#F8L157' id='F8L157'> 157</a>
<a href='#F8L158' id='F8L158'> 158</a>
<a href='#F8L159' id='F8L159'> 159</a>
<a href='#F8L160' id='F8L160'> 160</a>
<a href='#F8L161' id='F8L161'> 161</a>
<a href='#F8L162' id='F8L162'> 162</a></div><div class='t'><a href='#F8L163' id='F8L163'> 163</a>
<a href='#F8L164' id='F8L164'> 164</a></div><div><a href='#F8L165' id='F8L165'> 165</a>
</div>			</aside>
			<code style='margin-left: 4em'><span class="hh">
<span class="hd">&lt;?php<br /><br /></span><span class="hk">namespace&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Entity</span><span class="hk">;<br /><br /><br />use&nbsp;</span><span class="hd">Nette</span><span class="hk">\</span><span class="hd">Utils</span><span class="hk">\</span><span class="hd">Image</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Nette</span><span class="hk">\</span><span class="hd">Utils</span><span class="hk">\</span><span class="hd">Strings</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Entity</span><span class="hk">\</span><span class="hd">Exceptions</span><span class="hk">\</span><span class="hd">HashException</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Entity</span><span class="hk">\</span><span class="hd">Exceptions</span><span class="hk">\</span><span class="hd">ImageTypeException</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Meta</span><span class="hk">;<br /><br /></span><span class="hc">/**<br />&nbsp;*&nbsp;Basic&nbsp;implementation&nbsp;of&nbsp;the&nbsp;image&nbsp;meta&nbsp;information&nbsp;as&nbsp;Doctrine&nbsp;entity.<br />&nbsp;*<br />&nbsp;*&nbsp;@ORM\MappedSuperClass<br />&nbsp;*/<br /></span><span class="hk">class&nbsp;</span><span class="hd">ImageEntity&nbsp;</span><span class="hk">implements&nbsp;</span><span class="hd">Meta<br /></span><span class="hk">{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;SHA1&nbsp;hash&nbsp;of&nbsp;the&nbsp;original&nbsp;image<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@ORM\Column(length=40,&nbsp;nullable=true)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;</span><span class="hd">$hash</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Original&nbsp;image&nbsp;type&nbsp;as&nbsp;defined&nbsp;in&nbsp;the&nbsp;`Image`&nbsp;class&nbsp;constants&nbsp;`JPEG`,&nbsp;`GIF`&nbsp;and&nbsp;`PNG`.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@ORM\Column(type="integer",&nbsp;nullable=true)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;integer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;</span><span class="hd">$type</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@ORM\Column(type="integer",&nbsp;nullable=true)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;integer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;</span><span class="hd">$width</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@ORM\Column(type="integer",&nbsp;nullable=true)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;integer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;</span><span class="hd">$height</span><span class="hk">;<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">getHash</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">hash</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;string&nbsp;$hash<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;ImageEntity<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">setHash</span><span class="hk">(</span><span class="hd">$hash</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">hash&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">checkHash</span><span class="hk">(</span><span class="hd">$hash</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;integer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">getType</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">type</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Checks&nbsp;that&nbsp;the&nbsp;given&nbsp;string&nbsp;is&nbsp;valid&nbsp;SHA1&nbsp;hash&nbsp;and&nbsp;normalizes&nbsp;it&nbsp;to&nbsp;lower&nbsp;case.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;string&nbsp;$hash&nbsp;Image&nbsp;hash&nbsp;to&nbsp;validate<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;HashException&nbsp;If&nbsp;the&nbsp;hash&nbsp;is&nbsp;not&nbsp;valid&nbsp;image&nbsp;hash<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;valid&nbsp;image&nbsp;hash<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;function&nbsp;</span><span class="hd">checkHash</span><span class="hk">(</span><span class="hd">$hash</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span class="hd">is_string</span><span class="hk">(</span><span class="hd">$hash</span><span class="hk">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span class="hd">HashException</span><span class="hk">(</span><span class="hd">$hash</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$hash&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">Strings</span><span class="hk">::</span><span class="hd">lower</span><span class="hk">(</span><span class="hd">$hash</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span class="hd">preg_match</span><span class="hk">(</span><span class="hs">'/^[0-9a-f]{40}$/'</span><span class="hk">,&nbsp;</span><span class="hd">$hash</span><span class="hk">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span class="hd">HashException</span><span class="hk">(</span><span class="hd">$hash</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$hash</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;integer&nbsp;$type<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;ImageEntity<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">setType</span><span class="hk">(</span><span class="hd">$type</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">type&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">checkType</span><span class="hk">(</span><span class="hd">$type</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Checks&nbsp;the&nbsp;given&nbsp;image&nbsp;type&nbsp;to&nbsp;be&nbsp;one&nbsp;of&nbsp;the&nbsp;supported&nbsp;types.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;integer&nbsp;$type<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;integer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;ImageTypeException<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;function&nbsp;</span><span class="hd">checkType</span><span class="hk">(</span><span class="hd">$type</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span class="hd">in_array</span><span class="hk">(</span><span class="hd">$type</span><span class="hk">,&nbsp;array(</span><span class="hd">Image</span><span class="hk">::</span><span class="hd">JPEG</span><span class="hk">,&nbsp;</span><span class="hd">Image</span><span class="hk">::</span><span class="hd">PNG</span><span class="hk">,&nbsp;</span><span class="hd">Image</span><span class="hk">::</span><span class="hd">GIF</span><span class="hk">),&nbsp;</span><span class="hd">TRUE</span><span class="hk">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span class="hd">ImageTypeException</span><span class="hk">(</span><span class="hd">$type</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$type</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;integer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">getHeight</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">height</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;integer&nbsp;$height<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">setHeight</span><span class="hk">(</span><span class="hd">$height</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">height&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$height</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;integer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">getWidth</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">width</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;integer&nbsp;$width<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">setWidth</span><span class="hk">(</span><span class="hd">$width</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">width&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$width</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></span>
</span>
</code>		</div>
		</div>
	</div>
		<div>
		<table>
		<tr>
			<td class="number"><small>100 %</small></td>
			<td><div class="bar"><div style="width: 100%"></div></div></td>
			<td><a href="#F9" class="toggle">ImageStore/Entity/Exceptions/ImageTypeException.php</a></td>
		</tr>
		</table>

		<div class="code" id="F9">
		<div>
			<aside>
			<div><a href='#F9L1' id='F9L1'>  1</a>
<a href='#F9L2' id='F9L2'>  2</a>
<a href='#F9L3' id='F9L3'>  3</a>
<a href='#F9L4' id='F9L4'>  4</a>
<a href='#F9L5' id='F9L5'>  5</a>
<a href='#F9L6' id='F9L6'>  6</a>
<a href='#F9L7' id='F9L7'>  7</a>
<a href='#F9L8' id='F9L8'>  8</a>
<a href='#F9L9' id='F9L9'>  9</a>
<a href='#F9L10' id='F9L10'> 10</a>
<a href='#F9L11' id='F9L11'> 11</a></div><div class='t'><a href='#F9L12' id='F9L12'> 12</a></div><div><a href='#F9L13' id='F9L13'> 13</a>
<a href='#F9L14' id='F9L14'> 14</a>
<a href='#F9L15' id='F9L15'> 15</a>
<a href='#F9L16' id='F9L16'> 16</a>
<a href='#F9L17' id='F9L17'> 17</a>
<a href='#F9L18' id='F9L18'> 18</a></div><div class='t'><a href='#F9L19' id='F9L19'> 19</a>
<a href='#F9L20' id='F9L20'> 20</a>
<a href='#F9L21' id='F9L21'> 21</a></div><div><a href='#F9L22' id='F9L22'> 22</a>
<a href='#F9L23' id='F9L23'> 23</a>
</div>			</aside>
			<code style='margin-left: 3em'><span class="hh">
<span class="hd">&lt;?php<br /><br /></span><span class="hk">namespace&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Entity</span><span class="hk">\</span><span class="hd">Exceptions</span><span class="hk">;<br /><br /><br />use&nbsp;</span><span class="hd">InvalidArgumentException</span><span class="hk">;<br /><br /></span><span class="hc">/**<br />&nbsp;*&nbsp;Invalid&nbsp;image&nbsp;type&nbsp;exception<br />&nbsp;*/<br /></span><span class="hk">class&nbsp;</span><span class="hd">ImageTypeException&nbsp;</span><span class="hk">extends&nbsp;</span><span class="hd">InvalidArgumentException<br /></span><span class="hk">{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;integer&nbsp;$type<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">__construct</span><span class="hk">(</span><span class="hd">$type</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$message&nbsp;</span><span class="hk">=&nbsp;</span><span class="hs">'The&nbsp;image&nbsp;type&nbsp;%s&nbsp;is&nbsp;not&nbsp;supported,&nbsp;it&nbsp;must&nbsp;be&nbsp;one&nbsp;of&nbsp;Image::JPEG,&nbsp;Image::PNG&nbsp;or&nbsp;Image::GIF.'</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">parent</span><span class="hk">::</span><span class="hd">__construct</span><span class="hk">(</span><span class="hd">sprintf</span><span class="hk">(</span><span class="hd">$message</span><span class="hk">,&nbsp;</span><span class="hd">var_export</span><span class="hk">(</span><span class="hd">$type</span><span class="hk">,&nbsp;</span><span class="hd">TRUE</span><span class="hk">)));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />}<br /></span>
</span>
</code>		</div>
		</div>
	</div>
		<div>
		<table>
		<tr>
			<td class="number"><small>100 %</small></td>
			<td><div class="bar"><div style="width: 100%"></div></div></td>
			<td><a href="#F10" class="toggle">ImageStore/Entity/Exceptions/HashException.php</a></td>
		</tr>
		</table>

		<div class="code" id="F10">
		<div>
			<aside>
			<div><a href='#F10L1' id='F10L1'>  1</a>
<a href='#F10L2' id='F10L2'>  2</a>
<a href='#F10L3' id='F10L3'>  3</a>
<a href='#F10L4' id='F10L4'>  4</a>
<a href='#F10L5' id='F10L5'>  5</a>
<a href='#F10L6' id='F10L6'>  6</a>
<a href='#F10L7' id='F10L7'>  7</a>
<a href='#F10L8' id='F10L8'>  8</a>
<a href='#F10L9' id='F10L9'>  9</a>
<a href='#F10L10' id='F10L10'> 10</a>
<a href='#F10L11' id='F10L11'> 11</a></div><div class='t'><a href='#F10L12' id='F10L12'> 12</a></div><div><a href='#F10L13' id='F10L13'> 13</a>
<a href='#F10L14' id='F10L14'> 14</a>
<a href='#F10L15' id='F10L15'> 15</a>
<a href='#F10L16' id='F10L16'> 16</a>
<a href='#F10L17' id='F10L17'> 17</a>
<a href='#F10L18' id='F10L18'> 18</a></div><div class='t'><a href='#F10L19' id='F10L19'> 19</a></div><div><a href='#F10L20' id='F10L20'> 20</a></div><div class='t'><a href='#F10L21' id='F10L21'> 21</a>
<a href='#F10L22' id='F10L22'> 22</a></div><div><a href='#F10L23' id='F10L23'> 23</a>
<a href='#F10L24' id='F10L24'> 24</a>
</div>			</aside>
			<code style='margin-left: 3em'><span class="hh">
<span class="hd">&lt;?php<br /><br /></span><span class="hk">namespace&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Entity</span><span class="hk">\</span><span class="hd">Exceptions</span><span class="hk">;<br /><br /><br />use&nbsp;</span><span class="hd">Exception</span><span class="hk">;<br /><br /></span><span class="hc">/**<br />&nbsp;*&nbsp;Invalid&nbsp;hash&nbsp;exception<br />&nbsp;*/<br /></span><span class="hk">class&nbsp;</span><span class="hd">HashException&nbsp;</span><span class="hk">extends&nbsp;</span><span class="hd">Exception<br /></span><span class="hk">{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;$hash<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">__construct</span><span class="hk">(</span><span class="hd">$hash</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$message&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">sprintf</span><span class="hk">(</span><span class="hs">'The&nbsp;image&nbsp;hash&nbsp;is&nbsp;invalid.&nbsp;It&nbsp;is&nbsp;required&nbsp;to&nbsp;be&nbsp;a&nbsp;SHA1&nbsp;hash&nbsp;but&nbsp;%s&nbsp;given.'</span><span class="hk">,&nbsp;</span><span class="hd">var_export</span><span class="hk">(</span><span class="hd">$hash</span><span class="hk">,&nbsp;</span><span class="hd">TRUE</span><span class="hk">));<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">parent</span><span class="hk">::</span><span class="hd">__construct</span><span class="hk">(</span><span class="hd">$message</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />}<br /></span>
</span>
</code>		</div>
		</div>
	</div>
		<div>
		<table>
		<tr>
			<td class="number"><small>100 %</small></td>
			<td><div class="bar"><div style="width: 100%"></div></div></td>
			<td><a href="#F11" class="toggle">ImageStore/Entity/EmptyImage.php</a></td>
		</tr>
		</table>

		<div class="code" id="F11">
		<div>
			<aside>
			<div><a href='#F11L1' id='F11L1'>  1</a>
<a href='#F11L2' id='F11L2'>  2</a>
<a href='#F11L3' id='F11L3'>  3</a>
<a href='#F11L4' id='F11L4'>  4</a>
<a href='#F11L5' id='F11L5'>  5</a>
<a href='#F11L6' id='F11L6'>  6</a>
<a href='#F11L7' id='F11L7'>  7</a>
<a href='#F11L8' id='F11L8'>  8</a>
<a href='#F11L9' id='F11L9'>  9</a>
<a href='#F11L10' id='F11L10'> 10</a>
<a href='#F11L11' id='F11L11'> 11</a></div><div class='t'><a href='#F11L12' id='F11L12'> 12</a></div><div><a href='#F11L13' id='F11L13'> 13</a>
<a href='#F11L14' id='F11L14'> 14</a>
<a href='#F11L15' id='F11L15'> 15</a>
<a href='#F11L16' id='F11L16'> 16</a></div><div class='t'><a href='#F11L17' id='F11L17'> 17</a></div><div class='dead'><a href='#F11L18' id='F11L18'> 18</a></div><div><a href='#F11L19' id='F11L19'> 19</a>
<a href='#F11L20' id='F11L20'> 20</a>
<a href='#F11L21' id='F11L21'> 21</a>
<a href='#F11L22' id='F11L22'> 22</a></div><div class='t'><a href='#F11L23' id='F11L23'> 23</a></div><div class='dead'><a href='#F11L24' id='F11L24'> 24</a></div><div><a href='#F11L25' id='F11L25'> 25</a>
<a href='#F11L26' id='F11L26'> 26</a>
<a href='#F11L27' id='F11L27'> 27</a>
<a href='#F11L28' id='F11L28'> 28</a></div><div class='t'><a href='#F11L29' id='F11L29'> 29</a></div><div class='dead'><a href='#F11L30' id='F11L30'> 30</a></div><div><a href='#F11L31' id='F11L31'> 31</a>
<a href='#F11L32' id='F11L32'> 32</a>
<a href='#F11L33' id='F11L33'> 33</a>
<a href='#F11L34' id='F11L34'> 34</a></div><div class='t'><a href='#F11L35' id='F11L35'> 35</a></div><div class='dead'><a href='#F11L36' id='F11L36'> 36</a></div><div><a href='#F11L37' id='F11L37'> 37</a>
<a href='#F11L38' id='F11L38'> 38</a>
<a href='#F11L39' id='F11L39'> 39</a>
<a href='#F11L40' id='F11L40'> 40</a></div><div class='t'><a href='#F11L41' id='F11L41'> 41</a></div><div class='dead'><a href='#F11L42' id='F11L42'> 42</a></div><div><a href='#F11L43' id='F11L43'> 43</a>
<a href='#F11L44' id='F11L44'> 44</a>
<a href='#F11L45' id='F11L45'> 45</a>
<a href='#F11L46' id='F11L46'> 46</a></div><div class='t'><a href='#F11L47' id='F11L47'> 47</a></div><div class='dead'><a href='#F11L48' id='F11L48'> 48</a></div><div><a href='#F11L49' id='F11L49'> 49</a>
<a href='#F11L50' id='F11L50'> 50</a>
</div>			</aside>
			<code style='margin-left: 3em'><span class="hh">
<span class="hd">&lt;?php<br /><br /></span><span class="hk">namespace&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Entity</span><span class="hk">;<br /><br /><br />use&nbsp;</span><span class="hd">Nette</span><span class="hk">\</span><span class="hd">Utils</span><span class="hk">\</span><span class="hd">Image</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Meta</span><span class="hk">;<br /><br /></span><span class="hc">/**<br />&nbsp;*&nbsp;"Image&nbsp;not&nbsp;found"&nbsp;entity<br />&nbsp;*/<br /></span><span class="hk">class&nbsp;</span><span class="hd">EmptyImage&nbsp;</span><span class="hk">implements&nbsp;</span><span class="hd">Meta<br /></span><span class="hk">{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span class="hd">getHash</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hs">'_empty'</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span class="hd">getType</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">Image</span><span class="hk">::</span><span class="hd">PNG</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span class="hd">setHash</span><span class="hk">(</span><span class="hd">$hash</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;\</span><span class="hd">LogicException</span><span class="hk">(</span><span class="hs">'Unavailable&nbsp;image&nbsp;hash&nbsp;cannot&nbsp;be&nbsp;changed.'</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span class="hd">setType</span><span class="hk">(</span><span class="hd">$type</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;\</span><span class="hd">LogicException</span><span class="hk">(</span><span class="hs">'Unavailable&nbsp;image&nbsp;hash&nbsp;cannot&nbsp;be&nbsp;changed.'</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span class="hd">getHeight</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">1080</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span class="hd">getWidth</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">1920</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />}<br /></span>
</span>
</code>		</div>
		</div>
	</div>
		<div>
		<table>
		<tr class='light'>
			<td class="number"><small>100 %</small></td>
			<td><div class="bar"><div style="width: 100%"></div></div></td>
			<td><a href="#F12" class="toggle">ImageStore/UploaderException.php</a></td>
		</tr>
		</table>

		<div class="code" id="F12">
		<div>
			<aside>
			<div><a href='#F12L1' id='F12L1'>  1</a>
<a href='#F12L2' id='F12L2'>  2</a>
<a href='#F12L3' id='F12L3'>  3</a>
<a href='#F12L4' id='F12L4'>  4</a>
<a href='#F12L5' id='F12L5'>  5</a>
<a href='#F12L6' id='F12L6'>  6</a>
<a href='#F12L7' id='F12L7'>  7</a>
<a href='#F12L8' id='F12L8'>  8</a>
<a href='#F12L9' id='F12L9'>  9</a>
<a href='#F12L10' id='F12L10'> 10</a>
<a href='#F12L11' id='F12L11'> 11</a></div><div class='t'><a href='#F12L12' id='F12L12'> 12</a></div><div><a href='#F12L13' id='F12L13'> 13</a>
<a href='#F12L14' id='F12L14'> 14</a>
<a href='#F12L15' id='F12L15'> 15</a>
<a href='#F12L16' id='F12L16'> 16</a>
<a href='#F12L17' id='F12L17'> 17</a>
<a href='#F12L18' id='F12L18'> 18</a>
<a href='#F12L19' id='F12L19'> 19</a>
<a href='#F12L20' id='F12L20'> 20</a>
<a href='#F12L21' id='F12L21'> 21</a>
<a href='#F12L22' id='F12L22'> 22</a>
<a href='#F12L23' id='F12L23'> 23</a>
<a href='#F12L24' id='F12L24'> 24</a>
<a href='#F12L25' id='F12L25'> 25</a>
<a href='#F12L26' id='F12L26'> 26</a>
<a href='#F12L27' id='F12L27'> 27</a>
<a href='#F12L28' id='F12L28'> 28</a>
<a href='#F12L29' id='F12L29'> 29</a>
<a href='#F12L30' id='F12L30'> 30</a>
<a href='#F12L31' id='F12L31'> 31</a>
<a href='#F12L32' id='F12L32'> 32</a>
<a href='#F12L33' id='F12L33'> 33</a>
<a href='#F12L34' id='F12L34'> 34</a>
<a href='#F12L35' id='F12L35'> 35</a></div><div class='t'><a href='#F12L36' id='F12L36'> 36</a>
<a href='#F12L37' id='F12L37'> 37</a></div><div><a href='#F12L38' id='F12L38'> 38</a>
<a href='#F12L39' id='F12L39'> 39</a>
<a href='#F12L40' id='F12L40'> 40</a>
</div>			</aside>
			<code style='margin-left: 3em'><span class="hh">
<span class="hd">&lt;?php<br /><br /></span><span class="hk">namespace&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">;<br /><br /><br />use&nbsp;</span><span class="hd">RuntimeException</span><span class="hk">;<br /><br /></span><span class="hc">/**<br />&nbsp;*&nbsp;Image&nbsp;upload&nbsp;error&nbsp;exception<br />&nbsp;*/<br /></span><span class="hk">class&nbsp;</span><span class="hd">UploaderException&nbsp;</span><span class="hk">extends&nbsp;</span><span class="hd">RuntimeException<br /></span><span class="hk">{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Upload&nbsp;error&nbsp;code&nbsp;-&gt;&nbsp;error&nbsp;message&nbsp;map<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;string[]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;</span><span class="hd">$messages&nbsp;</span><span class="hk">=&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">0&nbsp;</span><span class="hk">=&gt;&nbsp;</span><span class="hs">"There&nbsp;is&nbsp;no&nbsp;error,&nbsp;the&nbsp;file&nbsp;uploaded&nbsp;with&nbsp;success"</span><span class="hk">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">1&nbsp;</span><span class="hk">=&gt;&nbsp;</span><span class="hs">"The&nbsp;uploaded&nbsp;file&nbsp;exceeds&nbsp;the&nbsp;upload_max_filesize&nbsp;directive&nbsp;in&nbsp;php.ini"</span><span class="hk">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">2&nbsp;</span><span class="hk">=&gt;&nbsp;</span><span class="hs">"The&nbsp;uploaded&nbsp;file&nbsp;exceeds&nbsp;the&nbsp;MAX_FILE_SIZE&nbsp;directive&nbsp;that&nbsp;was&nbsp;specified&nbsp;in&nbsp;the&nbsp;HTML&nbsp;form"</span><span class="hk">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">3&nbsp;</span><span class="hk">=&gt;&nbsp;</span><span class="hs">"The&nbsp;uploaded&nbsp;file&nbsp;was&nbsp;only&nbsp;partially&nbsp;uploaded"</span><span class="hk">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">4&nbsp;</span><span class="hk">=&gt;&nbsp;</span><span class="hs">"No&nbsp;file&nbsp;was&nbsp;uploaded"</span><span class="hk">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">6&nbsp;</span><span class="hk">=&gt;&nbsp;</span><span class="hs">"Missing&nbsp;a&nbsp;temporary&nbsp;folder"</span><span class="hk">,<br />&nbsp;&nbsp;&nbsp;&nbsp;];<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;the&nbsp;upload&nbsp;error&nbsp;exception&nbsp;using&nbsp;the&nbsp;given&nbsp;upload&nbsp;error&nbsp;code.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;$code<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">__construct</span><span class="hk">(</span><span class="hd">$code</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">parent</span><span class="hk">::</span><span class="hd">__construct</span><span class="hk">(</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">messages</span><span class="hk">[</span><span class="hd">$code</span><span class="hk">],&nbsp;</span><span class="hd">$code</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />}<br /></span>
</span>
</code>		</div>
		</div>
	</div>
		<div>
		<table>
		<tr class='light'>
			<td class="number"><small>100 %</small></td>
			<td><div class="bar"><div style="width: 100%"></div></div></td>
			<td><a href="#F13" class="toggle">ImageStore/Storage.php</a></td>
		</tr>
		</table>

		<div class="code" id="F13">
		<div>
			<aside>
			<div><a href='#F13L1' id='F13L1'>  1</a>
<a href='#F13L2' id='F13L2'>  2</a>
<a href='#F13L3' id='F13L3'>  3</a>
<a href='#F13L4' id='F13L4'>  4</a>
<a href='#F13L5' id='F13L5'>  5</a>
<a href='#F13L6' id='F13L6'>  6</a>
<a href='#F13L7' id='F13L7'>  7</a>
<a href='#F13L8' id='F13L8'>  8</a>
<a href='#F13L9' id='F13L9'>  9</a>
<a href='#F13L10' id='F13L10'> 10</a></div><div class='t'><a href='#F13L11' id='F13L11'> 11</a></div><div><a href='#F13L12' id='F13L12'> 12</a>
<a href='#F13L13' id='F13L13'> 13</a>
<a href='#F13L14' id='F13L14'> 14</a>
<a href='#F13L15' id='F13L15'> 15</a>
<a href='#F13L16' id='F13L16'> 16</a>
<a href='#F13L17' id='F13L17'> 17</a>
<a href='#F13L18' id='F13L18'> 18</a>
<a href='#F13L19' id='F13L19'> 19</a>
<a href='#F13L20' id='F13L20'> 20</a>
<a href='#F13L21' id='F13L21'> 21</a>
<a href='#F13L22' id='F13L22'> 22</a>
<a href='#F13L23' id='F13L23'> 23</a>
<a href='#F13L24' id='F13L24'> 24</a>
<a href='#F13L25' id='F13L25'> 25</a>
<a href='#F13L26' id='F13L26'> 26</a>
<a href='#F13L27' id='F13L27'> 27</a>
<a href='#F13L28' id='F13L28'> 28</a>
<a href='#F13L29' id='F13L29'> 29</a>
<a href='#F13L30' id='F13L30'> 30</a>
<a href='#F13L31' id='F13L31'> 31</a>
<a href='#F13L32' id='F13L32'> 32</a>
<a href='#F13L33' id='F13L33'> 33</a>
<a href='#F13L34' id='F13L34'> 34</a>
<a href='#F13L35' id='F13L35'> 35</a>
<a href='#F13L36' id='F13L36'> 36</a>
<a href='#F13L37' id='F13L37'> 37</a>
<a href='#F13L38' id='F13L38'> 38</a>
<a href='#F13L39' id='F13L39'> 39</a>
<a href='#F13L40' id='F13L40'> 40</a>
<a href='#F13L41' id='F13L41'> 41</a>
<a href='#F13L42' id='F13L42'> 42</a>
<a href='#F13L43' id='F13L43'> 43</a>
<a href='#F13L44' id='F13L44'> 44</a>
<a href='#F13L45' id='F13L45'> 45</a>
<a href='#F13L46' id='F13L46'> 46</a>
<a href='#F13L47' id='F13L47'> 47</a>
<a href='#F13L48' id='F13L48'> 48</a>
<a href='#F13L49' id='F13L49'> 49</a>
<a href='#F13L50' id='F13L50'> 50</a>
<a href='#F13L51' id='F13L51'> 51</a>
<a href='#F13L52' id='F13L52'> 52</a>
<a href='#F13L53' id='F13L53'> 53</a>
<a href='#F13L54' id='F13L54'> 54</a>
<a href='#F13L55' id='F13L55'> 55</a>
<a href='#F13L56' id='F13L56'> 56</a>
<a href='#F13L57' id='F13L57'> 57</a>
<a href='#F13L58' id='F13L58'> 58</a>
<a href='#F13L59' id='F13L59'> 59</a>
<a href='#F13L60' id='F13L60'> 60</a>
<a href='#F13L61' id='F13L61'> 61</a>
<a href='#F13L62' id='F13L62'> 62</a>
<a href='#F13L63' id='F13L63'> 63</a>
<a href='#F13L64' id='F13L64'> 64</a>
<a href='#F13L65' id='F13L65'> 65</a>
<a href='#F13L66' id='F13L66'> 66</a>
<a href='#F13L67' id='F13L67'> 67</a>
<a href='#F13L68' id='F13L68'> 68</a>
<a href='#F13L69' id='F13L69'> 69</a>
<a href='#F13L70' id='F13L70'> 70</a>
<a href='#F13L71' id='F13L71'> 71</a>
<a href='#F13L72' id='F13L72'> 72</a>
<a href='#F13L73' id='F13L73'> 73</a>
<a href='#F13L74' id='F13L74'> 74</a>
<a href='#F13L75' id='F13L75'> 75</a>
<a href='#F13L76' id='F13L76'> 76</a>
<a href='#F13L77' id='F13L77'> 77</a>
<a href='#F13L78' id='F13L78'> 78</a>
<a href='#F13L79' id='F13L79'> 79</a>
<a href='#F13L80' id='F13L80'> 80</a>
<a href='#F13L81' id='F13L81'> 81</a>
<a href='#F13L82' id='F13L82'> 82</a>
<a href='#F13L83' id='F13L83'> 83</a>
<a href='#F13L84' id='F13L84'> 84</a>
<a href='#F13L85' id='F13L85'> 85</a>
<a href='#F13L86' id='F13L86'> 86</a>
<a href='#F13L87' id='F13L87'> 87</a>
<a href='#F13L88' id='F13L88'> 88</a>
<a href='#F13L89' id='F13L89'> 89</a>
<a href='#F13L90' id='F13L90'> 90</a>
<a href='#F13L91' id='F13L91'> 91</a>
<a href='#F13L92' id='F13L92'> 92</a>
<a href='#F13L93' id='F13L93'> 93</a>
<a href='#F13L94' id='F13L94'> 94</a>
<a href='#F13L95' id='F13L95'> 95</a>
<a href='#F13L96' id='F13L96'> 96</a>
</div>			</aside>
			<code style='margin-left: 3em'><span class="hh">
<span class="hd">&lt;?php<br /><br /></span><span class="hk">namespace&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">;<br /><br /><br />use&nbsp;</span><span class="hd">Nette</span><span class="hk">\</span><span class="hd">Http</span><span class="hk">\</span><span class="hd">FileUpload</span><span class="hk">;<br /><br /></span><span class="hc">/**<br />&nbsp;*&nbsp;Image&nbsp;Storage&nbsp;Interface<br />&nbsp;*/<br /></span><span class="hk">interface&nbsp;</span><span class="hd">Storage<br /></span><span class="hk">{<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;TRUE&nbsp;if&nbsp;the&nbsp;storage&nbsp;contains&nbsp;the&nbsp;given&nbsp;image.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;Meta&nbsp;$meta<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;boolean<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">contains</span><span class="hk">(</span><span class="hd">Meta&nbsp;$meta</span><span class="hk">);<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;requested&nbsp;image&nbsp;encapsulated&nbsp;in&nbsp;a&nbsp;HTTP&nbsp;response&nbsp;object.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;Request&nbsp;$request<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;IResponse<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">download</span><span class="hk">(</span><span class="hd">Request&nbsp;$request</span><span class="hk">);<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;requested&nbsp;image&nbsp;object.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;Request&nbsp;$request<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;mixed<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">fetch</span><span class="hk">(</span><span class="hd">Request&nbsp;$request</span><span class="hk">);<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Flushes&nbsp;the&nbsp;storage&nbsp;image&nbsp;cache.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;void<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">flush</span><span class="hk">();<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;the&nbsp;URL&nbsp;of&nbsp;the&nbsp;requested&nbsp;image&nbsp;thumbnail.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;Request&nbsp;$request<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">link</span><span class="hk">(</span><span class="hd">Request&nbsp;$request</span><span class="hk">);<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Fetches&nbsp;the&nbsp;original&nbsp;stored&nbsp;image.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;Meta&nbsp;$meta<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;Image<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">original</span><span class="hk">(</span><span class="hd">Meta&nbsp;$meta</span><span class="hk">);<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Removes&nbsp;the&nbsp;requested&nbsp;image&nbsp;from&nbsp;the&nbsp;storage.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;Meta&nbsp;$meta<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;void<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">remove</span><span class="hk">(</span><span class="hd">Meta&nbsp;$meta</span><span class="hk">);<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Renders&nbsp;the&nbsp;requested&nbsp;image&nbsp;to&nbsp;the&nbsp;standard&nbsp;output.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;Request&nbsp;$request<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;void<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">send</span><span class="hk">(</span><span class="hd">Request&nbsp;$request</span><span class="hk">);<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Uploads&nbsp;an&nbsp;image&nbsp;to&nbsp;the&nbsp;storage&nbsp;and&nbsp;store&nbsp;it's&nbsp;meta&nbsp;information&nbsp;in&nbsp;the&nbsp;given&nbsp;image&nbsp;entity.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;FileUpload&nbsp;$file<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;Meta&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$meta<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;void<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">upload</span><span class="hk">(</span><span class="hd">FileUpload&nbsp;$file</span><span class="hk">,&nbsp;</span><span class="hd">Meta&nbsp;$meta</span><span class="hk">);<br /><br /><br />}<br /></span>
</span>
</code>		</div>
		</div>
	</div>
		<div>
		<table>
		<tr>
			<td class="number"><small>100 %</small></td>
			<td><div class="bar"><div style="width: 100%"></div></div></td>
			<td><a href="#F14" class="toggle">ImageStore/Requests/ImageRequest.php</a></td>
		</tr>
		</table>

		<div class="code" id="F14">
		<div>
			<aside>
			<div><a href='#F14L1' id='F14L1'>   1</a>
<a href='#F14L2' id='F14L2'>   2</a>
<a href='#F14L3' id='F14L3'>   3</a>
<a href='#F14L4' id='F14L4'>   4</a>
<a href='#F14L5' id='F14L5'>   5</a>
<a href='#F14L6' id='F14L6'>   6</a>
<a href='#F14L7' id='F14L7'>   7</a>
<a href='#F14L8' id='F14L8'>   8</a>
<a href='#F14L9' id='F14L9'>   9</a>
<a href='#F14L10' id='F14L10'>  10</a>
<a href='#F14L11' id='F14L11'>  11</a>
<a href='#F14L12' id='F14L12'>  12</a>
<a href='#F14L13' id='F14L13'>  13</a>
<a href='#F14L14' id='F14L14'>  14</a></div><div class='t'><a href='#F14L15' id='F14L15'>  15</a></div><div><a href='#F14L16' id='F14L16'>  16</a>
<a href='#F14L17' id='F14L17'>  17</a>
<a href='#F14L18' id='F14L18'>  18</a>
<a href='#F14L19' id='F14L19'>  19</a>
<a href='#F14L20' id='F14L20'>  20</a>
<a href='#F14L21' id='F14L21'>  21</a>
<a href='#F14L22' id='F14L22'>  22</a>
<a href='#F14L23' id='F14L23'>  23</a>
<a href='#F14L24' id='F14L24'>  24</a>
<a href='#F14L25' id='F14L25'>  25</a>
<a href='#F14L26' id='F14L26'>  26</a>
<a href='#F14L27' id='F14L27'>  27</a>
<a href='#F14L28' id='F14L28'>  28</a>
<a href='#F14L29' id='F14L29'>  29</a>
<a href='#F14L30' id='F14L30'>  30</a>
<a href='#F14L31' id='F14L31'>  31</a>
<a href='#F14L32' id='F14L32'>  32</a>
<a href='#F14L33' id='F14L33'>  33</a>
<a href='#F14L34' id='F14L34'>  34</a>
<a href='#F14L35' id='F14L35'>  35</a>
<a href='#F14L36' id='F14L36'>  36</a>
<a href='#F14L37' id='F14L37'>  37</a>
<a href='#F14L38' id='F14L38'>  38</a>
<a href='#F14L39' id='F14L39'>  39</a>
<a href='#F14L40' id='F14L40'>  40</a>
<a href='#F14L41' id='F14L41'>  41</a>
<a href='#F14L42' id='F14L42'>  42</a>
<a href='#F14L43' id='F14L43'>  43</a>
<a href='#F14L44' id='F14L44'>  44</a>
<a href='#F14L45' id='F14L45'>  45</a>
<a href='#F14L46' id='F14L46'>  46</a>
<a href='#F14L47' id='F14L47'>  47</a>
<a href='#F14L48' id='F14L48'>  48</a>
<a href='#F14L49' id='F14L49'>  49</a>
<a href='#F14L50' id='F14L50'>  50</a>
<a href='#F14L51' id='F14L51'>  51</a>
<a href='#F14L52' id='F14L52'>  52</a>
<a href='#F14L53' id='F14L53'>  53</a>
<a href='#F14L54' id='F14L54'>  54</a>
<a href='#F14L55' id='F14L55'>  55</a>
<a href='#F14L56' id='F14L56'>  56</a></div><div class='t'><a href='#F14L57' id='F14L57'>  57</a>
<a href='#F14L58' id='F14L58'>  58</a>
<a href='#F14L59' id='F14L59'>  59</a>
<a href='#F14L60' id='F14L60'>  60</a>
<a href='#F14L61' id='F14L61'>  61</a></div><div><a href='#F14L62' id='F14L62'>  62</a>
<a href='#F14L63' id='F14L63'>  63</a>
<a href='#F14L64' id='F14L64'>  64</a>
<a href='#F14L65' id='F14L65'>  65</a>
<a href='#F14L66' id='F14L66'>  66</a>
<a href='#F14L67' id='F14L67'>  67</a>
<a href='#F14L68' id='F14L68'>  68</a>
<a href='#F14L69' id='F14L69'>  69</a>
<a href='#F14L70' id='F14L70'>  70</a>
<a href='#F14L71' id='F14L71'>  71</a>
<a href='#F14L72' id='F14L72'>  72</a></div><div class='t'><a href='#F14L73' id='F14L73'>  73</a>
<a href='#F14L74' id='F14L74'>  74</a>
<a href='#F14L75' id='F14L75'>  75</a></div><div><a href='#F14L76' id='F14L76'>  76</a></div><div class='t'><a href='#F14L77' id='F14L77'>  77</a>
<a href='#F14L78' id='F14L78'>  78</a></div><div><a href='#F14L79' id='F14L79'>  79</a></div><div class='t'><a href='#F14L80' id='F14L80'>  80</a></div><div><a href='#F14L81' id='F14L81'>  81</a></div><div class='t'><a href='#F14L82' id='F14L82'>  82</a></div><div class='dead'><a href='#F14L83' id='F14L83'>  83</a></div><div><a href='#F14L84' id='F14L84'>  84</a>
<a href='#F14L85' id='F14L85'>  85</a>
<a href='#F14L86' id='F14L86'>  86</a>
<a href='#F14L87' id='F14L87'>  87</a>
<a href='#F14L88' id='F14L88'>  88</a>
<a href='#F14L89' id='F14L89'>  89</a>
<a href='#F14L90' id='F14L90'>  90</a>
<a href='#F14L91' id='F14L91'>  91</a>
<a href='#F14L92' id='F14L92'>  92</a>
<a href='#F14L93' id='F14L93'>  93</a>
<a href='#F14L94' id='F14L94'>  94</a></div><div class='t'><a href='#F14L95' id='F14L95'>  95</a>
<a href='#F14L96' id='F14L96'>  96</a>
<a href='#F14L97' id='F14L97'>  97</a></div><div><a href='#F14L98' id='F14L98'>  98</a></div><div class='t'><a href='#F14L99' id='F14L99'>  99</a></div><div class='dead'><a href='#F14L100' id='F14L100'> 100</a></div><div><a href='#F14L101' id='F14L101'> 101</a>
<a href='#F14L102' id='F14L102'> 102</a>
<a href='#F14L103' id='F14L103'> 103</a>
<a href='#F14L104' id='F14L104'> 104</a>
<a href='#F14L105' id='F14L105'> 105</a>
<a href='#F14L106' id='F14L106'> 106</a>
<a href='#F14L107' id='F14L107'> 107</a></div><div class='t'><a href='#F14L108' id='F14L108'> 108</a></div><div class='dead'><a href='#F14L109' id='F14L109'> 109</a></div><div><a href='#F14L110' id='F14L110'> 110</a>
<a href='#F14L111' id='F14L111'> 111</a>
<a href='#F14L112' id='F14L112'> 112</a>
<a href='#F14L113' id='F14L113'> 113</a>
<a href='#F14L114' id='F14L114'> 114</a>
<a href='#F14L115' id='F14L115'> 115</a>
<a href='#F14L116' id='F14L116'> 116</a></div><div class='t'><a href='#F14L117' id='F14L117'> 117</a></div><div class='dead'><a href='#F14L118' id='F14L118'> 118</a></div><div><a href='#F14L119' id='F14L119'> 119</a>
<a href='#F14L120' id='F14L120'> 120</a>
<a href='#F14L121' id='F14L121'> 121</a>
<a href='#F14L122' id='F14L122'> 122</a>
<a href='#F14L123' id='F14L123'> 123</a>
<a href='#F14L124' id='F14L124'> 124</a>
<a href='#F14L125' id='F14L125'> 125</a>
<a href='#F14L126' id='F14L126'> 126</a></div><div class='t'><a href='#F14L127' id='F14L127'> 127</a></div><div><a href='#F14L128' id='F14L128'> 128</a></div><div class='t'><a href='#F14L129' id='F14L129'> 129</a></div><div class='dead'><a href='#F14L130' id='F14L130'> 130</a></div><div><a href='#F14L131' id='F14L131'> 131</a>
<a href='#F14L132' id='F14L132'> 132</a>
<a href='#F14L133' id='F14L133'> 133</a>
<a href='#F14L134' id='F14L134'> 134</a>
<a href='#F14L135' id='F14L135'> 135</a>
<a href='#F14L136' id='F14L136'> 136</a>
<a href='#F14L137' id='F14L137'> 137</a></div><div class='t'><a href='#F14L138' id='F14L138'> 138</a></div><div class='dead'><a href='#F14L139' id='F14L139'> 139</a></div><div><a href='#F14L140' id='F14L140'> 140</a>
<a href='#F14L141' id='F14L141'> 141</a>
<a href='#F14L142' id='F14L142'> 142</a>
<a href='#F14L143' id='F14L143'> 143</a>
<a href='#F14L144' id='F14L144'> 144</a>
<a href='#F14L145' id='F14L145'> 145</a>
<a href='#F14L146' id='F14L146'> 146</a></div><div class='t'><a href='#F14L147' id='F14L147'> 147</a></div><div class='dead'><a href='#F14L148' id='F14L148'> 148</a></div><div><a href='#F14L149' id='F14L149'> 149</a>
<a href='#F14L150' id='F14L150'> 150</a>
</div>			</aside>
			<code style='margin-left: 4em'><span class="hh">
<span class="hd">&lt;?php<br /><br /></span><span class="hk">namespace&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Requests</span><span class="hk">;<br /><br /><br />use&nbsp;</span><span class="hd">Nette</span><span class="hk">\</span><span class="hd">Object</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Nette</span><span class="hk">\</span><span class="hd">Utils</span><span class="hk">\</span><span class="hd">Image</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Entity</span><span class="hk">\</span><span class="hd">EmptyImage</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Meta</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Request</span><span class="hk">;<br /><br /></span><span class="hc">/**<br />&nbsp;*&nbsp;Image&nbsp;request&nbsp;encapsulation<br />&nbsp;*/<br /></span><span class="hk">class&nbsp;</span><span class="hd">ImageRequest&nbsp;</span><span class="hk">extends&nbsp;</span><span class="hd">Object&nbsp;</span><span class="hk">implements&nbsp;</span><span class="hd">Request<br /></span><span class="hk">{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;requested&nbsp;image&nbsp;meta&nbsp;information.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;Meta<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;</span><span class="hd">$meta</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;requested&nbsp;image&nbsp;thumbnail&nbsp;dimensions<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;</span><span class="hd">$dimensions</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;requested&nbsp;image&nbsp;thumbnail&nbsp;flags.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;integer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;</span><span class="hd">$flags</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;requested&nbsp;image&nbsp;thumbnail&nbsp;cropping&nbsp;flag.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;boolean<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;</span><span class="hd">$crop&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">FALSE</span><span class="hk">;<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;the&nbsp;image&nbsp;request&nbsp;from&nbsp;the&nbsp;given&nbsp;meta&nbsp;information,&nbsp;requested&nbsp;dimensions&nbsp;and&nbsp;flags.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;Meta&nbsp;&nbsp;&nbsp;&nbsp;$meta<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;integer&nbsp;$dimensions<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;integer&nbsp;$flags<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;boolean&nbsp;$crop<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">__construct</span><span class="hk">(</span><span class="hd">Meta&nbsp;$meta</span><span class="hk">,&nbsp;</span><span class="hd">$dimensions&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">Request</span><span class="hk">::</span><span class="hd">ORIGINAL</span><span class="hk">,&nbsp;</span><span class="hd">$flags&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">Request</span><span class="hk">::</span><span class="hd">ORIGINAL</span><span class="hk">,&nbsp;</span><span class="hd">$crop&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">FALSE</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">meta&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$meta</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">dimensions&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$dimensions</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">flags&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$flags</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">crop&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$crop</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;the&nbsp;image&nbsp;request&nbsp;from&nbsp;the&nbsp;crop&nbsp;macro&nbsp;arguments.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;Meta&nbsp;&nbsp;$image<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;array&nbsp;$args<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;ImageRequest<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;static&nbsp;function&nbsp;</span><span class="hd">crop</span><span class="hk">(</span><span class="hd">Meta&nbsp;$image&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">NULL</span><span class="hk">,&nbsp;</span><span class="hd">$args&nbsp;</span><span class="hk">=&nbsp;array())<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span class="hd">$image&nbsp;</span><span class="hk">===&nbsp;</span><span class="hd">NULL</span><span class="hk">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$image&nbsp;</span><span class="hk">=&nbsp;new&nbsp;</span><span class="hd">EmptyImage</span><span class="hk">();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$dimensions&nbsp;</span><span class="hk">=&nbsp;isset(</span><span class="hd">$args</span><span class="hk">[</span><span class="hd">0</span><span class="hk">])&nbsp;?&nbsp;</span><span class="hd">$args</span><span class="hk">[</span><span class="hd">0</span><span class="hk">]&nbsp;:&nbsp;</span><span class="hd">Request</span><span class="hk">::</span><span class="hd">ORIGINAL</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$flags&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">Image</span><span class="hk">::</span><span class="hd">FIT</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$request&nbsp;</span><span class="hk">=&nbsp;new&nbsp;</span><span class="hd">ImageRequest</span><span class="hk">(</span><span class="hd">$image</span><span class="hk">,&nbsp;</span><span class="hd">$dimensions</span><span class="hk">,&nbsp;</span><span class="hd">$flags</span><span class="hk">,&nbsp;</span><span class="hd">TRUE</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$request</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;the&nbsp;image&nbsp;request&nbsp;from&nbsp;the&nbsp;image&nbsp;macro&nbsp;arguments.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;Meta&nbsp;&nbsp;$image<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;array&nbsp;$args<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;ImageRequest<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;static&nbsp;function&nbsp;</span><span class="hd">fromMacro</span><span class="hk">(</span><span class="hd">Meta&nbsp;$image&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">NULL</span><span class="hk">,&nbsp;</span><span class="hd">$args&nbsp;</span><span class="hk">=&nbsp;array())<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span class="hd">$image&nbsp;</span><span class="hk">===&nbsp;</span><span class="hd">NULL</span><span class="hk">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$image&nbsp;</span><span class="hk">=&nbsp;new&nbsp;</span><span class="hd">EmptyImage</span><span class="hk">();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;</span><span class="hd">ImageRequest</span><span class="hk">(</span><span class="hd">$image</span><span class="hk">,&nbsp;isset(</span><span class="hd">$args</span><span class="hk">[</span><span class="hd">0</span><span class="hk">])&nbsp;?&nbsp;</span><span class="hd">$args</span><span class="hk">[</span><span class="hd">0</span><span class="hk">]&nbsp;:&nbsp;</span><span class="hd">Request</span><span class="hk">::</span><span class="hd">ORIGINAL</span><span class="hk">,&nbsp;isset(</span><span class="hd">$args</span><span class="hk">[</span><span class="hd">1</span><span class="hk">])&nbsp;?&nbsp;</span><span class="hd">$args</span><span class="hk">[</span><span class="hd">1</span><span class="hk">]&nbsp;:&nbsp;</span><span class="hd">Request</span><span class="hk">::</span><span class="hd">ORIGINAL</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;boolean<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">getCrop</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">crop</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;Meta<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">getMeta</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">meta</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;Meta&nbsp;$meta<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;Request<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">setMeta</span><span class="hk">(</span><span class="hd">Meta&nbsp;$meta</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">meta&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$meta</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">getDimensions</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">dimensions</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;integer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">getFlags</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">flags</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />}<br /></span>
</span>
</code>		</div>
		</div>
	</div>
		<div>
		<table>
		<tr class='light'>
			<td class="number"><small>100 %</small></td>
			<td><div class="bar"><div style="width: 100%"></div></div></td>
			<td><a href="#F15" class="toggle">ImageStore/File.php</a></td>
		</tr>
		</table>

		<div class="code" id="F15">
		<div>
			<aside>
			<div><a href='#F15L1' id='F15L1'>  1</a>
<a href='#F15L2' id='F15L2'>  2</a>
<a href='#F15L3' id='F15L3'>  3</a>
<a href='#F15L4' id='F15L4'>  4</a>
<a href='#F15L5' id='F15L5'>  5</a>
<a href='#F15L6' id='F15L6'>  6</a>
<a href='#F15L7' id='F15L7'>  7</a>
<a href='#F15L8' id='F15L8'>  8</a></div><div class='t'><a href='#F15L9' id='F15L9'>  9</a></div><div><a href='#F15L10' id='F15L10'> 10</a>
<a href='#F15L11' id='F15L11'> 11</a>
<a href='#F15L12' id='F15L12'> 12</a>
<a href='#F15L13' id='F15L13'> 13</a>
<a href='#F15L14' id='F15L14'> 14</a>
<a href='#F15L15' id='F15L15'> 15</a>
<a href='#F15L16' id='F15L16'> 16</a>
<a href='#F15L17' id='F15L17'> 17</a>
<a href='#F15L18' id='F15L18'> 18</a>
<a href='#F15L19' id='F15L19'> 19</a>
<a href='#F15L20' id='F15L20'> 20</a>
<a href='#F15L21' id='F15L21'> 21</a>
<a href='#F15L22' id='F15L22'> 22</a>
<a href='#F15L23' id='F15L23'> 23</a>
<a href='#F15L24' id='F15L24'> 24</a>
<a href='#F15L25' id='F15L25'> 25</a>
<a href='#F15L26' id='F15L26'> 26</a>
<a href='#F15L27' id='F15L27'> 27</a>
<a href='#F15L28' id='F15L28'> 28</a>
<a href='#F15L29' id='F15L29'> 29</a>
<a href='#F15L30' id='F15L30'> 30</a>
<a href='#F15L31' id='F15L31'> 31</a>
<a href='#F15L32' id='F15L32'> 32</a>
<a href='#F15L33' id='F15L33'> 33</a>
<a href='#F15L34' id='F15L34'> 34</a>
<a href='#F15L35' id='F15L35'> 35</a>
<a href='#F15L36' id='F15L36'> 36</a>
<a href='#F15L37' id='F15L37'> 37</a>
<a href='#F15L38' id='F15L38'> 38</a>
<a href='#F15L39' id='F15L39'> 39</a>
<a href='#F15L40' id='F15L40'> 40</a>
<a href='#F15L41' id='F15L41'> 41</a>
<a href='#F15L42' id='F15L42'> 42</a>
<a href='#F15L43' id='F15L43'> 43</a>
<a href='#F15L44' id='F15L44'> 44</a>
<a href='#F15L45' id='F15L45'> 45</a>
</div>			</aside>
			<code style='margin-left: 3em'><span class="hh">
<span class="hd">&lt;?php<br /><br /></span><span class="hk">namespace&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">;<br /><br /><br /></span><span class="hc">/**<br />&nbsp;*&nbsp;Image&nbsp;file&nbsp;interface<br />&nbsp;*/<br /></span><span class="hk">interface&nbsp;</span><span class="hd">File<br /></span><span class="hk">{<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;image&nbsp;filename.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">getName</span><span class="hk">();<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;image&nbsp;type.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;integer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">getType</span><span class="hk">();<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Sets&nbsp;the&nbsp;image&nbsp;filename.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;$name<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">setName</span><span class="hk">(</span><span class="hd">$name</span><span class="hk">);<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Sets&nbsp;the&nbsp;image&nbsp;type.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;integer&nbsp;$type<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">setType</span><span class="hk">(</span><span class="hd">$type</span><span class="hk">);<br /><br /><br />}<br /></span>
</span>
</code>		</div>
		</div>
	</div>
	
	<footer>
		<p>Generated by <a href="https://tester.nette.org">Nette Tester</a> at 2016/05/02 01:52:56</p>
	</footer>

	<script>
	document.body.addEventListener('click', function (e) {
		if (e.target.className === 'toggle') {
			var el = document.getElementById(e.target.href.split('#')[1]);
			if (el.style.display === 'block') {
				el.style.display = 'none';
			} else {
				el.style.display = 'block';
			}
			e.preventDefault();
		}
	});

	if (el = document.getElementById(window.location.hash.replace(/^#|L\d+$/g, ''))) {
		el.style.display = 'block';
	}
	</script>
</body>
</html>
