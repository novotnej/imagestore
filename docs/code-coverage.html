<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="robots" content="noindex,noarchive">
	<meta name="generator" content="Nette Tester">

	<title>Code coverage</title>

	<style type="text/css">
	html {
		font: 14px/1.5 Verdana,"Geneva CE",lucida,sans-serif;
		border-top: 4.7em solid #f4ebdb;
	}

	body {
		max-width: 990px;
		margin: -4.7em auto 0;
		background: #fcfaf5;
		color: #333;
	}

	footer {
		margin-left: .5em;
	}

	h1 {
		font-family: "Trebuchet MS","Geneva CE",lucida,sans-serif;
		font-size: 1.9em;
		margin: .5em .5em 1.5em;
		color: #7a7772;
		text-shadow: 1px 1px 0 white;
	}

	div.code {
		background: white;
		border: 1px dotted silver;
		padding: .4em 0;
		display: none;
		color: #333;
		overflow: auto;
	}

	code,
	div.code {
		font: 13px/1.3 monospace;
	}

	div.code > div {
		float: left;
		min-width: 100%;
		position: relative;
	}

	aside {
		min-width: 100%;
		position: absolute;
	}

	aside div {
		white-space: pre;
		padding-left: .7em;
	}

	aside a {
		color: #c0c0c0;
	}

	aside a:hover {
		color: inherit;
		font-weight: bold;
		text-decoration: none;
	}

	code {
		display: block;
		white-space: nowrap;
		position: relative;
	}

	a {
		color: #006aeb;
		text-decoration: none;
	}

	a:active,
	a:hover {
		text-decoration: underline;
	}

	td {
		vertical-align: middle;
	}

	small {
		color: gray;
	}

	.number {
		text-align: right;
		width: 50px;
	}

	.bar {
		border: 1px solid #acacac;
		background: #e50400;
		width: 35px;
		height: 1em;
	}

	.bar div {
		background: #1a7e1e;
		height: 1em;
	}

	.light td {
		opacity: .5;
	}

	.light td * {
		color: gray;
	}

	.not-loaded td * {
		color: red;
	}

	.t { background-color: #e0ffe0; }
	.u { background-color: #ffe0e0; }

	code .hc { color: #929292; }
	code .hd { color: #333; }
	code .hh { color: #06B; }
	code .hk { color: #e71818; }
	code .hs { color: #008000; }
	</style>
</head>

<body>
	<h1>Code coverage 100&nbsp;%</h1>

		<div>
		<table>
		<tr>
			<td class="number"><small>100 %</small></td>
			<td><div class="bar"><div style="width: 100%"></div></div></td>
			<td><a href="#F0" class="toggle">ImageStore/Directory/Directory.php</a></td>
		</tr>
		</table>

		<div class="code" id="F0">
		<div>
			<aside>
			<div><a href='#F0L1' id='F0L1'>  1</a>
<a href='#F0L2' id='F0L2'>  2</a>
<a href='#F0L3' id='F0L3'>  3</a>
<a href='#F0L4' id='F0L4'>  4</a>
<a href='#F0L5' id='F0L5'>  5</a>
<a href='#F0L6' id='F0L6'>  6</a>
<a href='#F0L7' id='F0L7'>  7</a>
<a href='#F0L8' id='F0L8'>  8</a>
<a href='#F0L9' id='F0L9'>  9</a>
<a href='#F0L10' id='F0L10'> 10</a>
<a href='#F0L11' id='F0L11'> 11</a>
<a href='#F0L12' id='F0L12'> 12</a></div><div class='t'><a href='#F0L13' id='F0L13'> 13</a></div><div><a href='#F0L14' id='F0L14'> 14</a>
<a href='#F0L15' id='F0L15'> 15</a>
<a href='#F0L16' id='F0L16'> 16</a>
<a href='#F0L17' id='F0L17'> 17</a>
<a href='#F0L18' id='F0L18'> 18</a>
<a href='#F0L19' id='F0L19'> 19</a>
<a href='#F0L20' id='F0L20'> 20</a>
<a href='#F0L21' id='F0L21'> 21</a>
<a href='#F0L22' id='F0L22'> 22</a>
<a href='#F0L23' id='F0L23'> 23</a>
<a href='#F0L24' id='F0L24'> 24</a>
<a href='#F0L25' id='F0L25'> 25</a>
<a href='#F0L26' id='F0L26'> 26</a></div><div class='t'><a href='#F0L27' id='F0L27'> 27</a>
<a href='#F0L28' id='F0L28'> 28</a></div><div><a href='#F0L29' id='F0L29'> 29</a>
<a href='#F0L30' id='F0L30'> 30</a>
<a href='#F0L31' id='F0L31'> 31</a>
<a href='#F0L32' id='F0L32'> 32</a>
<a href='#F0L33' id='F0L33'> 33</a>
<a href='#F0L34' id='F0L34'> 34</a>
<a href='#F0L35' id='F0L35'> 35</a>
<a href='#F0L36' id='F0L36'> 36</a>
<a href='#F0L37' id='F0L37'> 37</a>
<a href='#F0L38' id='F0L38'> 38</a>
<a href='#F0L39' id='F0L39'> 39</a>
<a href='#F0L40' id='F0L40'> 40</a></div><div class='t'><a href='#F0L41' id='F0L41'> 41</a>
<a href='#F0L42' id='F0L42'> 42</a></div><div><a href='#F0L43' id='F0L43'> 43</a></div><div class='t'><a href='#F0L44' id='F0L44'> 44</a>
<a href='#F0L45' id='F0L45'> 45</a>
<a href='#F0L46' id='F0L46'> 46</a>
<a href='#F0L47' id='F0L47'> 47</a>
<a href='#F0L48' id='F0L48'> 48</a>
<a href='#F0L49' id='F0L49'> 49</a>
<a href='#F0L50' id='F0L50'> 50</a>
<a href='#F0L51' id='F0L51'> 51</a>
<a href='#F0L52' id='F0L52'> 52</a>
<a href='#F0L53' id='F0L53'> 53</a></div><div><a href='#F0L54' id='F0L54'> 54</a></div><div class='t'><a href='#F0L55' id='F0L55'> 55</a>
<a href='#F0L56' id='F0L56'> 56</a></div><div class='dead'><a href='#F0L57' id='F0L57'> 57</a></div><div><a href='#F0L58' id='F0L58'> 58</a></div><div class='t'><a href='#F0L59' id='F0L59'> 59</a></div><div class='dead'><a href='#F0L60' id='F0L60'> 60</a></div><div><a href='#F0L61' id='F0L61'> 61</a>
<a href='#F0L62' id='F0L62'> 62</a>
<a href='#F0L63' id='F0L63'> 63</a>
<a href='#F0L64' id='F0L64'> 64</a>
<a href='#F0L65' id='F0L65'> 65</a>
<a href='#F0L66' id='F0L66'> 66</a>
<a href='#F0L67' id='F0L67'> 67</a></div><div class='t'><a href='#F0L68' id='F0L68'> 68</a></div><div class='dead'><a href='#F0L69' id='F0L69'> 69</a></div><div><a href='#F0L70' id='F0L70'> 70</a>
<a href='#F0L71' id='F0L71'> 71</a>
<a href='#F0L72' id='F0L72'> 72</a>
<a href='#F0L73' id='F0L73'> 73</a>
<a href='#F0L74' id='F0L74'> 74</a>
<a href='#F0L75' id='F0L75'> 75</a>
<a href='#F0L76' id='F0L76'> 76</a>
<a href='#F0L77' id='F0L77'> 77</a>
<a href='#F0L78' id='F0L78'> 78</a>
<a href='#F0L79' id='F0L79'> 79</a></div><div class='t'><a href='#F0L80' id='F0L80'> 80</a></div><div class='dead'><a href='#F0L81' id='F0L81'> 81</a></div><div><a href='#F0L82' id='F0L82'> 82</a>
<a href='#F0L83' id='F0L83'> 83</a>
<a href='#F0L84' id='F0L84'> 84</a>
</div>			</aside>
			<code style='margin-left: 3em'><span class="hh">
<span class="hd">&lt;?php<br /><br /></span><span class="hk">namespace&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Directory</span><span class="hk">;<br /><br /><br />use&nbsp;</span><span class="hd">Nette</span><span class="hk">\</span><span class="hd">Object</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Exceptions</span><span class="hk">\</span><span class="hd">DirectoryException</span><span class="hk">;<br /><br /></span><span class="hc">/**<br />&nbsp;*&nbsp;Directory&nbsp;wrapper<br />&nbsp;*/<br /></span><span class="hk">class&nbsp;</span><span class="hd">Directory&nbsp;</span><span class="hk">extends&nbsp;</span><span class="hd">Object<br /></span><span class="hk">{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;</span><span class="hd">$name</span><span class="hk">;<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;&nbsp;$name<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;boolean&nbsp;$tryCreateDirectories<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">__construct</span><span class="hk">(</span><span class="hd">$name</span><span class="hk">,&nbsp;</span><span class="hd">$tryCreateDirectories&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">TRUE</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">name&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">check</span><span class="hk">(</span><span class="hd">$name</span><span class="hk">,&nbsp;</span><span class="hd">$tryCreateDirectories</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Checks&nbsp;a&nbsp;directory&nbsp;to&nbsp;be&nbsp;existing&nbsp;and&nbsp;writable.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Tries&nbsp;to&nbsp;create&nbsp;it&nbsp;if&nbsp;it&nbsp;does&nbsp;not&nbsp;exist.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;&nbsp;$name&nbsp;Directory&nbsp;name<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;boolean&nbsp;$tryCreateDirectories<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string&nbsp;Existing&nbsp;and&nbsp;writable&nbsp;directory&nbsp;name<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;function&nbsp;</span><span class="hd">check</span><span class="hk">(</span><span class="hd">$name</span><span class="hk">,&nbsp;</span><span class="hd">$tryCreateDirectories&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">TRUE</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$exists&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">TRUE</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$isWritable&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">TRUE</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span class="hd">file_exists</span><span class="hk">(</span><span class="hd">$name</span><span class="hk">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$exists&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">FALSE</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span class="hd">$tryCreateDirectories</span><span class="hk">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">umask</span><span class="hk">(</span><span class="hd">0002</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$exists&nbsp;</span><span class="hk">=&nbsp;@</span><span class="hd">mkdir</span><span class="hk">(</span><span class="hd">$name</span><span class="hk">,&nbsp;</span><span class="hd">0750</span><span class="hk">,&nbsp;</span><span class="hd">TRUE</span><span class="hk">);&nbsp;</span><span class="hc">//&nbsp;@:&nbsp;will&nbsp;be&nbsp;escalated&nbsp;to&nbsp;exception&nbsp;on&nbsp;failure<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span class="hd">is_writable</span><span class="hk">(</span><span class="hd">$name</span><span class="hk">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$isWritable&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">FALSE</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span class="hd">$exists&nbsp;</span><span class="hk">||&nbsp;!</span><span class="hd">$isWritable</span><span class="hk">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span class="hd">DirectoryException</span><span class="hk">(</span><span class="hd">$name</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$name</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">__toString</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(string)&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">name</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;TRUE&nbsp;if&nbsp;the&nbsp;compared&nbsp;directory&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;this,&nbsp;FALSE&nbsp;otherwise.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;Directory&nbsp;$to<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;boolean<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">is</span><span class="hk">(</span><span class="hd">Directory&nbsp;$to</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">realpath</span><span class="hk">(</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">name</span><span class="hk">)&nbsp;===&nbsp;</span><span class="hd">realpath</span><span class="hk">(</span><span class="hd">$to</span><span class="hk">-&gt;</span><span class="hd">name</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />}<br /></span>
</span>
</code>		</div>
		</div>
	</div>
		<div>
		<table>
		<tr class='light'>
			<td class="number"><small>100 %</small></td>
			<td><div class="bar"><div style="width: 100%"></div></div></td>
			<td><a href="#F1" class="toggle">ImageStore/Meta.php</a></td>
		</tr>
		</table>

		<div class="code" id="F1">
		<div>
			<aside>
			<div><a href='#F1L1' id='F1L1'>  1</a>
<a href='#F1L2' id='F1L2'>  2</a>
<a href='#F1L3' id='F1L3'>  3</a>
<a href='#F1L4' id='F1L4'>  4</a>
<a href='#F1L5' id='F1L5'>  5</a>
<a href='#F1L6' id='F1L6'>  6</a>
<a href='#F1L7' id='F1L7'>  7</a>
<a href='#F1L8' id='F1L8'>  8</a></div><div class='t'><a href='#F1L9' id='F1L9'>  9</a></div><div><a href='#F1L10' id='F1L10'> 10</a>
<a href='#F1L11' id='F1L11'> 11</a>
<a href='#F1L12' id='F1L12'> 12</a>
<a href='#F1L13' id='F1L13'> 13</a>
<a href='#F1L14' id='F1L14'> 14</a>
<a href='#F1L15' id='F1L15'> 15</a>
<a href='#F1L16' id='F1L16'> 16</a>
<a href='#F1L17' id='F1L17'> 17</a>
<a href='#F1L18' id='F1L18'> 18</a>
<a href='#F1L19' id='F1L19'> 19</a>
<a href='#F1L20' id='F1L20'> 20</a>
<a href='#F1L21' id='F1L21'> 21</a>
<a href='#F1L22' id='F1L22'> 22</a>
<a href='#F1L23' id='F1L23'> 23</a>
<a href='#F1L24' id='F1L24'> 24</a>
<a href='#F1L25' id='F1L25'> 25</a>
<a href='#F1L26' id='F1L26'> 26</a>
<a href='#F1L27' id='F1L27'> 27</a>
<a href='#F1L28' id='F1L28'> 28</a>
<a href='#F1L29' id='F1L29'> 29</a>
<a href='#F1L30' id='F1L30'> 30</a>
<a href='#F1L31' id='F1L31'> 31</a>
<a href='#F1L32' id='F1L32'> 32</a>
<a href='#F1L33' id='F1L33'> 33</a>
<a href='#F1L34' id='F1L34'> 34</a>
<a href='#F1L35' id='F1L35'> 35</a>
<a href='#F1L36' id='F1L36'> 36</a>
<a href='#F1L37' id='F1L37'> 37</a>
<a href='#F1L38' id='F1L38'> 38</a>
<a href='#F1L39' id='F1L39'> 39</a>
<a href='#F1L40' id='F1L40'> 40</a>
<a href='#F1L41' id='F1L41'> 41</a>
<a href='#F1L42' id='F1L42'> 42</a>
</div>			</aside>
			<code style='margin-left: 3em'><span class="hh">
<span class="hd">&lt;?php<br /><br /></span><span class="hk">namespace&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">;<br /><br /><br /></span><span class="hc">/**<br />&nbsp;*&nbsp;Image&nbsp;meta&nbsp;information&nbsp;interface<br />&nbsp;*/<br /></span><span class="hk">interface&nbsp;</span><span class="hd">Meta<br /></span><span class="hk">{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;image&nbsp;SHA1&nbsp;hash.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">getHash</span><span class="hk">();<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;image&nbsp;type.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;integer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">getType</span><span class="hk">();<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Sets&nbsp;the&nbsp;image&nbsp;SHA1&nbsp;hash.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;$hash<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">setHash</span><span class="hk">(</span><span class="hd">$hash</span><span class="hk">);<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Sets&nbsp;the&nbsp;image&nbsp;type.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;integer&nbsp;$type<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">setType</span><span class="hk">(</span><span class="hd">$type</span><span class="hk">);<br />}<br /></span>
</span>
</code>		</div>
		</div>
	</div>
		<div>
		<table>
		<tr>
			<td class="number"><small>100 %</small></td>
			<td><div class="bar"><div style="width: 100%"></div></div></td>
			<td><a href="#F2" class="toggle">ImageStore/Files/ImageFile.php</a></td>
		</tr>
		</table>

		<div class="code" id="F2">
		<div>
			<aside>
			<div><a href='#F2L1' id='F2L1'>  1</a>
<a href='#F2L2' id='F2L2'>  2</a>
<a href='#F2L3' id='F2L3'>  3</a>
<a href='#F2L4' id='F2L4'>  4</a>
<a href='#F2L5' id='F2L5'>  5</a>
<a href='#F2L6' id='F2L6'>  6</a>
<a href='#F2L7' id='F2L7'>  7</a>
<a href='#F2L8' id='F2L8'>  8</a>
<a href='#F2L9' id='F2L9'>  9</a>
<a href='#F2L10' id='F2L10'> 10</a>
<a href='#F2L11' id='F2L11'> 11</a></div><div class='t'><a href='#F2L12' id='F2L12'> 12</a></div><div><a href='#F2L13' id='F2L13'> 13</a>
<a href='#F2L14' id='F2L14'> 14</a>
<a href='#F2L15' id='F2L15'> 15</a>
<a href='#F2L16' id='F2L16'> 16</a>
<a href='#F2L17' id='F2L17'> 17</a>
<a href='#F2L18' id='F2L18'> 18</a>
<a href='#F2L19' id='F2L19'> 19</a>
<a href='#F2L20' id='F2L20'> 20</a>
<a href='#F2L21' id='F2L21'> 21</a>
<a href='#F2L22' id='F2L22'> 22</a>
<a href='#F2L23' id='F2L23'> 23</a>
<a href='#F2L24' id='F2L24'> 24</a>
<a href='#F2L25' id='F2L25'> 25</a>
<a href='#F2L26' id='F2L26'> 26</a>
<a href='#F2L27' id='F2L27'> 27</a>
<a href='#F2L28' id='F2L28'> 28</a>
<a href='#F2L29' id='F2L29'> 29</a>
<a href='#F2L30' id='F2L30'> 30</a>
<a href='#F2L31' id='F2L31'> 31</a></div><div class='t'><a href='#F2L32' id='F2L32'> 32</a></div><div><a href='#F2L33' id='F2L33'> 33</a></div><div class='t'><a href='#F2L34' id='F2L34'> 34</a>
<a href='#F2L35' id='F2L35'> 35</a></div><div class='dead'><a href='#F2L36' id='F2L36'> 36</a></div><div class='t'><a href='#F2L37' id='F2L37'> 37</a>
<a href='#F2L38' id='F2L38'> 38</a>
<a href='#F2L39' id='F2L39'> 39</a></div><div><a href='#F2L40' id='F2L40'> 40</a>
<a href='#F2L41' id='F2L41'> 41</a>
<a href='#F2L42' id='F2L42'> 42</a>
<a href='#F2L43' id='F2L43'> 43</a></div><div class='t'><a href='#F2L44' id='F2L44'> 44</a></div><div class='dead'><a href='#F2L45' id='F2L45'> 45</a></div><div><a href='#F2L46' id='F2L46'> 46</a>
<a href='#F2L47' id='F2L47'> 47</a>
<a href='#F2L48' id='F2L48'> 48</a>
<a href='#F2L49' id='F2L49'> 49</a></div><div class='t'><a href='#F2L50' id='F2L50'> 50</a>
<a href='#F2L51' id='F2L51'> 51</a></div><div><a href='#F2L52' id='F2L52'> 52</a>
<a href='#F2L53' id='F2L53'> 53</a>
<a href='#F2L54' id='F2L54'> 54</a>
<a href='#F2L55' id='F2L55'> 55</a></div><div class='t'><a href='#F2L56' id='F2L56'> 56</a></div><div class='dead'><a href='#F2L57' id='F2L57'> 57</a></div><div><a href='#F2L58' id='F2L58'> 58</a>
<a href='#F2L59' id='F2L59'> 59</a>
<a href='#F2L60' id='F2L60'> 60</a>
<a href='#F2L61' id='F2L61'> 61</a></div><div class='t'><a href='#F2L62' id='F2L62'> 62</a>
<a href='#F2L63' id='F2L63'> 63</a></div><div><a href='#F2L64' id='F2L64'> 64</a>
<a href='#F2L65' id='F2L65'> 65</a>
</div>			</aside>
			<code style='margin-left: 3em'><span class="hh">
<span class="hd">&lt;?php<br /><br /></span><span class="hk">namespace&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Files</span><span class="hk">;<br /><br /><br />use&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Exceptions</span><span class="hk">\</span><span class="hd">ImageFileException</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">File</span><span class="hk">;<br /><br /></span><span class="hc">/**<br />&nbsp;*&nbsp;Simple&nbsp;image&nbsp;file&nbsp;wrapper<br />&nbsp;*/<br /></span><span class="hk">class&nbsp;</span><span class="hd">ImageFile&nbsp;</span><span class="hk">implements&nbsp;</span><span class="hd">File<br /></span><span class="hk">{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;file&nbsp;name<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;</span><span class="hd">$name</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;image&nbsp;type<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;integer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;</span><span class="hd">$type</span><span class="hk">;<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span class="hd">__construct</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$info&nbsp;</span><span class="hk">=&nbsp;@</span><span class="hd">getimagesize</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">);&nbsp;</span><span class="hc">//&nbsp;@:&nbsp;will&nbsp;be&nbsp;escalated&nbsp;to&nbsp;exception&nbsp;on&nbsp;failure<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">if&nbsp;(</span><span class="hd">$info&nbsp;</span><span class="hk">===&nbsp;</span><span class="hd">FALSE</span><span class="hk">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span class="hd">ImageFileException</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">setName</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">setType</span><span class="hk">(</span><span class="hd">$info</span><span class="hk">[</span><span class="hd">2</span><span class="hk">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span class="hd">getType</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">type</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span class="hd">setType</span><span class="hk">(</span><span class="hd">$type</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">type&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$type</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span class="hd">getName</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">name</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span class="hd">setName</span><span class="hk">(</span><span class="hd">$name</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">name&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$name</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />}<br /></span>
</span>
</code>		</div>
		</div>
	</div>
		<div>
		<table>
		<tr>
			<td class="number"><small>100 %</small></td>
			<td><div class="bar"><div style="width: 100%"></div></div></td>
			<td><a href="#F3" class="toggle">ImageStore/ImageStorage.php</a></td>
		</tr>
		</table>

		<div class="code" id="F3">
		<div>
			<aside>
			<div><a href='#F3L1' id='F3L1'>   1</a>
<a href='#F3L2' id='F3L2'>   2</a>
<a href='#F3L3' id='F3L3'>   3</a>
<a href='#F3L4' id='F3L4'>   4</a>
<a href='#F3L5' id='F3L5'>   5</a>
<a href='#F3L6' id='F3L6'>   6</a>
<a href='#F3L7' id='F3L7'>   7</a>
<a href='#F3L8' id='F3L8'>   8</a>
<a href='#F3L9' id='F3L9'>   9</a>
<a href='#F3L10' id='F3L10'>  10</a>
<a href='#F3L11' id='F3L11'>  11</a>
<a href='#F3L12' id='F3L12'>  12</a>
<a href='#F3L13' id='F3L13'>  13</a>
<a href='#F3L14' id='F3L14'>  14</a>
<a href='#F3L15' id='F3L15'>  15</a>
<a href='#F3L16' id='F3L16'>  16</a>
<a href='#F3L17' id='F3L17'>  17</a>
<a href='#F3L18' id='F3L18'>  18</a>
<a href='#F3L19' id='F3L19'>  19</a>
<a href='#F3L20' id='F3L20'>  20</a>
<a href='#F3L21' id='F3L21'>  21</a>
<a href='#F3L22' id='F3L22'>  22</a>
<a href='#F3L23' id='F3L23'>  23</a>
<a href='#F3L24' id='F3L24'>  24</a>
<a href='#F3L25' id='F3L25'>  25</a>
<a href='#F3L26' id='F3L26'>  26</a>
<a href='#F3L27' id='F3L27'>  27</a>
<a href='#F3L28' id='F3L28'>  28</a></div><div class='t'><a href='#F3L29' id='F3L29'>  29</a></div><div><a href='#F3L30' id='F3L30'>  30</a>
<a href='#F3L31' id='F3L31'>  31</a>
<a href='#F3L32' id='F3L32'>  32</a>
<a href='#F3L33' id='F3L33'>  33</a>
<a href='#F3L34' id='F3L34'>  34</a>
<a href='#F3L35' id='F3L35'>  35</a>
<a href='#F3L36' id='F3L36'>  36</a>
<a href='#F3L37' id='F3L37'>  37</a>
<a href='#F3L38' id='F3L38'>  38</a>
<a href='#F3L39' id='F3L39'>  39</a>
<a href='#F3L40' id='F3L40'>  40</a>
<a href='#F3L41' id='F3L41'>  41</a>
<a href='#F3L42' id='F3L42'>  42</a>
<a href='#F3L43' id='F3L43'>  43</a>
<a href='#F3L44' id='F3L44'>  44</a>
<a href='#F3L45' id='F3L45'>  45</a>
<a href='#F3L46' id='F3L46'>  46</a>
<a href='#F3L47' id='F3L47'>  47</a>
<a href='#F3L48' id='F3L48'>  48</a>
<a href='#F3L49' id='F3L49'>  49</a>
<a href='#F3L50' id='F3L50'>  50</a>
<a href='#F3L51' id='F3L51'>  51</a>
<a href='#F3L52' id='F3L52'>  52</a>
<a href='#F3L53' id='F3L53'>  53</a>
<a href='#F3L54' id='F3L54'>  54</a>
<a href='#F3L55' id='F3L55'>  55</a>
<a href='#F3L56' id='F3L56'>  56</a>
<a href='#F3L57' id='F3L57'>  57</a>
<a href='#F3L58' id='F3L58'>  58</a>
<a href='#F3L59' id='F3L59'>  59</a>
<a href='#F3L60' id='F3L60'>  60</a>
<a href='#F3L61' id='F3L61'>  61</a>
<a href='#F3L62' id='F3L62'>  62</a>
<a href='#F3L63' id='F3L63'>  63</a>
<a href='#F3L64' id='F3L64'>  64</a>
<a href='#F3L65' id='F3L65'>  65</a>
<a href='#F3L66' id='F3L66'>  66</a>
<a href='#F3L67' id='F3L67'>  67</a>
<a href='#F3L68' id='F3L68'>  68</a>
<a href='#F3L69' id='F3L69'>  69</a>
<a href='#F3L70' id='F3L70'>  70</a>
<a href='#F3L71' id='F3L71'>  71</a>
<a href='#F3L72' id='F3L72'>  72</a>
<a href='#F3L73' id='F3L73'>  73</a>
<a href='#F3L74' id='F3L74'>  74</a>
<a href='#F3L75' id='F3L75'>  75</a>
<a href='#F3L76' id='F3L76'>  76</a>
<a href='#F3L77' id='F3L77'>  77</a></div><div class='t'><a href='#F3L78' id='F3L78'>  78</a>
<a href='#F3L79' id='F3L79'>  79</a></div><div><a href='#F3L80' id='F3L80'>  80</a></div><div class='t'><a href='#F3L81' id='F3L81'>  81</a>
<a href='#F3L82' id='F3L82'>  82</a></div><div class='dead'><a href='#F3L83' id='F3L83'>  83</a></div><div><a href='#F3L84' id='F3L84'>  84</a></div><div class='t'><a href='#F3L85' id='F3L85'>  85</a>
<a href='#F3L86' id='F3L86'>  86</a></div><div><a href='#F3L87' id='F3L87'>  87</a>
<a href='#F3L88' id='F3L88'>  88</a>
<a href='#F3L89' id='F3L89'>  89</a>
<a href='#F3L90' id='F3L90'>  90</a>
<a href='#F3L91' id='F3L91'>  91</a>
<a href='#F3L92' id='F3L92'>  92</a>
<a href='#F3L93' id='F3L93'>  93</a>
<a href='#F3L94' id='F3L94'>  94</a>
<a href='#F3L95' id='F3L95'>  95</a>
<a href='#F3L96' id='F3L96'>  96</a>
<a href='#F3L97' id='F3L97'>  97</a></div><div class='t'><a href='#F3L98' id='F3L98'>  98</a></div><div><a href='#F3L99' id='F3L99'>  99</a></div><div class='t'><a href='#F3L100' id='F3L100'> 100</a></div><div class='dead'><a href='#F3L101' id='F3L101'> 101</a></div><div><a href='#F3L102' id='F3L102'> 102</a>
<a href='#F3L103' id='F3L103'> 103</a>
<a href='#F3L104' id='F3L104'> 104</a>
<a href='#F3L105' id='F3L105'> 105</a>
<a href='#F3L106' id='F3L106'> 106</a>
<a href='#F3L107' id='F3L107'> 107</a>
<a href='#F3L108' id='F3L108'> 108</a>
<a href='#F3L109' id='F3L109'> 109</a>
<a href='#F3L110' id='F3L110'> 110</a>
<a href='#F3L111' id='F3L111'> 111</a>
<a href='#F3L112' id='F3L112'> 112</a></div><div class='t'><a href='#F3L113' id='F3L113'> 113</a>
<a href='#F3L114' id='F3L114'> 114</a>
<a href='#F3L115' id='F3L115'> 115</a>
<a href='#F3L116' id='F3L116'> 116</a>
<a href='#F3L117' id='F3L117'> 117</a>
<a href='#F3L118' id='F3L118'> 118</a></div><div><a href='#F3L119' id='F3L119'> 119</a>
<a href='#F3L120' id='F3L120'> 120</a>
<a href='#F3L121' id='F3L121'> 121</a>
<a href='#F3L122' id='F3L122'> 122</a>
<a href='#F3L123' id='F3L123'> 123</a>
<a href='#F3L124' id='F3L124'> 124</a>
<a href='#F3L125' id='F3L125'> 125</a>
<a href='#F3L126' id='F3L126'> 126</a>
<a href='#F3L127' id='F3L127'> 127</a>
<a href='#F3L128' id='F3L128'> 128</a></div><div class='t'><a href='#F3L129' id='F3L129'> 129</a>
<a href='#F3L130' id='F3L130'> 130</a>
<a href='#F3L131' id='F3L131'> 131</a></div><div><a href='#F3L132' id='F3L132'> 132</a></div><div class='t'><a href='#F3L133' id='F3L133'> 133</a></div><div><a href='#F3L134' id='F3L134'> 134</a></div><div class='t'><a href='#F3L135' id='F3L135'> 135</a></div><div><a href='#F3L136' id='F3L136'> 136</a></div><div class='t'><a href='#F3L137' id='F3L137'> 137</a></div><div class='dead'><a href='#F3L138' id='F3L138'> 138</a></div><div><a href='#F3L139' id='F3L139'> 139</a>
<a href='#F3L140' id='F3L140'> 140</a>
<a href='#F3L141' id='F3L141'> 141</a>
<a href='#F3L142' id='F3L142'> 142</a>
<a href='#F3L143' id='F3L143'> 143</a>
<a href='#F3L144' id='F3L144'> 144</a>
<a href='#F3L145' id='F3L145'> 145</a>
<a href='#F3L146' id='F3L146'> 146</a>
<a href='#F3L147' id='F3L147'> 147</a>
<a href='#F3L148' id='F3L148'> 148</a></div><div class='t'><a href='#F3L149' id='F3L149'> 149</a></div><div class='dead'><a href='#F3L150' id='F3L150'> 150</a></div><div><a href='#F3L151' id='F3L151'> 151</a>
<a href='#F3L152' id='F3L152'> 152</a>
<a href='#F3L153' id='F3L153'> 153</a>
<a href='#F3L154' id='F3L154'> 154</a>
<a href='#F3L155' id='F3L155'> 155</a>
<a href='#F3L156' id='F3L156'> 156</a>
<a href='#F3L157' id='F3L157'> 157</a>
<a href='#F3L158' id='F3L158'> 158</a></div><div class='t'><a href='#F3L159' id='F3L159'> 159</a></div><div><a href='#F3L160' id='F3L160'> 160</a>
<a href='#F3L161' id='F3L161'> 161</a>
<a href='#F3L162' id='F3L162'> 162</a>
<a href='#F3L163' id='F3L163'> 163</a>
<a href='#F3L164' id='F3L164'> 164</a></div><div class='t'><a href='#F3L165' id='F3L165'> 165</a>
<a href='#F3L166' id='F3L166'> 166</a></div><div class='dead'><a href='#F3L167' id='F3L167'> 167</a></div><div><a href='#F3L168' id='F3L168'> 168</a></div><div class='t'><a href='#F3L169' id='F3L169'> 169</a></div><div class='dead'><a href='#F3L170' id='F3L170'> 170</a></div><div><a href='#F3L171' id='F3L171'> 171</a>
<a href='#F3L172' id='F3L172'> 172</a>
<a href='#F3L173' id='F3L173'> 173</a>
<a href='#F3L174' id='F3L174'> 174</a>
<a href='#F3L175' id='F3L175'> 175</a>
<a href='#F3L176' id='F3L176'> 176</a>
<a href='#F3L177' id='F3L177'> 177</a>
<a href='#F3L178' id='F3L178'> 178</a>
<a href='#F3L179' id='F3L179'> 179</a>
<a href='#F3L180' id='F3L180'> 180</a>
<a href='#F3L181' id='F3L181'> 181</a></div><div class='t'><a href='#F3L182' id='F3L182'> 182</a></div><div class='dead'><a href='#F3L183' id='F3L183'> 183</a></div><div><a href='#F3L184' id='F3L184'> 184</a>
<a href='#F3L185' id='F3L185'> 185</a>
<a href='#F3L186' id='F3L186'> 186</a>
<a href='#F3L187' id='F3L187'> 187</a>
<a href='#F3L188' id='F3L188'> 188</a>
<a href='#F3L189' id='F3L189'> 189</a>
<a href='#F3L190' id='F3L190'> 190</a>
<a href='#F3L191' id='F3L191'> 191</a>
<a href='#F3L192' id='F3L192'> 192</a>
<a href='#F3L193' id='F3L193'> 193</a></div><div class='t'><a href='#F3L194' id='F3L194'> 194</a>
<a href='#F3L195' id='F3L195'> 195</a></div><div><a href='#F3L196' id='F3L196'> 196</a></div><div class='t'><a href='#F3L197' id='F3L197'> 197</a></div><div class='dead'><a href='#F3L198' id='F3L198'> 198</a></div><div><a href='#F3L199' id='F3L199'> 199</a>
<a href='#F3L200' id='F3L200'> 200</a>
<a href='#F3L201' id='F3L201'> 201</a>
<a href='#F3L202' id='F3L202'> 202</a>
<a href='#F3L203' id='F3L203'> 203</a>
<a href='#F3L204' id='F3L204'> 204</a>
<a href='#F3L205' id='F3L205'> 205</a>
<a href='#F3L206' id='F3L206'> 206</a>
<a href='#F3L207' id='F3L207'> 207</a>
<a href='#F3L208' id='F3L208'> 208</a></div><div class='t'><a href='#F3L209' id='F3L209'> 209</a></div><div class='dead'><a href='#F3L210' id='F3L210'> 210</a></div><div><a href='#F3L211' id='F3L211'> 211</a>
<a href='#F3L212' id='F3L212'> 212</a>
<a href='#F3L213' id='F3L213'> 213</a>
<a href='#F3L214' id='F3L214'> 214</a>
<a href='#F3L215' id='F3L215'> 215</a>
<a href='#F3L216' id='F3L216'> 216</a>
<a href='#F3L217' id='F3L217'> 217</a>
<a href='#F3L218' id='F3L218'> 218</a>
<a href='#F3L219' id='F3L219'> 219</a>
<a href='#F3L220' id='F3L220'> 220</a></div><div class='t'><a href='#F3L221' id='F3L221'> 221</a></div><div><a href='#F3L222' id='F3L222'> 222</a></div><div class='t'><a href='#F3L223' id='F3L223'> 223</a></div><div class='dead'><a href='#F3L224' id='F3L224'> 224</a></div><div><a href='#F3L225' id='F3L225'> 225</a>
<a href='#F3L226' id='F3L226'> 226</a>
<a href='#F3L227' id='F3L227'> 227</a>
<a href='#F3L228' id='F3L228'> 228</a>
<a href='#F3L229' id='F3L229'> 229</a>
<a href='#F3L230' id='F3L230'> 230</a>
<a href='#F3L231' id='F3L231'> 231</a>
<a href='#F3L232' id='F3L232'> 232</a>
<a href='#F3L233' id='F3L233'> 233</a>
<a href='#F3L234' id='F3L234'> 234</a></div><div class='t'><a href='#F3L235' id='F3L235'> 235</a></div><div class='dead'><a href='#F3L236' id='F3L236'> 236</a></div><div><a href='#F3L237' id='F3L237'> 237</a>
<a href='#F3L238' id='F3L238'> 238</a>
<a href='#F3L239' id='F3L239'> 239</a>
<a href='#F3L240' id='F3L240'> 240</a>
<a href='#F3L241' id='F3L241'> 241</a>
<a href='#F3L242' id='F3L242'> 242</a>
<a href='#F3L243' id='F3L243'> 243</a>
<a href='#F3L244' id='F3L244'> 244</a>
<a href='#F3L245' id='F3L245'> 245</a>
<a href='#F3L246' id='F3L246'> 246</a>
<a href='#F3L247' id='F3L247'> 247</a>
<a href='#F3L248' id='F3L248'> 248</a></div><div class='t'><a href='#F3L249' id='F3L249'> 249</a>
<a href='#F3L250' id='F3L250'> 250</a></div><div class='dead'><a href='#F3L251' id='F3L251'> 251</a></div><div><a href='#F3L252' id='F3L252'> 252</a></div><div class='t'><a href='#F3L253' id='F3L253'> 253</a>
<a href='#F3L254' id='F3L254'> 254</a>
<a href='#F3L255' id='F3L255'> 255</a></div><div><a href='#F3L256' id='F3L256'> 256</a></div><div class='t'><a href='#F3L257' id='F3L257'> 257</a>
<a href='#F3L258' id='F3L258'> 258</a>
<a href='#F3L259' id='F3L259'> 259</a>
<a href='#F3L260' id='F3L260'> 260</a>
<a href='#F3L261' id='F3L261'> 261</a>
<a href='#F3L262' id='F3L262'> 262</a></div><div><a href='#F3L263' id='F3L263'> 263</a></div><div class='t'><a href='#F3L264' id='F3L264'> 264</a>
<a href='#F3L265' id='F3L265'> 265</a></div><div><a href='#F3L266' id='F3L266'> 266</a></div><div class='t'><a href='#F3L267' id='F3L267'> 267</a></div><div class='dead'><a href='#F3L268' id='F3L268'> 268</a></div><div><a href='#F3L269' id='F3L269'> 269</a>
<a href='#F3L270' id='F3L270'> 270</a>
<a href='#F3L271' id='F3L271'> 271</a>
<a href='#F3L272' id='F3L272'> 272</a>
<a href='#F3L273' id='F3L273'> 273</a>
<a href='#F3L274' id='F3L274'> 274</a>
<a href='#F3L275' id='F3L275'> 275</a>
<a href='#F3L276' id='F3L276'> 276</a>
<a href='#F3L277' id='F3L277'> 277</a>
<a href='#F3L278' id='F3L278'> 278</a></div><div class='t'><a href='#F3L279' id='F3L279'> 279</a>
<a href='#F3L280' id='F3L280'> 280</a></div><div><a href='#F3L281' id='F3L281'> 281</a></div><div class='t'><a href='#F3L282' id='F3L282'> 282</a></div><div class='dead'><a href='#F3L283' id='F3L283'> 283</a></div><div><a href='#F3L284' id='F3L284'> 284</a>
<a href='#F3L285' id='F3L285'> 285</a>
<a href='#F3L286' id='F3L286'> 286</a>
<a href='#F3L287' id='F3L287'> 287</a>
<a href='#F3L288' id='F3L288'> 288</a>
<a href='#F3L289' id='F3L289'> 289</a>
<a href='#F3L290' id='F3L290'> 290</a>
<a href='#F3L291' id='F3L291'> 291</a>
<a href='#F3L292' id='F3L292'> 292</a>
<a href='#F3L293' id='F3L293'> 293</a></div><div class='t'><a href='#F3L294' id='F3L294'> 294</a>
<a href='#F3L295' id='F3L295'> 295</a></div><div><a href='#F3L296' id='F3L296'> 296</a></div><div class='t'><a href='#F3L297' id='F3L297'> 297</a></div><div class='dead'><a href='#F3L298' id='F3L298'> 298</a></div><div><a href='#F3L299' id='F3L299'> 299</a>
<a href='#F3L300' id='F3L300'> 300</a>
<a href='#F3L301' id='F3L301'> 301</a>
<a href='#F3L302' id='F3L302'> 302</a>
<a href='#F3L303' id='F3L303'> 303</a>
<a href='#F3L304' id='F3L304'> 304</a>
<a href='#F3L305' id='F3L305'> 305</a>
<a href='#F3L306' id='F3L306'> 306</a>
<a href='#F3L307' id='F3L307'> 307</a>
<a href='#F3L308' id='F3L308'> 308</a></div><div class='t'><a href='#F3L309' id='F3L309'> 309</a>
<a href='#F3L310' id='F3L310'> 310</a>
<a href='#F3L311' id='F3L311'> 311</a>
<a href='#F3L312' id='F3L312'> 312</a>
<a href='#F3L313' id='F3L313'> 313</a>
<a href='#F3L314' id='F3L314'> 314</a></div><div><a href='#F3L315' id='F3L315'> 315</a></div><div class='t'><a href='#F3L316' id='F3L316'> 316</a></div><div class='dead'><a href='#F3L317' id='F3L317'> 317</a></div><div><a href='#F3L318' id='F3L318'> 318</a>
<a href='#F3L319' id='F3L319'> 319</a>
<a href='#F3L320' id='F3L320'> 320</a>
<a href='#F3L321' id='F3L321'> 321</a>
<a href='#F3L322' id='F3L322'> 322</a>
<a href='#F3L323' id='F3L323'> 323</a>
<a href='#F3L324' id='F3L324'> 324</a>
<a href='#F3L325' id='F3L325'> 325</a>
<a href='#F3L326' id='F3L326'> 326</a>
<a href='#F3L327' id='F3L327'> 327</a></div><div class='t'><a href='#F3L328' id='F3L328'> 328</a></div><div><a href='#F3L329' id='F3L329'> 329</a></div><div class='t'><a href='#F3L330' id='F3L330'> 330</a></div><div><a href='#F3L331' id='F3L331'> 331</a></div><div class='t'><a href='#F3L332' id='F3L332'> 332</a></div><div><a href='#F3L333' id='F3L333'> 333</a></div><div class='t'><a href='#F3L334' id='F3L334'> 334</a></div><div><a href='#F3L335' id='F3L335'> 335</a>
<a href='#F3L336' id='F3L336'> 336</a></div><div class='t'><a href='#F3L337' id='F3L337'> 337</a>
<a href='#F3L338' id='F3L338'> 338</a>
<a href='#F3L339' id='F3L339'> 339</a></div><div><a href='#F3L340' id='F3L340'> 340</a></div><div class='t'><a href='#F3L341' id='F3L341'> 341</a></div><div><a href='#F3L342' id='F3L342'> 342</a></div><div class='t'><a href='#F3L343' id='F3L343'> 343</a></div><div><a href='#F3L344' id='F3L344'> 344</a></div><div class='t'><a href='#F3L345' id='F3L345'> 345</a>
<a href='#F3L346' id='F3L346'> 346</a>
<a href='#F3L347' id='F3L347'> 347</a>
<a href='#F3L348' id='F3L348'> 348</a></div><div><a href='#F3L349' id='F3L349'> 349</a></div><div class='t'><a href='#F3L350' id='F3L350'> 350</a>
<a href='#F3L351' id='F3L351'> 351</a>
<a href='#F3L352' id='F3L352'> 352</a>
<a href='#F3L353' id='F3L353'> 353</a></div><div><a href='#F3L354' id='F3L354'> 354</a>
<a href='#F3L355' id='F3L355'> 355</a>
<a href='#F3L356' id='F3L356'> 356</a>
<a href='#F3L357' id='F3L357'> 357</a>
<a href='#F3L358' id='F3L358'> 358</a>
<a href='#F3L359' id='F3L359'> 359</a>
<a href='#F3L360' id='F3L360'> 360</a>
<a href='#F3L361' id='F3L361'> 361</a>
<a href='#F3L362' id='F3L362'> 362</a>
<a href='#F3L363' id='F3L363'> 363</a></div><div class='t'><a href='#F3L364' id='F3L364'> 364</a></div><div><a href='#F3L365' id='F3L365'> 365</a></div><div class='t'><a href='#F3L366' id='F3L366'> 366</a></div><div class='dead'><a href='#F3L367' id='F3L367'> 367</a></div><div><a href='#F3L368' id='F3L368'> 368</a>
<a href='#F3L369' id='F3L369'> 369</a>
<a href='#F3L370' id='F3L370'> 370</a>
<a href='#F3L371' id='F3L371'> 371</a>
<a href='#F3L372' id='F3L372'> 372</a>
<a href='#F3L373' id='F3L373'> 373</a>
<a href='#F3L374' id='F3L374'> 374</a>
<a href='#F3L375' id='F3L375'> 375</a>
<a href='#F3L376' id='F3L376'> 376</a>
<a href='#F3L377' id='F3L377'> 377</a>
<a href='#F3L378' id='F3L378'> 378</a></div><div class='t'><a href='#F3L379' id='F3L379'> 379</a></div><div><a href='#F3L380' id='F3L380'> 380</a></div><div class='t'><a href='#F3L381' id='F3L381'> 381</a></div><div class='dead'><a href='#F3L382' id='F3L382'> 382</a></div><div><a href='#F3L383' id='F3L383'> 383</a></div><div class='t'><a href='#F3L384' id='F3L384'> 384</a></div><div><a href='#F3L385' id='F3L385'> 385</a></div><div class='t'><a href='#F3L386' id='F3L386'> 386</a>
<a href='#F3L387' id='F3L387'> 387</a></div><div><a href='#F3L388' id='F3L388'> 388</a></div><div class='t'><a href='#F3L389' id='F3L389'> 389</a>
<a href='#F3L390' id='F3L390'> 390</a>
<a href='#F3L391' id='F3L391'> 391</a></div><div><a href='#F3L392' id='F3L392'> 392</a></div><div class='t'><a href='#F3L393' id='F3L393'> 393</a>
<a href='#F3L394' id='F3L394'> 394</a></div><div><a href='#F3L395' id='F3L395'> 395</a></div><div class='t'><a href='#F3L396' id='F3L396'> 396</a></div><div><a href='#F3L397' id='F3L397'> 397</a></div><div class='t'><a href='#F3L398' id='F3L398'> 398</a></div><div><a href='#F3L399' id='F3L399'> 399</a></div><div class='t'><a href='#F3L400' id='F3L400'> 400</a>
<a href='#F3L401' id='F3L401'> 401</a></div><div><a href='#F3L402' id='F3L402'> 402</a></div><div class='t'><a href='#F3L403' id='F3L403'> 403</a>
<a href='#F3L404' id='F3L404'> 404</a></div><div><a href='#F3L405' id='F3L405'> 405</a></div><div class='t'><a href='#F3L406' id='F3L406'> 406</a>
<a href='#F3L407' id='F3L407'> 407</a>
<a href='#F3L408' id='F3L408'> 408</a></div><div><a href='#F3L409' id='F3L409'> 409</a></div><div class='t'><a href='#F3L410' id='F3L410'> 410</a>
<a href='#F3L411' id='F3L411'> 411</a>
<a href='#F3L412' id='F3L412'> 412</a></div><div><a href='#F3L413' id='F3L413'> 413</a></div><div class='t'><a href='#F3L414' id='F3L414'> 414</a></div><div><a href='#F3L415' id='F3L415'> 415</a></div><div class='t'><a href='#F3L416' id='F3L416'> 416</a>
<a href='#F3L417' id='F3L417'> 417</a></div><div><a href='#F3L418' id='F3L418'> 418</a></div><div class='t'><a href='#F3L419' id='F3L419'> 419</a>
<a href='#F3L420' id='F3L420'> 420</a></div><div><a href='#F3L421' id='F3L421'> 421</a>
<a href='#F3L422' id='F3L422'> 422</a></div><div class='t'><a href='#F3L423' id='F3L423'> 423</a></div><div><a href='#F3L424' id='F3L424'> 424</a></div><div class='t'><a href='#F3L425' id='F3L425'> 425</a></div><div><a href='#F3L426' id='F3L426'> 426</a></div><div class='t'><a href='#F3L427' id='F3L427'> 427</a>
<a href='#F3L428' id='F3L428'> 428</a></div><div><a href='#F3L429' id='F3L429'> 429</a></div><div class='t'><a href='#F3L430' id='F3L430'> 430</a>
<a href='#F3L431' id='F3L431'> 431</a></div><div><a href='#F3L432' id='F3L432'> 432</a></div><div class='t'><a href='#F3L433' id='F3L433'> 433</a></div><div><a href='#F3L434' id='F3L434'> 434</a></div><div class='t'><a href='#F3L435' id='F3L435'> 435</a>
<a href='#F3L436' id='F3L436'> 436</a></div><div><a href='#F3L437' id='F3L437'> 437</a></div><div class='t'><a href='#F3L438' id='F3L438'> 438</a>
<a href='#F3L439' id='F3L439'> 439</a></div><div><a href='#F3L440' id='F3L440'> 440</a>
<a href='#F3L441' id='F3L441'> 441</a>
<a href='#F3L442' id='F3L442'> 442</a>
<a href='#F3L443' id='F3L443'> 443</a></div><div class='t'><a href='#F3L444' id='F3L444'> 444</a>
<a href='#F3L445' id='F3L445'> 445</a></div><div><a href='#F3L446' id='F3L446'> 446</a></div><div class='t'><a href='#F3L447' id='F3L447'> 447</a></div><div class='dead'><a href='#F3L448' id='F3L448'> 448</a></div><div><a href='#F3L449' id='F3L449'> 449</a>
<a href='#F3L450' id='F3L450'> 450</a>
<a href='#F3L451' id='F3L451'> 451</a>
<a href='#F3L452' id='F3L452'> 452</a>
<a href='#F3L453' id='F3L453'> 453</a>
<a href='#F3L454' id='F3L454'> 454</a>
<a href='#F3L455' id='F3L455'> 455</a>
<a href='#F3L456' id='F3L456'> 456</a>
<a href='#F3L457' id='F3L457'> 457</a>
<a href='#F3L458' id='F3L458'> 458</a>
<a href='#F3L459' id='F3L459'> 459</a></div><div class='t'><a href='#F3L460' id='F3L460'> 460</a></div><div><a href='#F3L461' id='F3L461'> 461</a></div><div class='t'><a href='#F3L462' id='F3L462'> 462</a></div><div class='dead'><a href='#F3L463' id='F3L463'> 463</a></div><div><a href='#F3L464' id='F3L464'> 464</a></div><div class='t'><a href='#F3L465' id='F3L465'> 465</a></div><div><a href='#F3L466' id='F3L466'> 466</a></div><div class='t'><a href='#F3L467' id='F3L467'> 467</a></div><div class='dead'><a href='#F3L468' id='F3L468'> 468</a></div><div><a href='#F3L469' id='F3L469'> 469</a>
<a href='#F3L470' id='F3L470'> 470</a>
<a href='#F3L471' id='F3L471'> 471</a>
<a href='#F3L472' id='F3L472'> 472</a>
<a href='#F3L473' id='F3L473'> 473</a>
<a href='#F3L474' id='F3L474'> 474</a>
<a href='#F3L475' id='F3L475'> 475</a>
<a href='#F3L476' id='F3L476'> 476</a>
<a href='#F3L477' id='F3L477'> 477</a>
<a href='#F3L478' id='F3L478'> 478</a></div><div class='t'><a href='#F3L479' id='F3L479'> 479</a>
<a href='#F3L480' id='F3L480'> 480</a>
<a href='#F3L481' id='F3L481'> 481</a></div><div><a href='#F3L482' id='F3L482'> 482</a></div><div class='t'><a href='#F3L483' id='F3L483'> 483</a>
<a href='#F3L484' id='F3L484'> 484</a>
<a href='#F3L485' id='F3L485'> 485</a></div><div><a href='#F3L486' id='F3L486'> 486</a></div><div class='t'><a href='#F3L487' id='F3L487'> 487</a></div><div class='dead'><a href='#F3L488' id='F3L488'> 488</a></div><div><a href='#F3L489' id='F3L489'> 489</a>
<a href='#F3L490' id='F3L490'> 490</a>
<a href='#F3L491' id='F3L491'> 491</a>
<a href='#F3L492' id='F3L492'> 492</a>
<a href='#F3L493' id='F3L493'> 493</a>
<a href='#F3L494' id='F3L494'> 494</a>
<a href='#F3L495' id='F3L495'> 495</a>
<a href='#F3L496' id='F3L496'> 496</a>
<a href='#F3L497' id='F3L497'> 497</a>
<a href='#F3L498' id='F3L498'> 498</a></div><div class='t'><a href='#F3L499' id='F3L499'> 499</a>
<a href='#F3L500' id='F3L500'> 500</a>
<a href='#F3L501' id='F3L501'> 501</a>
<a href='#F3L502' id='F3L502'> 502</a>
<a href='#F3L503' id='F3L503'> 503</a>
<a href='#F3L504' id='F3L504'> 504</a>
<a href='#F3L505' id='F3L505'> 505</a></div><div><a href='#F3L506' id='F3L506'> 506</a>
<a href='#F3L507' id='F3L507'> 507</a></div><div class='t'><a href='#F3L508' id='F3L508'> 508</a></div><div class='dead'><a href='#F3L509' id='F3L509'> 509</a></div><div><a href='#F3L510' id='F3L510'> 510</a>
<a href='#F3L511' id='F3L511'> 511</a>
<a href='#F3L512' id='F3L512'> 512</a>
<a href='#F3L513' id='F3L513'> 513</a>
<a href='#F3L514' id='F3L514'> 514</a>
<a href='#F3L515' id='F3L515'> 515</a>
<a href='#F3L516' id='F3L516'> 516</a>
<a href='#F3L517' id='F3L517'> 517</a>
<a href='#F3L518' id='F3L518'> 518</a>
<a href='#F3L519' id='F3L519'> 519</a>
<a href='#F3L520' id='F3L520'> 520</a>
<a href='#F3L521' id='F3L521'> 521</a>
<a href='#F3L522' id='F3L522'> 522</a>
<a href='#F3L523' id='F3L523'> 523</a></div><div class='t'><a href='#F3L524' id='F3L524'> 524</a>
<a href='#F3L525' id='F3L525'> 525</a></div><div class='dead'><a href='#F3L526' id='F3L526'> 526</a></div><div><a href='#F3L527' id='F3L527'> 527</a></div><div class='t'><a href='#F3L528' id='F3L528'> 528</a></div><div class='dead'><a href='#F3L529' id='F3L529'> 529</a></div><div><a href='#F3L530' id='F3L530'> 530</a>
<a href='#F3L531' id='F3L531'> 531</a>
<a href='#F3L532' id='F3L532'> 532</a>
<a href='#F3L533' id='F3L533'> 533</a>
<a href='#F3L534' id='F3L534'> 534</a>
<a href='#F3L535' id='F3L535'> 535</a>
<a href='#F3L536' id='F3L536'> 536</a>
<a href='#F3L537' id='F3L537'> 537</a>
<a href='#F3L538' id='F3L538'> 538</a>
<a href='#F3L539' id='F3L539'> 539</a></div><div class='t'><a href='#F3L540' id='F3L540'> 540</a></div><div class='dead'><a href='#F3L541' id='F3L541'> 541</a></div><div><a href='#F3L542' id='F3L542'> 542</a>
<a href='#F3L543' id='F3L543'> 543</a>
<a href='#F3L544' id='F3L544'> 544</a>
<a href='#F3L545' id='F3L545'> 545</a>
<a href='#F3L546' id='F3L546'> 546</a>
<a href='#F3L547' id='F3L547'> 547</a>
<a href='#F3L548' id='F3L548'> 548</a>
<a href='#F3L549' id='F3L549'> 549</a>
<a href='#F3L550' id='F3L550'> 550</a>
<a href='#F3L551' id='F3L551'> 551</a></div><div class='t'><a href='#F3L552' id='F3L552'> 552</a></div><div class='dead'><a href='#F3L553' id='F3L553'> 553</a></div><div><a href='#F3L554' id='F3L554'> 554</a>
<a href='#F3L555' id='F3L555'> 555</a>
<a href='#F3L556' id='F3L556'> 556</a>
<a href='#F3L557' id='F3L557'> 557</a>
<a href='#F3L558' id='F3L558'> 558</a>
<a href='#F3L559' id='F3L559'> 559</a>
<a href='#F3L560' id='F3L560'> 560</a>
<a href='#F3L561' id='F3L561'> 561</a>
<a href='#F3L562' id='F3L562'> 562</a></div><div class='t'><a href='#F3L563' id='F3L563'> 563</a></div><div class='dead'><a href='#F3L564' id='F3L564'> 564</a></div><div><a href='#F3L565' id='F3L565'> 565</a>
<a href='#F3L566' id='F3L566'> 566</a>
<a href='#F3L567' id='F3L567'> 567</a>
<a href='#F3L568' id='F3L568'> 568</a>
<a href='#F3L569' id='F3L569'> 569</a>
<a href='#F3L570' id='F3L570'> 570</a>
<a href='#F3L571' id='F3L571'> 571</a>
<a href='#F3L572' id='F3L572'> 572</a>
<a href='#F3L573' id='F3L573'> 573</a>
<a href='#F3L574' id='F3L574'> 574</a></div><div class='t'><a href='#F3L575' id='F3L575'> 575</a>
<a href='#F3L576' id='F3L576'> 576</a>
<a href='#F3L577' id='F3L577'> 577</a>
<a href='#F3L578' id='F3L578'> 578</a></div><div><a href='#F3L579' id='F3L579'> 579</a></div><div class='t'><a href='#F3L580' id='F3L580'> 580</a></div><div class='dead'><a href='#F3L581' id='F3L581'> 581</a></div><div><a href='#F3L582' id='F3L582'> 582</a>
<a href='#F3L583' id='F3L583'> 583</a>
<a href='#F3L584' id='F3L584'> 584</a>
</div>			</aside>
			<code style='margin-left: 4em'><span class="hh">
<span class="hd">&lt;?php<br /><br /></span><span class="hk">namespace&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">;<br /><br /><br />use&nbsp;</span><span class="hd">Nette</span><span class="hk">\</span><span class="hd">Application</span><span class="hk">\</span><span class="hd">AbortException</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Nette</span><span class="hk">\</span><span class="hd">Application</span><span class="hk">\</span><span class="hd">Responses</span><span class="hk">\</span><span class="hd">FileResponse</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Nette</span><span class="hk">\</span><span class="hd">Http</span><span class="hk">\</span><span class="hd">FileUpload</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Nette</span><span class="hk">\</span><span class="hd">Object</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Nette</span><span class="hk">\</span><span class="hd">Utils</span><span class="hk">\</span><span class="hd">Image</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Nette</span><span class="hk">\</span><span class="hd">Utils</span><span class="hk">\</span><span class="hd">Strings</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Directory</span><span class="hk">\</span><span class="hd">Directory</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Entity</span><span class="hk">\</span><span class="hd">EmptyImage</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Entity</span><span class="hk">\</span><span class="hd">ImageEnvelope</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Exceptions</span><span class="hk">\</span><span class="hd">ImageTypeException</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Exceptions</span><span class="hk">\</span><span class="hd">InvalidCacheDirectoryException</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Files</span><span class="hk">\</span><span class="hd">ImageFile</span><span class="hk">;<br /><br /></span><span class="hc">/**<br />&nbsp;*&nbsp;Image&nbsp;file&nbsp;storage<br />&nbsp;*<br />&nbsp;*&nbsp;-&nbsp;The&nbsp;images&nbsp;are&nbsp;stored&nbsp;in&nbsp;a&nbsp;regular&nbsp;files&nbsp;in&nbsp;the&nbsp;given&nbsp;`$directory`.<br />&nbsp;*&nbsp;-&nbsp;The&nbsp;files&nbsp;are&nbsp;organized&nbsp;in&nbsp;a&nbsp;2-level&nbsp;directory&nbsp;structure&nbsp;with&nbsp;maximum&nbsp;of&nbsp;256²&nbsp;directories.<br />&nbsp;*&nbsp;-&nbsp;The&nbsp;directory&nbsp;tree&nbsp;is&nbsp;well&nbsp;balanced&nbsp;thanks&nbsp;to&nbsp;the&nbsp;image&nbsp;hashes&nbsp;used&nbsp;for&nbsp;the&nbsp;directory&nbsp;path&nbsp;creation.<br />&nbsp;*&nbsp;-&nbsp;The&nbsp;storage&nbsp;stores&nbsp;only&nbsp;one&nbsp;file&nbsp;even&nbsp;if&nbsp;the&nbsp;same&nbsp;image&nbsp;is&nbsp;stored&nbsp;multiple&nbsp;times,&nbsp;thus&nbsp;images&nbsp;should&nbsp;be<br />&nbsp;*&nbsp;&nbsp;&nbsp;deleted&nbsp;only&nbsp;after&nbsp;it&nbsp;is&nbsp;sure&nbsp;it&nbsp;is&nbsp;not&nbsp;referenced&nbsp;from&nbsp;other&nbsp;entities.<br />&nbsp;*&nbsp;-&nbsp;The&nbsp;image&nbsp;thumbnails&nbsp;are&nbsp;created&nbsp;on&nbsp;demand&nbsp;and&nbsp;cached&nbsp;in&nbsp;the&nbsp;`$cacheDirectory`.<br />&nbsp;*/<br /></span><span class="hk">class&nbsp;</span><span class="hd">ImageStorage&nbsp;</span><span class="hk">extends&nbsp;</span><span class="hd">Object&nbsp;</span><span class="hk">implements&nbsp;</span><span class="hd">Storage<br /></span><span class="hk">{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;directory&nbsp;to&nbsp;store&nbsp;the&nbsp;images&nbsp;in<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;Directory<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;</span><span class="hd">$directory</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;image&nbsp;type&nbsp;-&gt;&nbsp;file&nbsp;extension&nbsp;map<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;array<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;</span><span class="hd">$extensions&nbsp;</span><span class="hk">=&nbsp;array(</span><span class="hd">Image</span><span class="hk">::</span><span class="hd">JPEG&nbsp;</span><span class="hk">=&gt;&nbsp;</span><span class="hs">'jpg'</span><span class="hk">,&nbsp;</span><span class="hd">Image</span><span class="hk">::</span><span class="hd">PNG&nbsp;</span><span class="hk">=&gt;&nbsp;</span><span class="hs">'png'</span><span class="hk">,&nbsp;</span><span class="hd">Image</span><span class="hk">::</span><span class="hd">GIF&nbsp;</span><span class="hk">=&gt;&nbsp;</span><span class="hs">'gif'</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;image&nbsp;type&nbsp;-&gt;&nbsp;MIME&nbsp;type&nbsp;map<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;array<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;</span><span class="hd">$mimeTypes&nbsp;</span><span class="hk">=&nbsp;array(</span><span class="hd">Image</span><span class="hk">::</span><span class="hd">JPEG&nbsp;</span><span class="hk">=&gt;&nbsp;</span><span class="hs">'image/jpeg'</span><span class="hk">,&nbsp;</span><span class="hd">Image</span><span class="hk">::</span><span class="hd">PNG&nbsp;</span><span class="hk">=&gt;&nbsp;</span><span class="hs">'image/png'</span><span class="hk">,&nbsp;</span><span class="hd">Image</span><span class="hk">::</span><span class="hd">GIF&nbsp;</span><span class="hk">=&gt;&nbsp;</span><span class="hs">'image/gif'</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;public&nbsp;accessible&nbsp;URL&nbsp;of&nbsp;the&nbsp;cache&nbsp;directory<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;</span><span class="hd">$baseUrl</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;cache&nbsp;directory<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;Directory<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;</span><span class="hd">$cacheDirectory</span><span class="hk">;<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;the&nbsp;image&nbsp;file&nbsp;storage&nbsp;from&nbsp;the&nbsp;given&nbsp;arguments.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;&nbsp;$directory&nbsp;The&nbsp;directory&nbsp;to&nbsp;store&nbsp;the&nbsp;images&nbsp;in<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;&nbsp;$cacheDirectory<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;&nbsp;$baseUrl<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;boolean&nbsp;$tryCreateDirectories<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">__construct</span><span class="hk">(</span><span class="hd">$directory</span><span class="hk">,&nbsp;</span><span class="hd">$cacheDirectory</span><span class="hk">,&nbsp;</span><span class="hd">$baseUrl&nbsp;</span><span class="hk">=&nbsp;</span><span class="hs">'/cache/'</span><span class="hk">,&nbsp;</span><span class="hd">$tryCreateDirectories&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">TRUE</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">directory&nbsp;</span><span class="hk">=&nbsp;new&nbsp;</span><span class="hd">Directory</span><span class="hk">(</span><span class="hd">$directory</span><span class="hk">,&nbsp;</span><span class="hd">$tryCreateDirectories</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">cacheDirectory&nbsp;</span><span class="hk">=&nbsp;new&nbsp;</span><span class="hd">Directory</span><span class="hk">(</span><span class="hd">$cacheDirectory</span><span class="hk">,&nbsp;</span><span class="hd">$tryCreateDirectories</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">directory</span><span class="hk">-&gt;</span><span class="hd">is</span><span class="hk">(</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">cacheDirectory</span><span class="hk">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span class="hd">InvalidCacheDirectoryException</span><span class="hk">(</span><span class="hd">$cacheDirectory</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">setBaseUrl</span><span class="hk">(</span><span class="hd">$baseUrl</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Adds&nbsp;an&nbsp;image&nbsp;from&nbsp;the&nbsp;given&nbsp;file&nbsp;to&nbsp;the&nbsp;storage.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;ImageFile&nbsp;$file&nbsp;The&nbsp;image&nbsp;file&nbsp;to&nbsp;add<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;Meta&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$meta<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;boolean&nbsp;TRUE&nbsp;on&nbsp;success&nbsp;or&nbsp;FALSE&nbsp;on&nbsp;failure<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">add</span><span class="hk">(</span><span class="hd">ImageFile&nbsp;$file</span><span class="hk">,&nbsp;</span><span class="hd">Meta&nbsp;$meta</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">readMeta</span><span class="hk">(</span><span class="hd">$file</span><span class="hk">-&gt;</span><span class="hd">getName</span><span class="hk">(),&nbsp;</span><span class="hd">$meta</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">copy</span><span class="hk">(</span><span class="hd">$file</span><span class="hk">-&gt;</span><span class="hd">getName</span><span class="hk">(),&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">createFilename</span><span class="hk">(</span><span class="hd">$meta</span><span class="hk">));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Reads&nbsp;the&nbsp;image&nbsp;type&nbsp;from&nbsp;the&nbsp;given&nbsp;`$filename`,&nbsp;computes&nbsp;the&nbsp;image&nbsp;hash<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;and&nbsp;store&nbsp;these&nbsp;information&nbsp;in&nbsp;the&nbsp;given&nbsp;`$meta`.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;$filename&nbsp;The&nbsp;file&nbsp;to&nbsp;read&nbsp;the&nbsp;meta-data&nbsp;from<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;Meta&nbsp;&nbsp;&nbsp;$meta&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;object&nbsp;to&nbsp;store&nbsp;meta-data&nbsp;in<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;function&nbsp;</span><span class="hd">readMeta</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">,&nbsp;</span><span class="hd">Meta&nbsp;$meta</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$info&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">getimagesize</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$meta</span><span class="hk">-&gt;</span><span class="hd">setHash</span><span class="hk">(</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">hash</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$meta</span><span class="hk">-&gt;</span><span class="hd">setWidth</span><span class="hk">(</span><span class="hd">$info</span><span class="hk">[</span><span class="hd">0</span><span class="hk">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$meta</span><span class="hk">-&gt;</span><span class="hd">setHeight</span><span class="hk">(</span><span class="hd">$info</span><span class="hk">[</span><span class="hd">1</span><span class="hk">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$meta</span><span class="hk">-&gt;</span><span class="hd">setType</span><span class="hk">(</span><span class="hd">$info</span><span class="hk">[</span><span class="hd">2</span><span class="hk">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;the&nbsp;absolute&nbsp;file&nbsp;name&nbsp;from&nbsp;the&nbsp;given&nbsp;meta&nbsp;information.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;Meta&nbsp;$meta&nbsp;The&nbsp;image&nbsp;meta&nbsp;information<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string&nbsp;The&nbsp;absolute&nbsp;file&nbsp;name<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;function&nbsp;</span><span class="hd">createFilename</span><span class="hk">(</span><span class="hd">Meta&nbsp;$meta</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$path&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">createDirectoryPath</span><span class="hk">(</span><span class="hd">$meta</span><span class="hk">-&gt;</span><span class="hd">getHash</span><span class="hk">());<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$ext&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">getExtension</span><span class="hk">(</span><span class="hd">$meta</span><span class="hk">-&gt;</span><span class="hd">getType</span><span class="hk">());<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$hash&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$meta</span><span class="hk">-&gt;</span><span class="hd">getHash</span><span class="hk">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$filename&nbsp;</span><span class="hk">=&nbsp;</span><span class="hs">"</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">directory</span><span class="hs">/</span><span class="hd">$path</span><span class="hs">/</span><span class="hd">$hash</span><span class="hs">.</span><span class="hd">$ext</span><span class="hs">"</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;</span><span class="hd">Directory</span><span class="hk">(</span><span class="hd">dirname</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">));<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$filename</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Computes&nbsp;the&nbsp;SHA1&nbsp;hash&nbsp;for&nbsp;the&nbsp;given&nbsp;file.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;$filename&nbsp;The&nbsp;file&nbsp;to&nbsp;compute&nbsp;the&nbsp;hash&nbsp;from<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string&nbsp;The&nbsp;SHA1&nbsp;hash&nbsp;of&nbsp;a&nbsp;file<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;function&nbsp;</span><span class="hd">hash</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">sha1_file</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;the&nbsp;internal&nbsp;directory&nbsp;path&nbsp;from&nbsp;the&nbsp;given&nbsp;hash.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Some&nbsp;special&nbsp;images&nbsp;like&nbsp;the&nbsp;"Image&nbsp;Not&nbsp;Available"&nbsp;image&nbsp;are&nbsp;stored<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;in&nbsp;directories&nbsp;prefixed&nbsp;with&nbsp;an&nbsp;underscore.&nbsp;Those&nbsp;directories&nbsp;are&nbsp;not<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;fragmented&nbsp;to&nbsp;hash&nbsp;based&nbsp;structure.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;string&nbsp;$hash&nbsp;Tha&nbsp;SHA1&nbsp;hash<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;function&nbsp;</span><span class="hd">createDirectoryPath</span><span class="hk">(</span><span class="hd">$hash</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span class="hd">$hash</span><span class="hk">{</span><span class="hd">0</span><span class="hk">}&nbsp;===&nbsp;</span><span class="hs">'_'</span><span class="hk">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$hash</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hs">"</span><span class="hd">$hash</span><span class="hk">[</span><span class="hd">0</span><span class="hk">]</span><span class="hd">$hash</span><span class="hk">[</span><span class="hd">1</span><span class="hk">]</span><span class="hs">/</span><span class="hd">$hash</span><span class="hk">[</span><span class="hd">2</span><span class="hk">]</span><span class="hd">$hash</span><span class="hk">[</span><span class="hd">3</span><span class="hk">]</span><span class="hs">"</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;file&nbsp;extension&nbsp;for&nbsp;the&nbsp;given&nbsp;image&nbsp;type.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;integer&nbsp;$type&nbsp;The&nbsp;image&nbsp;type<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;file&nbsp;extension<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;ImageTypeException<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;function&nbsp;</span><span class="hd">getExtension</span><span class="hk">(</span><span class="hd">$type</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">extensions</span><span class="hk">[</span><span class="hd">$type</span><span class="hk">];<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Fetches&nbsp;the&nbsp;cached&nbsp;copy&nbsp;of&nbsp;an&nbsp;image&nbsp;by&nbsp;given&nbsp;request.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;Request&nbsp;$request&nbsp;The&nbsp;image&nbsp;request<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;Image<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">fetch</span><span class="hk">(</span><span class="hd">Request&nbsp;$request</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">checkImage</span><span class="hk">(</span><span class="hd">$request</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$filename&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">createCacheFilename</span><span class="hk">(</span><span class="hd">$request</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">Image</span><span class="hk">::</span><span class="hd">fromFile</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Fetches&nbsp;the&nbsp;original&nbsp;image&nbsp;by&nbsp;the&nbsp;given&nbsp;image&nbsp;meta&nbsp;information.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;Meta&nbsp;$meta&nbsp;The&nbsp;stored&nbsp;image&nbsp;meta&nbsp;information<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;Image&nbsp;The&nbsp;stored&nbsp;image<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">original</span><span class="hk">(</span><span class="hd">Meta&nbsp;$meta</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">Image</span><span class="hk">::</span><span class="hd">fromFile</span><span class="hk">(</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">createFilename</span><span class="hk">(</span><span class="hd">$meta</span><span class="hk">));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Removes&nbsp;the&nbsp;image&nbsp;from&nbsp;the&nbsp;storage&nbsp;by&nbsp;the&nbsp;given&nbsp;image&nbsp;meta&nbsp;information.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;Meta&nbsp;$meta&nbsp;The&nbsp;image&nbsp;information<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;ImageStorage&nbsp;Fluent&nbsp;interface<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">remove</span><span class="hk">(</span><span class="hd">Meta&nbsp;$meta</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">unlink</span><span class="hk">(</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">createFilename</span><span class="hk">(</span><span class="hd">$meta</span><span class="hk">));<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Checks&nbsp;if&nbsp;an&nbsp;image&nbsp;of&nbsp;the&nbsp;given&nbsp;meta&nbsp;information&nbsp;is&nbsp;stored&nbsp;in&nbsp;the&nbsp;storage.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;Meta&nbsp;$meta&nbsp;The&nbsp;image&nbsp;meta&nbsp;information<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;boolean&nbsp;TRUE&nbsp;if&nbsp;image&nbsp;is&nbsp;present&nbsp;in&nbsp;the&nbsp;storage&nbsp;or&nbsp;FALSE&nbsp;otherwise<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">contains</span><span class="hk">(</span><span class="hd">Meta&nbsp;$meta</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">file_exists</span><span class="hk">(</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">createFilename</span><span class="hk">(</span><span class="hd">$meta</span><span class="hk">));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Stores&nbsp;the&nbsp;given&nbsp;uploaded&nbsp;file.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;FileUpload&nbsp;$upload<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;meta&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$meta<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;ImageStorage&nbsp;Fluent&nbsp;interface<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;AbortException<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">upload</span><span class="hk">(</span><span class="hd">FileUpload&nbsp;$upload</span><span class="hk">,&nbsp;</span><span class="hd">Meta&nbsp;$meta</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span class="hd">$upload</span><span class="hk">-&gt;</span><span class="hd">getError</span><span class="hk">())&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span class="hd">UploaderException</span><span class="hk">(</span><span class="hd">$upload</span><span class="hk">-&gt;</span><span class="hd">getError</span><span class="hk">());<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$source&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$upload</span><span class="hk">-&gt;</span><span class="hd">getTemporaryFile</span><span class="hk">();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">readMeta</span><span class="hk">(</span><span class="hd">$source</span><span class="hk">,&nbsp;</span><span class="hd">$meta</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$target&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">createFilename</span><span class="hk">(</span><span class="hd">$meta</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">contains</span><span class="hk">(</span><span class="hd">$meta</span><span class="hk">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$image&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">Image</span><span class="hk">::</span><span class="hd">fromFile</span><span class="hk">(</span><span class="hd">$source</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$image</span><span class="hk">-&gt;</span><span class="hd">resize</span><span class="hk">(</span><span class="hd">1920</span><span class="hk">,&nbsp;</span><span class="hd">1080</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$image</span><span class="hk">-&gt;</span><span class="hd">save</span><span class="hk">(</span><span class="hd">$target</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span class="hd">file_exists</span><span class="hk">(</span><span class="hd">$source</span><span class="hk">))&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">unlink</span><span class="hk">(</span><span class="hd">$source</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;URL&nbsp;of&nbsp;the&nbsp;cached&nbsp;version&nbsp;of&nbsp;the&nbsp;image.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;Request&nbsp;$request&nbsp;The&nbsp;image&nbsp;request<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string&nbsp;&nbsp;The&nbsp;URL&nbsp;of&nbsp;the&nbsp;image<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">link</span><span class="hk">(</span><span class="hd">Request&nbsp;$request</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">checkImage</span><span class="hk">(</span><span class="hd">$request</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$filePath&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">createFilePath</span><span class="hk">(</span><span class="hd">$request</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hs">"</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">baseUrl$filePath</span><span class="hs">"</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;the&nbsp;file&nbsp;download&nbsp;HTTP&nbsp;response&nbsp;which&nbsp;can&nbsp;be&nbsp;easily&nbsp;sent&nbsp;using&nbsp;the&nbsp;`send()`&nbsp;method.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;Request&nbsp;$request&nbsp;The&nbsp;image&nbsp;request<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;FileResponse<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">download</span><span class="hk">(</span><span class="hd">Request&nbsp;$request</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">checkImage</span><span class="hk">(</span><span class="hd">$request</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$filename&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">createCacheFilename</span><span class="hk">(</span><span class="hd">$request</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;</span><span class="hd">FileResponse</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">,&nbsp;</span><span class="hd">basename</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">),&nbsp;</span><span class="hd">$request</span><span class="hk">-&gt;</span><span class="hd">getMeta</span><span class="hk">()-&gt;</span><span class="hd">getType</span><span class="hk">());<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Renders&nbsp;the&nbsp;image&nbsp;directly&nbsp;to&nbsp;the&nbsp;standard&nbsp;output.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;Request&nbsp;$request&nbsp;The&nbsp;image&nbsp;request<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;ImageStorage&nbsp;Fluent&nbsp;interface<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">send</span><span class="hk">(</span><span class="hd">Request&nbsp;$request</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">checkImage</span><span class="hk">(</span><span class="hd">$request</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$filename&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">createCacheFilename</span><span class="hk">(</span><span class="hd">$request</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$fp&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">fopen</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">,&nbsp;</span><span class="hs">'r'</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">header</span><span class="hk">(</span><span class="hs">"Content-type:&nbsp;"&nbsp;</span><span class="hk">.&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">getMimeType</span><span class="hk">(</span><span class="hd">$request</span><span class="hk">-&gt;</span><span class="hd">getMeta</span><span class="hk">()-&gt;</span><span class="hd">getType</span><span class="hk">()));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">fpassthru</span><span class="hk">(</span><span class="hd">$fp</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">fclose</span><span class="hk">(</span><span class="hd">$fp</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Checks&nbsp;that&nbsp;the&nbsp;cached&nbsp;version&nbsp;of&nbsp;the&nbsp;image&nbsp;exists&nbsp;and&nbsp;creates&nbsp;it&nbsp;if&nbsp;not.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;Request&nbsp;$request&nbsp;The&nbsp;image&nbsp;request<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string&nbsp;&nbsp;The&nbsp;file&nbsp;name&nbsp;of&nbsp;the&nbsp;existing&nbsp;cached&nbsp;version&nbsp;of&nbsp;an&nbsp;image<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;function&nbsp;</span><span class="hd">checkImage</span><span class="hk">(</span><span class="hd">Request&nbsp;$request</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$filename&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">createCacheFilename</span><span class="hk">(</span><span class="hd">$request</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span class="hd">file_exists</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">))&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$meta&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$request</span><span class="hk">-&gt;</span><span class="hd">getMeta</span><span class="hk">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">contains</span><span class="hk">(</span><span class="hd">$meta</span><span class="hk">))&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">//&nbsp;Use&nbsp;another&nbsp;meta<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$meta&nbsp;</span><span class="hk">=&nbsp;new&nbsp;</span><span class="hd">EmptyImage</span><span class="hk">();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$request</span><span class="hk">-&gt;</span><span class="hd">setMeta</span><span class="hk">(</span><span class="hd">$meta</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$filename&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">createCacheFilename</span><span class="hk">(</span><span class="hd">$request</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$original&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">original</span><span class="hk">(</span><span class="hd">$meta</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span class="hd">$request</span><span class="hk">-&gt;</span><span class="hd">getCrop</span><span class="hk">())&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$image&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">crop</span><span class="hk">(</span><span class="hd">$original</span><span class="hk">,&nbsp;</span><span class="hd">$request</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$image&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">resize</span><span class="hk">(</span><span class="hd">$original</span><span class="hk">,&nbsp;</span><span class="hd">$request</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;</span><span class="hd">Directory</span><span class="hk">(</span><span class="hd">dirname</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$image</span><span class="hk">-&gt;</span><span class="hd">save</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">,&nbsp;</span><span class="hd">75</span><span class="hk">,&nbsp;</span><span class="hd">$meta</span><span class="hk">-&gt;</span><span class="hd">getType</span><span class="hk">());<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;file&nbsp;name&nbsp;of&nbsp;the&nbsp;cached&nbsp;version&nbsp;of&nbsp;the&nbsp;image.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;Request&nbsp;$request<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string&nbsp;The&nbsp;file&nbsp;name&nbsp;of&nbsp;the&nbsp;cached&nbsp;version&nbsp;of&nbsp;the&nbsp;image<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;function&nbsp;</span><span class="hd">createCacheFilename</span><span class="hk">(</span><span class="hd">Request&nbsp;$request</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$filePath&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">createFilePath</span><span class="hk">(</span><span class="hd">$request</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hs">"</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">cacheDirectory</span><span class="hs">/</span><span class="hd">$filePath</span><span class="hs">"</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Crops&nbsp;the&nbsp;given&nbsp;image&nbsp;using&nbsp;the&nbsp;given&nbsp;image&nbsp;request&nbsp;options.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;Image&nbsp;&nbsp;&nbsp;$image&nbsp;&nbsp;&nbsp;The&nbsp;image&nbsp;to&nbsp;resize<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;Request&nbsp;$request&nbsp;The&nbsp;image&nbsp;request<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;Image&nbsp;&nbsp;&nbsp;The&nbsp;image&nbsp;thumbnail<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;function&nbsp;</span><span class="hd">crop</span><span class="hk">(</span><span class="hd">Image&nbsp;$image</span><span class="hk">,&nbsp;</span><span class="hd">Request&nbsp;$request</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span class="hd">$request</span><span class="hk">-&gt;</span><span class="hd">getDimensions</span><span class="hk">()&nbsp;===&nbsp;</span><span class="hd">Request</span><span class="hk">::</span><span class="hd">ORIGINAL</span><span class="hk">)&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$image</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list(</span><span class="hd">$width</span><span class="hk">,&nbsp;</span><span class="hd">$height</span><span class="hk">)&nbsp;=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">processDimensions</span><span class="hk">(</span><span class="hd">$request</span><span class="hk">-&gt;</span><span class="hd">getDimensions</span><span class="hk">());<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$resizeWidth&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$width</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$resizeHeight&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$height</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$originalWidth&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$request</span><span class="hk">-&gt;</span><span class="hd">getMeta</span><span class="hk">()-&gt;</span><span class="hd">getWidth</span><span class="hk">();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$originalHeight&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$request</span><span class="hk">-&gt;</span><span class="hd">getMeta</span><span class="hk">()-&gt;</span><span class="hd">getHeight</span><span class="hk">();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$originalLandscape&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$originalWidth&nbsp;</span><span class="hk">&gt;&nbsp;</span><span class="hd">$originalHeight</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$cropLandscape&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$width&nbsp;</span><span class="hk">&gt;&nbsp;</span><span class="hd">$height</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$equals&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$width&nbsp;</span><span class="hk">===&nbsp;</span><span class="hd">$height</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span class="hd">$originalLandscape</span><span class="hk">)&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span class="hd">$cropLandscape</span><span class="hk">)&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$coefficient&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$originalHeight&nbsp;</span><span class="hk">/&nbsp;</span><span class="hd">$height</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$scaledWidth&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">round</span><span class="hk">(</span><span class="hd">$originalWidth&nbsp;</span><span class="hk">/&nbsp;</span><span class="hd">$coefficient</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$left&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">round</span><span class="hk">((</span><span class="hd">$scaledWidth&nbsp;</span><span class="hk">-&nbsp;</span><span class="hd">$width</span><span class="hk">)&nbsp;/&nbsp;</span><span class="hd">2</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$top&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">0</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span class="hd">$scaledWidth&nbsp;</span><span class="hk">&lt;&nbsp;</span><span class="hd">$width</span><span class="hk">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$coefficient&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$originalWidth&nbsp;</span><span class="hk">/&nbsp;</span><span class="hd">$width</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$scaledHeight&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">round</span><span class="hk">(</span><span class="hd">$originalHeight&nbsp;</span><span class="hk">/&nbsp;</span><span class="hd">$coefficient</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$left&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">0</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$top&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">round</span><span class="hk">((</span><span class="hd">$scaledHeight&nbsp;</span><span class="hk">-&nbsp;</span><span class="hd">$height</span><span class="hk">)&nbsp;/&nbsp;</span><span class="hd">2</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$coefficient&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$originalHeight&nbsp;</span><span class="hk">/&nbsp;</span><span class="hd">$height</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$scaledWidth&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">round</span><span class="hk">(</span><span class="hd">$originalWidth&nbsp;</span><span class="hk">/&nbsp;</span><span class="hd">$coefficient</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$left&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">round</span><span class="hk">((</span><span class="hd">$scaledWidth&nbsp;</span><span class="hk">-&nbsp;</span><span class="hd">$width</span><span class="hk">)&nbsp;/&nbsp;</span><span class="hd">2</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$top&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">0</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span class="hd">$cropLandscape&nbsp;</span><span class="hk">||&nbsp;</span><span class="hd">$equals</span><span class="hk">)&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$coefficient&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$originalWidth&nbsp;</span><span class="hk">/&nbsp;</span><span class="hd">$width</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$scaledHeight&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">round</span><span class="hk">(</span><span class="hd">$originalHeight&nbsp;</span><span class="hk">/&nbsp;</span><span class="hd">$coefficient</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$left&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">0</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$top&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">round</span><span class="hk">((</span><span class="hd">$scaledHeight&nbsp;</span><span class="hk">-&nbsp;</span><span class="hd">$height</span><span class="hk">)&nbsp;/&nbsp;</span><span class="hd">2</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$coefficient&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$originalHeight&nbsp;</span><span class="hk">/&nbsp;</span><span class="hd">$height</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$scaledWidth&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">round</span><span class="hk">(</span><span class="hd">$originalWidth&nbsp;</span><span class="hk">/&nbsp;</span><span class="hd">$coefficient</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$left&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">round</span><span class="hk">((</span><span class="hd">$scaledWidth&nbsp;</span><span class="hk">-&nbsp;</span><span class="hd">$width</span><span class="hk">)&nbsp;/&nbsp;</span><span class="hd">2</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$top&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">0</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$image</span><span class="hk">-&gt;</span><span class="hd">resize</span><span class="hk">(</span><span class="hd">$resizeWidth</span><span class="hk">,&nbsp;</span><span class="hd">$resizeHeight</span><span class="hk">,&nbsp;</span><span class="hd">Image</span><span class="hk">::</span><span class="hd">FILL</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$image</span><span class="hk">-&gt;</span><span class="hd">crop</span><span class="hk">(</span><span class="hd">$left</span><span class="hk">,&nbsp;</span><span class="hd">$top</span><span class="hk">,&nbsp;</span><span class="hd">$width</span><span class="hk">,&nbsp;</span><span class="hd">$height</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$image</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Resizes&nbsp;the&nbsp;given&nbsp;image&nbsp;to&nbsp;the&nbsp;given&nbsp;dimensions&nbsp;using&nbsp;given&nbsp;flags.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;Image&nbsp;&nbsp;&nbsp;$image&nbsp;&nbsp;&nbsp;The&nbsp;image&nbsp;to&nbsp;resize<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;Request&nbsp;$request&nbsp;The&nbsp;image&nbsp;request<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;Image&nbsp;&nbsp;&nbsp;The&nbsp;image&nbsp;thumbnail<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;function&nbsp;</span><span class="hd">resize</span><span class="hk">(</span><span class="hd">Image&nbsp;$image</span><span class="hk">,&nbsp;</span><span class="hd">Request&nbsp;$request</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span class="hd">$request</span><span class="hk">-&gt;</span><span class="hd">getDimensions</span><span class="hk">()&nbsp;===&nbsp;</span><span class="hd">Request</span><span class="hk">::</span><span class="hd">ORIGINAL</span><span class="hk">)&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$image</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list(</span><span class="hd">$width</span><span class="hk">,&nbsp;</span><span class="hd">$height</span><span class="hk">)&nbsp;=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">processDimensions</span><span class="hk">(</span><span class="hd">$request</span><span class="hk">-&gt;</span><span class="hd">getDimensions</span><span class="hk">());<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$image</span><span class="hk">-&gt;</span><span class="hd">resize</span><span class="hk">(</span><span class="hd">$width</span><span class="hk">,&nbsp;</span><span class="hd">$height</span><span class="hk">,&nbsp;</span><span class="hd">$request</span><span class="hk">-&gt;</span><span class="hd">getFlags</span><span class="hk">());<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;part&nbsp;of&nbsp;the&nbsp;image&nbsp;filename&nbsp;relative&nbsp;to&nbsp;the&nbsp;cache&nbsp;directory.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;Request&nbsp;$request&nbsp;The&nbsp;image&nbsp;request<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;function&nbsp;</span><span class="hd">createFilePath</span><span class="hk">(</span><span class="hd">Request&nbsp;$request</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$dimensions&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$request</span><span class="hk">-&gt;</span><span class="hd">getDimensions</span><span class="hk">();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$flags&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$request</span><span class="hk">-&gt;</span><span class="hd">getFlags</span><span class="hk">();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$crop&nbsp;</span><span class="hk">=&nbsp;(int)&nbsp;</span><span class="hd">$request</span><span class="hk">-&gt;</span><span class="hd">getCrop</span><span class="hk">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$meta&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$request</span><span class="hk">-&gt;</span><span class="hd">getMeta</span><span class="hk">();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$ext&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">getExtension</span><span class="hk">(</span><span class="hd">$meta</span><span class="hk">-&gt;</span><span class="hd">getType</span><span class="hk">());<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$baseFilePath&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">createCacheDirectoryPath</span><span class="hk">(</span><span class="hd">$meta</span><span class="hk">-&gt;</span><span class="hd">getHash</span><span class="hk">());<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hs">"</span><span class="hd">$baseFilePath</span><span class="hs">.</span><span class="hd">$dimensions</span><span class="hs">.</span><span class="hd">$flags</span><span class="hs">.</span><span class="hd">$crop</span><span class="hs">.</span><span class="hd">$ext</span><span class="hs">"</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Parses&nbsp;the&nbsp;given&nbsp;dimensions&nbsp;string&nbsp;for&nbsp;the&nbsp;image&nbsp;width&nbsp;and&nbsp;height.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;string&nbsp;$dimensions&nbsp;The&nbsp;dimensions&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;array&nbsp;&nbsp;The&nbsp;width&nbsp;and&nbsp;height&nbsp;of&nbsp;the&nbsp;image&nbsp;in&nbsp;pixels<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;function&nbsp;</span><span class="hd">processDimensions</span><span class="hk">(</span><span class="hd">$dimensions</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span class="hd">strpos</span><span class="hk">(</span><span class="hd">$dimensions</span><span class="hk">,&nbsp;</span><span class="hs">'x'</span><span class="hk">)&nbsp;!==&nbsp;</span><span class="hd">FALSE</span><span class="hk">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list(</span><span class="hd">$width</span><span class="hk">,&nbsp;</span><span class="hd">$height</span><span class="hk">)&nbsp;=&nbsp;</span><span class="hd">explode</span><span class="hk">(</span><span class="hs">'x'</span><span class="hk">,&nbsp;</span><span class="hd">$dimensions</span><span class="hk">);&nbsp;</span><span class="hc">//&nbsp;different&nbsp;dimensions,&nbsp;eg.&nbsp;"210x150"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$width&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">intval</span><span class="hk">(</span><span class="hd">$width</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$height&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">intval</span><span class="hk">(</span><span class="hd">$height</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$width&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">intval</span><span class="hk">(</span><span class="hd">$dimensions</span><span class="hk">);&nbsp;</span><span class="hc">//&nbsp;same&nbsp;dimensions,&nbsp;eg.&nbsp;"210"&nbsp;=&gt;&nbsp;210x210<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$height&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$width</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array(</span><span class="hd">$width</span><span class="hk">,&nbsp;</span><span class="hd">$height</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;the&nbsp;internal&nbsp;directory&nbsp;path&nbsp;from&nbsp;the&nbsp;given&nbsp;hash.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Some&nbsp;special&nbsp;images&nbsp;like&nbsp;the&nbsp;"Image&nbsp;Not&nbsp;Available"&nbsp;image&nbsp;are&nbsp;stored<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;in&nbsp;directories&nbsp;prefixed&nbsp;with&nbsp;an&nbsp;underscore.&nbsp;Those&nbsp;directories&nbsp;are&nbsp;not<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;fragmented&nbsp;to&nbsp;hash&nbsp;based&nbsp;structure.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;string&nbsp;$hash&nbsp;Tha&nbsp;SHA1&nbsp;hash<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;function&nbsp;</span><span class="hd">createCacheDirectoryPath</span><span class="hk">(</span><span class="hd">$hash</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span class="hd">$hash</span><span class="hk">{</span><span class="hd">0</span><span class="hk">}&nbsp;===&nbsp;</span><span class="hs">'_'</span><span class="hk">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hs">"</span><span class="hd">$hash</span><span class="hs">/</span><span class="hd">$hash</span><span class="hs">"</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hs">"</span><span class="hd">$hash</span><span class="hk">[</span><span class="hd">0</span><span class="hk">]</span><span class="hd">$hash</span><span class="hk">[</span><span class="hd">1</span><span class="hk">]</span><span class="hs">/</span><span class="hd">$hash</span><span class="hk">[</span><span class="hd">2</span><span class="hk">]</span><span class="hd">$hash</span><span class="hk">[</span><span class="hd">3</span><span class="hk">]</span><span class="hs">"&nbsp;</span><span class="hk">.&nbsp;</span><span class="hs">'/'&nbsp;</span><span class="hk">.&nbsp;</span><span class="hd">$hash</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;image&nbsp;MIME&nbsp;type&nbsp;according&nbsp;to&nbsp;the&nbsp;given&nbsp;image&nbsp;type.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;integer&nbsp;$imageType&nbsp;Image&nbsp;type<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">protected&nbsp;function&nbsp;</span><span class="hd">getMimeType</span><span class="hk">(</span><span class="hd">$imageType</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">mimeTypes</span><span class="hk">[</span><span class="hd">$imageType</span><span class="hk">];<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;original&nbsp;stored&nbsp;image&nbsp;filename.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;Meta&nbsp;$meta&nbsp;Image&nbsp;meta&nbsp;information<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">file</span><span class="hk">(</span><span class="hd">Meta&nbsp;$meta</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">createFilename</span><span class="hk">(</span><span class="hd">$meta</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;public&nbsp;accessible&nbsp;cache&nbsp;directory&nbsp;URL.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">getBaseUrl</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">baseUrl</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Sets&nbsp;the&nbsp;public&nbsp;accessible&nbsp;cache&nbsp;directory&nbsp;URL.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;$baseUrl<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;$this<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">protected&nbsp;function&nbsp;</span><span class="hd">setBaseUrl</span><span class="hk">(</span><span class="hd">$baseUrl</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span class="hd">Strings</span><span class="hk">::</span><span class="hd">endsWith</span><span class="hk">(</span><span class="hd">$baseUrl</span><span class="hk">,&nbsp;</span><span class="hs">'/'</span><span class="hk">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$baseUrl&nbsp;</span><span class="hk">.=&nbsp;</span><span class="hs">'/'</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">baseUrl&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$baseUrl</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />}<br /></span>
</span>
</code>		</div>
		</div>
	</div>
		<div>
		<table>
		<tr>
			<td class="number"><small>100 %</small></td>
			<td><div class="bar"><div style="width: 100%"></div></div></td>
			<td><a href="#F4" class="toggle">ImageStore/Exceptions/ImageTypeException.php</a></td>
		</tr>
		</table>

		<div class="code" id="F4">
		<div>
			<aside>
			<div><a href='#F4L1' id='F4L1'>  1</a>
<a href='#F4L2' id='F4L2'>  2</a>
<a href='#F4L3' id='F4L3'>  3</a>
<a href='#F4L4' id='F4L4'>  4</a>
<a href='#F4L5' id='F4L5'>  5</a>
<a href='#F4L6' id='F4L6'>  6</a>
<a href='#F4L7' id='F4L7'>  7</a>
<a href='#F4L8' id='F4L8'>  8</a>
<a href='#F4L9' id='F4L9'>  9</a>
<a href='#F4L10' id='F4L10'> 10</a>
<a href='#F4L11' id='F4L11'> 11</a></div><div class='t'><a href='#F4L12' id='F4L12'> 12</a></div><div><a href='#F4L13' id='F4L13'> 13</a>
<a href='#F4L14' id='F4L14'> 14</a>
<a href='#F4L15' id='F4L15'> 15</a>
<a href='#F4L16' id='F4L16'> 16</a>
<a href='#F4L17' id='F4L17'> 17</a>
<a href='#F4L18' id='F4L18'> 18</a></div><div class='t'><a href='#F4L19' id='F4L19'> 19</a>
<a href='#F4L20' id='F4L20'> 20</a>
<a href='#F4L21' id='F4L21'> 21</a></div><div><a href='#F4L22' id='F4L22'> 22</a>
<a href='#F4L23' id='F4L23'> 23</a>
</div>			</aside>
			<code style='margin-left: 3em'><span class="hh">
<span class="hd">&lt;?php<br /><br /></span><span class="hk">namespace&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Exceptions</span><span class="hk">;<br /><br /><br />use&nbsp;</span><span class="hd">InvalidArgumentException</span><span class="hk">;<br /><br /></span><span class="hc">/**<br />&nbsp;*&nbsp;Invalid&nbsp;image&nbsp;type&nbsp;exception<br />&nbsp;*/<br /></span><span class="hk">class&nbsp;</span><span class="hd">ImageTypeException&nbsp;</span><span class="hk">extends&nbsp;</span><span class="hd">InvalidArgumentException<br /></span><span class="hk">{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;integer&nbsp;$type<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">__construct</span><span class="hk">(</span><span class="hd">$type</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$message&nbsp;</span><span class="hk">=&nbsp;</span><span class="hs">'The&nbsp;image&nbsp;type&nbsp;%s&nbsp;is&nbsp;not&nbsp;supported,&nbsp;it&nbsp;must&nbsp;be&nbsp;one&nbsp;of&nbsp;Image::JPEG,&nbsp;Image::PNG&nbsp;or&nbsp;Image::GIF.'</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">parent</span><span class="hk">::</span><span class="hd">__construct</span><span class="hk">(</span><span class="hd">sprintf</span><span class="hk">(</span><span class="hd">$message</span><span class="hk">,&nbsp;</span><span class="hd">var_export</span><span class="hk">(</span><span class="hd">$type</span><span class="hk">,&nbsp;</span><span class="hd">TRUE</span><span class="hk">)));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />}<br /></span>
</span>
</code>		</div>
		</div>
	</div>
		<div>
		<table>
		<tr>
			<td class="number"><small>100 %</small></td>
			<td><div class="bar"><div style="width: 100%"></div></div></td>
			<td><a href="#F5" class="toggle">ImageStore/Exceptions/HashException.php</a></td>
		</tr>
		</table>

		<div class="code" id="F5">
		<div>
			<aside>
			<div><a href='#F5L1' id='F5L1'>  1</a>
<a href='#F5L2' id='F5L2'>  2</a>
<a href='#F5L3' id='F5L3'>  3</a>
<a href='#F5L4' id='F5L4'>  4</a>
<a href='#F5L5' id='F5L5'>  5</a>
<a href='#F5L6' id='F5L6'>  6</a>
<a href='#F5L7' id='F5L7'>  7</a>
<a href='#F5L8' id='F5L8'>  8</a>
<a href='#F5L9' id='F5L9'>  9</a>
<a href='#F5L10' id='F5L10'> 10</a>
<a href='#F5L11' id='F5L11'> 11</a></div><div class='t'><a href='#F5L12' id='F5L12'> 12</a></div><div><a href='#F5L13' id='F5L13'> 13</a>
<a href='#F5L14' id='F5L14'> 14</a>
<a href='#F5L15' id='F5L15'> 15</a>
<a href='#F5L16' id='F5L16'> 16</a>
<a href='#F5L17' id='F5L17'> 17</a>
<a href='#F5L18' id='F5L18'> 18</a></div><div class='t'><a href='#F5L19' id='F5L19'> 19</a></div><div><a href='#F5L20' id='F5L20'> 20</a></div><div class='t'><a href='#F5L21' id='F5L21'> 21</a>
<a href='#F5L22' id='F5L22'> 22</a></div><div><a href='#F5L23' id='F5L23'> 23</a>
<a href='#F5L24' id='F5L24'> 24</a>
</div>			</aside>
			<code style='margin-left: 3em'><span class="hh">
<span class="hd">&lt;?php<br /><br /></span><span class="hk">namespace&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Exceptions</span><span class="hk">;<br /><br /><br />use&nbsp;</span><span class="hd">Exception</span><span class="hk">;<br /><br /></span><span class="hc">/**<br />&nbsp;*&nbsp;Invalid&nbsp;hash&nbsp;exception<br />&nbsp;*/<br /></span><span class="hk">class&nbsp;</span><span class="hd">HashException&nbsp;</span><span class="hk">extends&nbsp;</span><span class="hd">Exception<br /></span><span class="hk">{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;$hash<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">__construct</span><span class="hk">(</span><span class="hd">$hash</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$message&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">sprintf</span><span class="hk">(</span><span class="hs">'The&nbsp;image&nbsp;hash&nbsp;is&nbsp;invalid.&nbsp;It&nbsp;is&nbsp;required&nbsp;to&nbsp;be&nbsp;a&nbsp;SHA1&nbsp;hash&nbsp;but&nbsp;%s&nbsp;given.'</span><span class="hk">,&nbsp;</span><span class="hd">var_export</span><span class="hk">(</span><span class="hd">$hash</span><span class="hk">,&nbsp;</span><span class="hd">TRUE</span><span class="hk">));<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">parent</span><span class="hk">::</span><span class="hd">__construct</span><span class="hk">(</span><span class="hd">$message</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />}<br /></span>
</span>
</code>		</div>
		</div>
	</div>
		<div>
		<table>
		<tr class='light'>
			<td class="number"><small>100 %</small></td>
			<td><div class="bar"><div style="width: 100%"></div></div></td>
			<td><a href="#F6" class="toggle">ImageStore/Exceptions/InvalidCacheDirectoryException.php</a></td>
		</tr>
		</table>

		<div class="code" id="F6">
		<div>
			<aside>
			<div><a href='#F6L1' id='F6L1'>  1</a>
<a href='#F6L2' id='F6L2'>  2</a>
<a href='#F6L3' id='F6L3'>  3</a>
<a href='#F6L4' id='F6L4'>  4</a>
<a href='#F6L5' id='F6L5'>  5</a>
<a href='#F6L6' id='F6L6'>  6</a>
<a href='#F6L7' id='F6L7'>  7</a>
<a href='#F6L8' id='F6L8'>  8</a>
<a href='#F6L9' id='F6L9'>  9</a>
<a href='#F6L10' id='F6L10'> 10</a>
<a href='#F6L11' id='F6L11'> 11</a>
<a href='#F6L12' id='F6L12'> 12</a>
<a href='#F6L13' id='F6L13'> 13</a></div><div class='t'><a href='#F6L14' id='F6L14'> 14</a></div><div><a href='#F6L15' id='F6L15'> 15</a>
<a href='#F6L16' id='F6L16'> 16</a>
<a href='#F6L17' id='F6L17'> 17</a>
<a href='#F6L18' id='F6L18'> 18</a>
<a href='#F6L19' id='F6L19'> 19</a>
<a href='#F6L20' id='F6L20'> 20</a>
<a href='#F6L21' id='F6L21'> 21</a></div><div class='t'><a href='#F6L22' id='F6L22'> 22</a>
<a href='#F6L23' id='F6L23'> 23</a></div><div><a href='#F6L24' id='F6L24'> 24</a>
<a href='#F6L25' id='F6L25'> 25</a>
</div>			</aside>
			<code style='margin-left: 3em'><span class="hh">
<span class="hd">&lt;?php<br /><br /></span><span class="hk">namespace&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Exceptions</span><span class="hk">;<br /><br /><br />use&nbsp;</span><span class="hd">InvalidArgumentException</span><span class="hk">;<br /><br /></span><span class="hc">/**<br />&nbsp;*&nbsp;Invalid&nbsp;cache&nbsp;directory&nbsp;exception<br />&nbsp;*<br />&nbsp;*&nbsp;It's&nbsp;thrown&nbsp;when&nbsp;user&nbsp;attempts&nbsp;to&nbsp;use&nbsp;the&nbsp;same&nbsp;directory&nbsp;for&nbsp;the&nbsp;storage&nbsp;AND&nbsp;the&nbsp;cache.<br />&nbsp;*/<br /></span><span class="hk">class&nbsp;</span><span class="hd">InvalidCacheDirectoryException&nbsp;</span><span class="hk">extends&nbsp;</span><span class="hd">InvalidArgumentException<br /></span><span class="hk">{<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;$directory<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">__construct</span><span class="hk">(</span><span class="hd">$directory</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">parent</span><span class="hk">::</span><span class="hd">__construct</span><span class="hk">(</span><span class="hd">sprintf</span><span class="hk">(</span><span class="hs">'You&nbsp;cannot&nbsp;use&nbsp;the&nbsp;same&nbsp;directory&nbsp;for&nbsp;the&nbsp;image&nbsp;cache&nbsp;as&nbsp;for&nbsp;the&nbsp;storage.&nbsp;Path:&nbsp;(%s)'</span><span class="hk">,&nbsp;</span><span class="hd">var_export</span><span class="hk">(</span><span class="hd">$directory</span><span class="hk">,&nbsp;</span><span class="hd">TRUE</span><span class="hk">)));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />}<br /></span>
</span>
</code>		</div>
		</div>
	</div>
		<div>
		<table>
		<tr class='light'>
			<td class="number"><small>100 %</small></td>
			<td><div class="bar"><div style="width: 100%"></div></div></td>
			<td><a href="#F7" class="toggle">ImageStore/Exceptions/DirectoryException.php</a></td>
		</tr>
		</table>

		<div class="code" id="F7">
		<div>
			<aside>
			<div><a href='#F7L1' id='F7L1'>  1</a>
<a href='#F7L2' id='F7L2'>  2</a>
<a href='#F7L3' id='F7L3'>  3</a>
<a href='#F7L4' id='F7L4'>  4</a>
<a href='#F7L5' id='F7L5'>  5</a>
<a href='#F7L6' id='F7L6'>  6</a>
<a href='#F7L7' id='F7L7'>  7</a>
<a href='#F7L8' id='F7L8'>  8</a>
<a href='#F7L9' id='F7L9'>  9</a>
<a href='#F7L10' id='F7L10'> 10</a>
<a href='#F7L11' id='F7L11'> 11</a></div><div class='t'><a href='#F7L12' id='F7L12'> 12</a></div><div><a href='#F7L13' id='F7L13'> 13</a>
<a href='#F7L14' id='F7L14'> 14</a>
<a href='#F7L15' id='F7L15'> 15</a>
<a href='#F7L16' id='F7L16'> 16</a>
<a href='#F7L17' id='F7L17'> 17</a>
<a href='#F7L18' id='F7L18'> 18</a>
<a href='#F7L19' id='F7L19'> 19</a></div><div class='t'><a href='#F7L20' id='F7L20'> 20</a>
<a href='#F7L21' id='F7L21'> 21</a></div><div><a href='#F7L22' id='F7L22'> 22</a>
<a href='#F7L23' id='F7L23'> 23</a>
</div>			</aside>
			<code style='margin-left: 3em'><span class="hh">
<span class="hd">&lt;?php<br /><br /></span><span class="hk">namespace&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Exceptions</span><span class="hk">;<br /><br /><br />use&nbsp;</span><span class="hd">InvalidArgumentException</span><span class="hk">;<br /><br /></span><span class="hc">/**<br />&nbsp;*&nbsp;Directory&nbsp;exception<br />&nbsp;*/<br /></span><span class="hk">class&nbsp;</span><span class="hd">DirectoryException&nbsp;</span><span class="hk">extends&nbsp;</span><span class="hd">InvalidArgumentException<br /></span><span class="hk">{<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;$directory<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">__construct</span><span class="hk">(</span><span class="hd">$directory</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">parent</span><span class="hk">::</span><span class="hd">__construct</span><span class="hk">(</span><span class="hd">sprintf</span><span class="hk">(</span><span class="hs">'Directory&nbsp;"%s"&nbsp;does&nbsp;not&nbsp;exist&nbsp;and&nbsp;cannot&nbsp;be&nbsp;created&nbsp;or&nbsp;it&nbsp;is&nbsp;not&nbsp;writable.'</span><span class="hk">,&nbsp;</span><span class="hd">var_export</span><span class="hk">(</span><span class="hd">$directory</span><span class="hk">,&nbsp;</span><span class="hd">TRUE</span><span class="hk">)));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />}<br /></span>
</span>
</code>		</div>
		</div>
	</div>
		<div>
		<table>
		<tr class='light'>
			<td class="number"><small>100 %</small></td>
			<td><div class="bar"><div style="width: 100%"></div></div></td>
			<td><a href="#F8" class="toggle">ImageStore/Exceptions/ImageFileException.php</a></td>
		</tr>
		</table>

		<div class="code" id="F8">
		<div>
			<aside>
			<div><a href='#F8L1' id='F8L1'>  1</a>
<a href='#F8L2' id='F8L2'>  2</a>
<a href='#F8L3' id='F8L3'>  3</a>
<a href='#F8L4' id='F8L4'>  4</a>
<a href='#F8L5' id='F8L5'>  5</a>
<a href='#F8L6' id='F8L6'>  6</a>
<a href='#F8L7' id='F8L7'>  7</a>
<a href='#F8L8' id='F8L8'>  8</a>
<a href='#F8L9' id='F8L9'>  9</a>
<a href='#F8L10' id='F8L10'> 10</a>
<a href='#F8L11' id='F8L11'> 11</a></div><div class='t'><a href='#F8L12' id='F8L12'> 12</a></div><div><a href='#F8L13' id='F8L13'> 13</a>
<a href='#F8L14' id='F8L14'> 14</a>
<a href='#F8L15' id='F8L15'> 15</a>
<a href='#F8L16' id='F8L16'> 16</a>
<a href='#F8L17' id='F8L17'> 17</a>
<a href='#F8L18' id='F8L18'> 18</a></div><div class='t'><a href='#F8L19' id='F8L19'> 19</a>
<a href='#F8L20' id='F8L20'> 20</a></div><div><a href='#F8L21' id='F8L21'> 21</a>
<a href='#F8L22' id='F8L22'> 22</a>
</div>			</aside>
			<code style='margin-left: 3em'><span class="hh">
<span class="hd">&lt;?php<br /><br /></span><span class="hk">namespace&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Exceptions</span><span class="hk">;<br /><br /><br />use&nbsp;</span><span class="hd">InvalidArgumentException</span><span class="hk">;<br /><br /></span><span class="hc">/**<br />&nbsp;*&nbsp;Invalid&nbsp;image&nbsp;type&nbsp;exception<br />&nbsp;*/<br /></span><span class="hk">class&nbsp;</span><span class="hd">ImageFileException&nbsp;</span><span class="hk">extends&nbsp;</span><span class="hd">InvalidArgumentException<br /></span><span class="hk">{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;$filename<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">__construct</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">parent</span><span class="hk">::</span><span class="hd">__construct</span><span class="hk">(</span><span class="hd">sprintf</span><span class="hk">(</span><span class="hs">'File&nbsp;%s&nbsp;does&nbsp;not&nbsp;exist&nbsp;or&nbsp;it&nbsp;is&nbsp;not&nbsp;an&nbsp;image.'</span><span class="hk">,&nbsp;</span><span class="hd">var_export</span><span class="hk">(</span><span class="hd">$filename</span><span class="hk">,&nbsp;</span><span class="hd">TRUE</span><span class="hk">)));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />}<br /></span>
</span>
</code>		</div>
		</div>
	</div>
		<div>
		<table>
		<tr>
			<td class="number"><small>100 %</small></td>
			<td><div class="bar"><div style="width: 100%"></div></div></td>
			<td><a href="#F9" class="toggle">ImageStore/Macro/ImageMacro.php</a></td>
		</tr>
		</table>

		<div class="code" id="F9">
		<div>
			<aside>
			<div><a href='#F9L1' id='F9L1'>   1</a>
<a href='#F9L2' id='F9L2'>   2</a>
<a href='#F9L3' id='F9L3'>   3</a>
<a href='#F9L4' id='F9L4'>   4</a>
<a href='#F9L5' id='F9L5'>   5</a>
<a href='#F9L6' id='F9L6'>   6</a>
<a href='#F9L7' id='F9L7'>   7</a>
<a href='#F9L8' id='F9L8'>   8</a>
<a href='#F9L9' id='F9L9'>   9</a>
<a href='#F9L10' id='F9L10'>  10</a>
<a href='#F9L11' id='F9L11'>  11</a>
<a href='#F9L12' id='F9L12'>  12</a>
<a href='#F9L13' id='F9L13'>  13</a>
<a href='#F9L14' id='F9L14'>  14</a></div><div class='t'><a href='#F9L15' id='F9L15'>  15</a></div><div><a href='#F9L16' id='F9L16'>  16</a>
<a href='#F9L17' id='F9L17'>  17</a>
<a href='#F9L18' id='F9L18'>  18</a>
<a href='#F9L19' id='F9L19'>  19</a>
<a href='#F9L20' id='F9L20'>  20</a>
<a href='#F9L21' id='F9L21'>  21</a>
<a href='#F9L22' id='F9L22'>  22</a>
<a href='#F9L23' id='F9L23'>  23</a>
<a href='#F9L24' id='F9L24'>  24</a>
<a href='#F9L25' id='F9L25'>  25</a></div><div class='t'><a href='#F9L26' id='F9L26'>  26</a>
<a href='#F9L27' id='F9L27'>  27</a>
<a href='#F9L28' id='F9L28'>  28</a></div><div><a href='#F9L29' id='F9L29'>  29</a>
<a href='#F9L30' id='F9L30'>  30</a>
<a href='#F9L31' id='F9L31'>  31</a>
<a href='#F9L32' id='F9L32'>  32</a>
<a href='#F9L33' id='F9L33'>  33</a>
<a href='#F9L34' id='F9L34'>  34</a>
<a href='#F9L35' id='F9L35'>  35</a></div><div class='t'><a href='#F9L36' id='F9L36'>  36</a>
<a href='#F9L37' id='F9L37'>  37</a>
<a href='#F9L38' id='F9L38'>  38</a>
<a href='#F9L39' id='F9L39'>  39</a>
<a href='#F9L40' id='F9L40'>  40</a></div><div><a href='#F9L41' id='F9L41'>  41</a>
<a href='#F9L42' id='F9L42'>  42</a>
<a href='#F9L43' id='F9L43'>  43</a>
<a href='#F9L44' id='F9L44'>  44</a>
<a href='#F9L45' id='F9L45'>  45</a>
<a href='#F9L46' id='F9L46'>  46</a>
<a href='#F9L47' id='F9L47'>  47</a>
<a href='#F9L48' id='F9L48'>  48</a>
<a href='#F9L49' id='F9L49'>  49</a>
<a href='#F9L50' id='F9L50'>  50</a>
<a href='#F9L51' id='F9L51'>  51</a></div><div class='t'><a href='#F9L52' id='F9L52'>  52</a></div><div class='dead'><a href='#F9L53' id='F9L53'>  53</a></div><div><a href='#F9L54' id='F9L54'>  54</a>
<a href='#F9L55' id='F9L55'>  55</a>
<a href='#F9L56' id='F9L56'>  56</a>
<a href='#F9L57' id='F9L57'>  57</a>
<a href='#F9L58' id='F9L58'>  58</a>
<a href='#F9L59' id='F9L59'>  59</a>
<a href='#F9L60' id='F9L60'>  60</a>
<a href='#F9L61' id='F9L61'>  61</a>
<a href='#F9L62' id='F9L62'>  62</a>
<a href='#F9L63' id='F9L63'>  63</a>
<a href='#F9L64' id='F9L64'>  64</a></div><div class='t'><a href='#F9L65' id='F9L65'>  65</a></div><div class='dead'><a href='#F9L66' id='F9L66'>  66</a></div><div><a href='#F9L67' id='F9L67'>  67</a>
<a href='#F9L68' id='F9L68'>  68</a>
<a href='#F9L69' id='F9L69'>  69</a>
<a href='#F9L70' id='F9L70'>  70</a>
<a href='#F9L71' id='F9L71'>  71</a>
<a href='#F9L72' id='F9L72'>  72</a>
<a href='#F9L73' id='F9L73'>  73</a>
<a href='#F9L74' id='F9L74'>  74</a>
<a href='#F9L75' id='F9L75'>  75</a>
<a href='#F9L76' id='F9L76'>  76</a>
<a href='#F9L77' id='F9L77'>  77</a></div><div class='t'><a href='#F9L78' id='F9L78'>  78</a></div><div class='dead'><a href='#F9L79' id='F9L79'>  79</a></div><div><a href='#F9L80' id='F9L80'>  80</a>
<a href='#F9L81' id='F9L81'>  81</a>
<a href='#F9L82' id='F9L82'>  82</a>
<a href='#F9L83' id='F9L83'>  83</a>
<a href='#F9L84' id='F9L84'>  84</a>
<a href='#F9L85' id='F9L85'>  85</a>
<a href='#F9L86' id='F9L86'>  86</a>
<a href='#F9L87' id='F9L87'>  87</a>
<a href='#F9L88' id='F9L88'>  88</a>
<a href='#F9L89' id='F9L89'>  89</a>
<a href='#F9L90' id='F9L90'>  90</a></div><div class='t'><a href='#F9L91' id='F9L91'>  91</a></div><div class='dead'><a href='#F9L92' id='F9L92'>  92</a></div><div><a href='#F9L93' id='F9L93'>  93</a>
<a href='#F9L94' id='F9L94'>  94</a>
<a href='#F9L95' id='F9L95'>  95</a>
<a href='#F9L96' id='F9L96'>  96</a>
<a href='#F9L97' id='F9L97'>  97</a>
<a href='#F9L98' id='F9L98'>  98</a>
<a href='#F9L99' id='F9L99'>  99</a>
<a href='#F9L100' id='F9L100'> 100</a>
<a href='#F9L101' id='F9L101'> 101</a>
<a href='#F9L102' id='F9L102'> 102</a>
<a href='#F9L103' id='F9L103'> 103</a></div><div class='t'><a href='#F9L104' id='F9L104'> 104</a></div><div class='dead'><a href='#F9L105' id='F9L105'> 105</a></div><div><a href='#F9L106' id='F9L106'> 106</a>
<a href='#F9L107' id='F9L107'> 107</a>
<a href='#F9L108' id='F9L108'> 108</a>
<a href='#F9L109' id='F9L109'> 109</a>
<a href='#F9L110' id='F9L110'> 110</a>
<a href='#F9L111' id='F9L111'> 111</a>
<a href='#F9L112' id='F9L112'> 112</a>
<a href='#F9L113' id='F9L113'> 113</a>
<a href='#F9L114' id='F9L114'> 114</a>
<a href='#F9L115' id='F9L115'> 115</a>
<a href='#F9L116' id='F9L116'> 116</a></div><div class='t'><a href='#F9L117' id='F9L117'> 117</a></div><div class='dead'><a href='#F9L118' id='F9L118'> 118</a></div><div><a href='#F9L119' id='F9L119'> 119</a>
<a href='#F9L120' id='F9L120'> 120</a>
</div>			</aside>
			<code style='margin-left: 4em'><span class="hh">
<span class="hd">&lt;?php<br /><br /></span><span class="hk">namespace&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Macro</span><span class="hk">;<br /><br /><br />use&nbsp;</span><span class="hd">Latte</span><span class="hk">\</span><span class="hd">Compiler</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Latte</span><span class="hk">\</span><span class="hd">MacroNode</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Latte</span><span class="hk">\</span><span class="hd">Macros</span><span class="hk">\</span><span class="hd">MacroSet</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Latte</span><span class="hk">\</span><span class="hd">PhpWriter</span><span class="hk">;<br /><br /></span><span class="hc">/**<br />&nbsp;*&nbsp;Latte&nbsp;template&nbsp;engine&nbsp;image&nbsp;macros<br />&nbsp;*/<br /></span><span class="hk">class&nbsp;</span><span class="hd">ImageMacro&nbsp;</span><span class="hk">extends&nbsp;</span><span class="hd">MacroSet<br /></span><span class="hk">{<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Installs&nbsp;the&nbsp;macro&nbsp;set&nbsp;into&nbsp;the&nbsp;template&nbsp;compiler.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;Compiler&nbsp;$compiler<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;void|static<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;static&nbsp;function&nbsp;</span><span class="hd">install</span><span class="hk">(</span><span class="hd">Compiler&nbsp;$compiler</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$macroSet&nbsp;</span><span class="hk">=&nbsp;new&nbsp;static(</span><span class="hd">$compiler</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$macroSet</span><span class="hk">-&gt;</span><span class="hd">setup</span><span class="hk">();<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Sets&nbsp;the&nbsp;template&nbsp;macros&nbsp;up.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">setup</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">addMacro</span><span class="hk">(</span><span class="hs">'src'</span><span class="hk">,&nbsp;</span><span class="hd">NULL</span><span class="hk">,&nbsp;</span><span class="hd">NULL</span><span class="hk">,&nbsp;[</span><span class="hd">$this</span><span class="hk">,&nbsp;</span><span class="hs">'macroSrc'</span><span class="hk">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">addMacro</span><span class="hk">(</span><span class="hs">'bg'</span><span class="hk">,&nbsp;</span><span class="hd">NULL</span><span class="hk">,&nbsp;</span><span class="hd">NULL</span><span class="hk">,&nbsp;[</span><span class="hd">$this</span><span class="hk">,&nbsp;</span><span class="hs">'macroBg'</span><span class="hk">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">addMacro</span><span class="hk">(</span><span class="hs">'image'</span><span class="hk">,&nbsp;[</span><span class="hd">$this</span><span class="hk">,&nbsp;</span><span class="hs">'macroImageBegin'</span><span class="hk">],&nbsp;</span><span class="hd">NULL</span><span class="hk">,&nbsp;[</span><span class="hd">$this</span><span class="hk">,&nbsp;</span><span class="hs">'macroImage'</span><span class="hk">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">addMacro</span><span class="hk">(</span><span class="hs">'crop'</span><span class="hk">,&nbsp;[</span><span class="hd">$this</span><span class="hk">,&nbsp;</span><span class="hs">'macroCropBegin'</span><span class="hk">],&nbsp;</span><span class="hd">NULL</span><span class="hk">,&nbsp;[</span><span class="hd">$this</span><span class="hk">,&nbsp;</span><span class="hs">'macroCrop'</span><span class="hk">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Renders&nbsp;the&nbsp;`n:src="$image"`&nbsp;macro.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;MacroNode&nbsp;$node<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;PhpWriter&nbsp;$writer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">macroBg</span><span class="hk">(</span><span class="hd">MacroNode&nbsp;$node</span><span class="hk">,&nbsp;</span><span class="hd">PhpWriter&nbsp;$writer</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$writer</span><span class="hk">-&gt;</span><span class="hd">write</span><span class="hk">(</span><span class="hs">'&nbsp;?&gt;&nbsp;style="background-image:&nbsp;url(\'&lt;?php&nbsp;$imageRequest&nbsp;=&nbsp;Rostenkowski\ImageStore\Requests\ImageRequest::crop(%node.word,&nbsp;%node.array?);&nbsp;echo&nbsp;%escape($__imagestore-&gt;link($imageRequest));&nbsp;?&gt;\');"&lt;?php&nbsp;'</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Renders&nbsp;the&nbsp;`n:crop="$image"`&nbsp;macro.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;MacroNode&nbsp;$node<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;PhpWriter&nbsp;$writer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">macroCrop</span><span class="hk">(</span><span class="hd">MacroNode&nbsp;$node</span><span class="hk">,&nbsp;</span><span class="hd">PhpWriter&nbsp;$writer</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$writer</span><span class="hk">-&gt;</span><span class="hd">write</span><span class="hk">(</span><span class="hs">'&nbsp;?&gt;&nbsp;src="&lt;?php&nbsp;$imageRequest&nbsp;=&nbsp;Rostenkowski\ImageStore\Requests\ImageRequest::crop(%node.word,&nbsp;%node.array?);&nbsp;echo&nbsp;%escape($__imagestore-&gt;link($imageRequest));&nbsp;?&gt;"&lt;?php&nbsp;'</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Renders&nbsp;the&nbsp;`{crop&nbsp;$image&nbsp;...}`&nbsp;macro.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;MacroNode&nbsp;$node<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;PhpWriter&nbsp;$writer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">macroCropBegin</span><span class="hk">(</span><span class="hd">MacroNode&nbsp;$node</span><span class="hk">,&nbsp;</span><span class="hd">PhpWriter&nbsp;$writer</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$writer</span><span class="hk">-&gt;</span><span class="hd">write</span><span class="hk">(</span><span class="hs">'$imageRequest&nbsp;=&nbsp;Rostenkowski\ImageStore\Requests\ImageRequest::crop(%node.word,&nbsp;%node.array?);&nbsp;echo&nbsp;%escape($__imagestore-&gt;link($imageRequest));'</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Renders&nbsp;the&nbsp;`n:image="$image"`&nbsp;macro.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;MacroNode&nbsp;$node<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;PhpWriter&nbsp;$writer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">macroImage</span><span class="hk">(</span><span class="hd">MacroNode&nbsp;$node</span><span class="hk">,&nbsp;</span><span class="hd">PhpWriter&nbsp;$writer</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$writer</span><span class="hk">-&gt;</span><span class="hd">write</span><span class="hk">(</span><span class="hs">'&nbsp;?&gt;&nbsp;href="&lt;?php&nbsp;$imageRequest&nbsp;=&nbsp;Rostenkowski\ImageStore\Requests\ImageRequest::fromMacro(%node.word,&nbsp;%node.array?);&nbsp;echo&nbsp;%escape($__imagestore-&gt;link($imageRequest));&nbsp;?&gt;"&lt;?php&nbsp;'</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Renders&nbsp;the&nbsp;`{image&nbsp;$image&nbsp;...}`&nbsp;macro.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;MacroNode&nbsp;$node<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;PhpWriter&nbsp;$writer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">macroImageBegin</span><span class="hk">(</span><span class="hd">MacroNode&nbsp;$node</span><span class="hk">,&nbsp;</span><span class="hd">PhpWriter&nbsp;$writer</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$writer</span><span class="hk">-&gt;</span><span class="hd">write</span><span class="hk">(</span><span class="hs">'$imageRequest&nbsp;=&nbsp;Rostenkowski\ImageStore\Requests\ImageRequest::fromMacro(%node.word,&nbsp;%node.array?);&nbsp;echo&nbsp;%escape($__imagestore-&gt;link($imageRequest));'</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Renders&nbsp;the&nbsp;`n:src="$image"`&nbsp;macro.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;MacroNode&nbsp;$node<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;PhpWriter&nbsp;$writer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">macroSrc</span><span class="hk">(</span><span class="hd">MacroNode&nbsp;$node</span><span class="hk">,&nbsp;</span><span class="hd">PhpWriter&nbsp;$writer</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$writer</span><span class="hk">-&gt;</span><span class="hd">write</span><span class="hk">(</span><span class="hs">'$imageRequest&nbsp;=&nbsp;Rostenkowski\ImageStore\Requests\ImageRequest::fromMacro(%node.word,&nbsp;%node.array?);&nbsp;?&gt;&nbsp;src="&lt;?php&nbsp;echo&nbsp;%escape($__imagestore-&gt;link($imageRequest));&nbsp;?&gt;"&lt;?php&nbsp;'</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />}<br /></span>
</span>
</code>		</div>
		</div>
	</div>
		<div>
		<table>
		<tr class='light'>
			<td class="number"><small>100 %</small></td>
			<td><div class="bar"><div style="width: 100%"></div></div></td>
			<td><a href="#F10" class="toggle">ImageStore/Request.php</a></td>
		</tr>
		</table>

		<div class="code" id="F10">
		<div>
			<aside>
			<div><a href='#F10L1' id='F10L1'>  1</a>
<a href='#F10L2' id='F10L2'>  2</a>
<a href='#F10L3' id='F10L3'>  3</a>
<a href='#F10L4' id='F10L4'>  4</a>
<a href='#F10L5' id='F10L5'>  5</a>
<a href='#F10L6' id='F10L6'>  6</a>
<a href='#F10L7' id='F10L7'>  7</a>
<a href='#F10L8' id='F10L8'>  8</a></div><div class='t'><a href='#F10L9' id='F10L9'>  9</a></div><div><a href='#F10L10' id='F10L10'> 10</a>
<a href='#F10L11' id='F10L11'> 11</a>
<a href='#F10L12' id='F10L12'> 12</a>
<a href='#F10L13' id='F10L13'> 13</a>
<a href='#F10L14' id='F10L14'> 14</a>
<a href='#F10L15' id='F10L15'> 15</a>
<a href='#F10L16' id='F10L16'> 16</a>
<a href='#F10L17' id='F10L17'> 17</a>
<a href='#F10L18' id='F10L18'> 18</a>
<a href='#F10L19' id='F10L19'> 19</a>
<a href='#F10L20' id='F10L20'> 20</a>
<a href='#F10L21' id='F10L21'> 21</a>
<a href='#F10L22' id='F10L22'> 22</a>
<a href='#F10L23' id='F10L23'> 23</a>
<a href='#F10L24' id='F10L24'> 24</a>
<a href='#F10L25' id='F10L25'> 25</a>
<a href='#F10L26' id='F10L26'> 26</a>
<a href='#F10L27' id='F10L27'> 27</a>
<a href='#F10L28' id='F10L28'> 28</a>
<a href='#F10L29' id='F10L29'> 29</a>
<a href='#F10L30' id='F10L30'> 30</a>
<a href='#F10L31' id='F10L31'> 31</a>
<a href='#F10L32' id='F10L32'> 32</a>
<a href='#F10L33' id='F10L33'> 33</a>
<a href='#F10L34' id='F10L34'> 34</a>
<a href='#F10L35' id='F10L35'> 35</a>
<a href='#F10L36' id='F10L36'> 36</a>
<a href='#F10L37' id='F10L37'> 37</a>
<a href='#F10L38' id='F10L38'> 38</a>
<a href='#F10L39' id='F10L39'> 39</a>
<a href='#F10L40' id='F10L40'> 40</a>
<a href='#F10L41' id='F10L41'> 41</a>
<a href='#F10L42' id='F10L42'> 42</a>
<a href='#F10L43' id='F10L43'> 43</a>
<a href='#F10L44' id='F10L44'> 44</a>
<a href='#F10L45' id='F10L45'> 45</a>
<a href='#F10L46' id='F10L46'> 46</a>
<a href='#F10L47' id='F10L47'> 47</a>
<a href='#F10L48' id='F10L48'> 48</a>
<a href='#F10L49' id='F10L49'> 49</a>
<a href='#F10L50' id='F10L50'> 50</a>
<a href='#F10L51' id='F10L51'> 51</a>
<a href='#F10L52' id='F10L52'> 52</a>
<a href='#F10L53' id='F10L53'> 53</a>
<a href='#F10L54' id='F10L54'> 54</a>
<a href='#F10L55' id='F10L55'> 55</a>
<a href='#F10L56' id='F10L56'> 56</a>
</div>			</aside>
			<code style='margin-left: 3em'><span class="hh">
<span class="hd">&lt;?php<br /><br /></span><span class="hk">namespace&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">;<br /><br /><br /></span><span class="hc">/**<br />&nbsp;*&nbsp;Image&nbsp;request&nbsp;interface<br />&nbsp;*/<br /></span><span class="hk">interface&nbsp;</span><span class="hd">Request<br /></span><span class="hk">{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;</span><span class="hd">ORIGINAL&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">0</span><span class="hk">;<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;requested&nbsp;image&nbsp;thumbnail&nbsp;cropping&nbsp;flag.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;integer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">getCrop</span><span class="hk">();<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;requested&nbsp;image&nbsp;thumbnail&nbsp;dimensions.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">getDimensions</span><span class="hk">();<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;requested&nbsp;image&nbsp;thumbnail&nbsp;flags.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;integer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">getFlags</span><span class="hk">();<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;requested&nbsp;image&nbsp;meta&nbsp;information.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;Meta<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">getMeta</span><span class="hk">();<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Sets&nbsp;the&nbsp;requested&nbsp;image&nbsp;meta&nbsp;information.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;Meta&nbsp;$meta<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;Request<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">setMeta</span><span class="hk">(</span><span class="hd">Meta&nbsp;$meta</span><span class="hk">);<br /><br /><br />}<br /></span>
</span>
</code>		</div>
		</div>
	</div>
		<div>
		<table>
		<tr>
			<td class="number"><small>100 %</small></td>
			<td><div class="bar"><div style="width: 100%"></div></div></td>
			<td><a href="#F11" class="toggle">ImageStore/Entity/ImageEntity.php</a></td>
		</tr>
		</table>

		<div class="code" id="F11">
		<div>
			<aside>
			<div><a href='#F11L1' id='F11L1'>   1</a>
<a href='#F11L2' id='F11L2'>   2</a>
<a href='#F11L3' id='F11L3'>   3</a>
<a href='#F11L4' id='F11L4'>   4</a>
<a href='#F11L5' id='F11L5'>   5</a>
<a href='#F11L6' id='F11L6'>   6</a>
<a href='#F11L7' id='F11L7'>   7</a>
<a href='#F11L8' id='F11L8'>   8</a>
<a href='#F11L9' id='F11L9'>   9</a>
<a href='#F11L10' id='F11L10'>  10</a>
<a href='#F11L11' id='F11L11'>  11</a>
<a href='#F11L12' id='F11L12'>  12</a>
<a href='#F11L13' id='F11L13'>  13</a>
<a href='#F11L14' id='F11L14'>  14</a>
<a href='#F11L15' id='F11L15'>  15</a>
<a href='#F11L16' id='F11L16'>  16</a></div><div class='t'><a href='#F11L17' id='F11L17'>  17</a></div><div><a href='#F11L18' id='F11L18'>  18</a>
<a href='#F11L19' id='F11L19'>  19</a>
<a href='#F11L20' id='F11L20'>  20</a>
<a href='#F11L21' id='F11L21'>  21</a>
<a href='#F11L22' id='F11L22'>  22</a>
<a href='#F11L23' id='F11L23'>  23</a>
<a href='#F11L24' id='F11L24'>  24</a>
<a href='#F11L25' id='F11L25'>  25</a>
<a href='#F11L26' id='F11L26'>  26</a>
<a href='#F11L27' id='F11L27'>  27</a>
<a href='#F11L28' id='F11L28'>  28</a>
<a href='#F11L29' id='F11L29'>  29</a>
<a href='#F11L30' id='F11L30'>  30</a>
<a href='#F11L31' id='F11L31'>  31</a>
<a href='#F11L32' id='F11L32'>  32</a>
<a href='#F11L33' id='F11L33'>  33</a>
<a href='#F11L34' id='F11L34'>  34</a>
<a href='#F11L35' id='F11L35'>  35</a>
<a href='#F11L36' id='F11L36'>  36</a>
<a href='#F11L37' id='F11L37'>  37</a>
<a href='#F11L38' id='F11L38'>  38</a>
<a href='#F11L39' id='F11L39'>  39</a>
<a href='#F11L40' id='F11L40'>  40</a>
<a href='#F11L41' id='F11L41'>  41</a>
<a href='#F11L42' id='F11L42'>  42</a>
<a href='#F11L43' id='F11L43'>  43</a>
<a href='#F11L44' id='F11L44'>  44</a>
<a href='#F11L45' id='F11L45'>  45</a>
<a href='#F11L46' id='F11L46'>  46</a>
<a href='#F11L47' id='F11L47'>  47</a>
<a href='#F11L48' id='F11L48'>  48</a>
<a href='#F11L49' id='F11L49'>  49</a>
<a href='#F11L50' id='F11L50'>  50</a>
<a href='#F11L51' id='F11L51'>  51</a>
<a href='#F11L52' id='F11L52'>  52</a>
<a href='#F11L53' id='F11L53'>  53</a>
<a href='#F11L54' id='F11L54'>  54</a>
<a href='#F11L55' id='F11L55'>  55</a></div><div class='t'><a href='#F11L56' id='F11L56'>  56</a></div><div class='dead'><a href='#F11L57' id='F11L57'>  57</a></div><div><a href='#F11L58' id='F11L58'>  58</a>
<a href='#F11L59' id='F11L59'>  59</a>
<a href='#F11L60' id='F11L60'>  60</a>
<a href='#F11L61' id='F11L61'>  61</a>
<a href='#F11L62' id='F11L62'>  62</a>
<a href='#F11L63' id='F11L63'>  63</a>
<a href='#F11L64' id='F11L64'>  64</a>
<a href='#F11L65' id='F11L65'>  65</a></div><div class='t'><a href='#F11L66' id='F11L66'>  66</a></div><div><a href='#F11L67' id='F11L67'>  67</a></div><div class='t'><a href='#F11L68' id='F11L68'>  68</a></div><div class='dead'><a href='#F11L69' id='F11L69'>  69</a></div><div><a href='#F11L70' id='F11L70'>  70</a>
<a href='#F11L71' id='F11L71'>  71</a>
<a href='#F11L72' id='F11L72'>  72</a>
<a href='#F11L73' id='F11L73'>  73</a>
<a href='#F11L74' id='F11L74'>  74</a>
<a href='#F11L75' id='F11L75'>  75</a>
<a href='#F11L76' id='F11L76'>  76</a></div><div class='t'><a href='#F11L77' id='F11L77'>  77</a></div><div class='dead'><a href='#F11L78' id='F11L78'>  78</a></div><div><a href='#F11L79' id='F11L79'>  79</a>
<a href='#F11L80' id='F11L80'>  80</a>
<a href='#F11L81' id='F11L81'>  81</a>
<a href='#F11L82' id='F11L82'>  82</a>
<a href='#F11L83' id='F11L83'>  83</a>
<a href='#F11L84' id='F11L84'>  84</a>
<a href='#F11L85' id='F11L85'>  85</a>
<a href='#F11L86' id='F11L86'>  86</a>
<a href='#F11L87' id='F11L87'>  87</a>
<a href='#F11L88' id='F11L88'>  88</a>
<a href='#F11L89' id='F11L89'>  89</a></div><div class='t'><a href='#F11L90' id='F11L90'>  90</a>
<a href='#F11L91' id='F11L91'>  91</a></div><div class='dead'><a href='#F11L92' id='F11L92'>  92</a></div><div class='t'><a href='#F11L93' id='F11L93'>  93</a>
<a href='#F11L94' id='F11L94'>  94</a>
<a href='#F11L95' id='F11L95'>  95</a></div><div class='dead'><a href='#F11L96' id='F11L96'>  96</a></div><div><a href='#F11L97' id='F11L97'>  97</a></div><div class='t'><a href='#F11L98' id='F11L98'>  98</a></div><div class='dead'><a href='#F11L99' id='F11L99'>  99</a></div><div><a href='#F11L100' id='F11L100'> 100</a>
<a href='#F11L101' id='F11L101'> 101</a>
<a href='#F11L102' id='F11L102'> 102</a>
<a href='#F11L103' id='F11L103'> 103</a>
<a href='#F11L104' id='F11L104'> 104</a>
<a href='#F11L105' id='F11L105'> 105</a>
<a href='#F11L106' id='F11L106'> 106</a>
<a href='#F11L107' id='F11L107'> 107</a></div><div class='t'><a href='#F11L108' id='F11L108'> 108</a></div><div><a href='#F11L109' id='F11L109'> 109</a></div><div class='t'><a href='#F11L110' id='F11L110'> 110</a></div><div class='dead'><a href='#F11L111' id='F11L111'> 111</a></div><div><a href='#F11L112' id='F11L112'> 112</a>
<a href='#F11L113' id='F11L113'> 113</a>
<a href='#F11L114' id='F11L114'> 114</a>
<a href='#F11L115' id='F11L115'> 115</a>
<a href='#F11L116' id='F11L116'> 116</a>
<a href='#F11L117' id='F11L117'> 117</a>
<a href='#F11L118' id='F11L118'> 118</a>
<a href='#F11L119' id='F11L119'> 119</a>
<a href='#F11L120' id='F11L120'> 120</a>
<a href='#F11L121' id='F11L121'> 121</a>
<a href='#F11L122' id='F11L122'> 122</a></div><div class='t'><a href='#F11L123' id='F11L123'> 123</a>
<a href='#F11L124' id='F11L124'> 124</a></div><div class='dead'><a href='#F11L125' id='F11L125'> 125</a></div><div><a href='#F11L126' id='F11L126'> 126</a></div><div class='t'><a href='#F11L127' id='F11L127'> 127</a></div><div class='dead'><a href='#F11L128' id='F11L128'> 128</a></div><div><a href='#F11L129' id='F11L129'> 129</a>
<a href='#F11L130' id='F11L130'> 130</a>
<a href='#F11L131' id='F11L131'> 131</a>
<a href='#F11L132' id='F11L132'> 132</a>
<a href='#F11L133' id='F11L133'> 133</a>
<a href='#F11L134' id='F11L134'> 134</a>
<a href='#F11L135' id='F11L135'> 135</a></div><div class='t'><a href='#F11L136' id='F11L136'> 136</a></div><div class='dead'><a href='#F11L137' id='F11L137'> 137</a></div><div><a href='#F11L138' id='F11L138'> 138</a>
<a href='#F11L139' id='F11L139'> 139</a>
<a href='#F11L140' id='F11L140'> 140</a>
<a href='#F11L141' id='F11L141'> 141</a>
<a href='#F11L142' id='F11L142'> 142</a>
<a href='#F11L143' id='F11L143'> 143</a>
<a href='#F11L144' id='F11L144'> 144</a></div><div class='t'><a href='#F11L145' id='F11L145'> 145</a>
<a href='#F11L146' id='F11L146'> 146</a></div><div><a href='#F11L147' id='F11L147'> 147</a>
<a href='#F11L148' id='F11L148'> 148</a>
<a href='#F11L149' id='F11L149'> 149</a>
<a href='#F11L150' id='F11L150'> 150</a>
<a href='#F11L151' id='F11L151'> 151</a>
<a href='#F11L152' id='F11L152'> 152</a>
<a href='#F11L153' id='F11L153'> 153</a></div><div class='t'><a href='#F11L154' id='F11L154'> 154</a></div><div class='dead'><a href='#F11L155' id='F11L155'> 155</a></div><div><a href='#F11L156' id='F11L156'> 156</a>
<a href='#F11L157' id='F11L157'> 157</a>
<a href='#F11L158' id='F11L158'> 158</a>
<a href='#F11L159' id='F11L159'> 159</a>
<a href='#F11L160' id='F11L160'> 160</a>
<a href='#F11L161' id='F11L161'> 161</a>
<a href='#F11L162' id='F11L162'> 162</a></div><div class='t'><a href='#F11L163' id='F11L163'> 163</a>
<a href='#F11L164' id='F11L164'> 164</a></div><div><a href='#F11L165' id='F11L165'> 165</a>
</div>			</aside>
			<code style='margin-left: 4em'><span class="hh">
<span class="hd">&lt;?php<br /><br /></span><span class="hk">namespace&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Entity</span><span class="hk">;<br /><br /><br />use&nbsp;</span><span class="hd">Nette</span><span class="hk">\</span><span class="hd">Utils</span><span class="hk">\</span><span class="hd">Image</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Nette</span><span class="hk">\</span><span class="hd">Utils</span><span class="hk">\</span><span class="hd">Strings</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Exceptions</span><span class="hk">\</span><span class="hd">HashException</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Exceptions</span><span class="hk">\</span><span class="hd">ImageTypeException</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Meta</span><span class="hk">;<br /><br /></span><span class="hc">/**<br />&nbsp;*&nbsp;Basic&nbsp;implementation&nbsp;of&nbsp;the&nbsp;image&nbsp;meta&nbsp;information&nbsp;as&nbsp;Doctrine&nbsp;entity.<br />&nbsp;*<br />&nbsp;*&nbsp;@ORM\MappedSuperClass<br />&nbsp;*/<br /></span><span class="hk">class&nbsp;</span><span class="hd">ImageEntity&nbsp;</span><span class="hk">implements&nbsp;</span><span class="hd">Meta<br /></span><span class="hk">{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;SHA1&nbsp;hash&nbsp;of&nbsp;the&nbsp;original&nbsp;image<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@ORM\Column(length=40,&nbsp;nullable=true)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;</span><span class="hd">$hash</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Original&nbsp;image&nbsp;type&nbsp;as&nbsp;defined&nbsp;in&nbsp;the&nbsp;`Image`&nbsp;class&nbsp;constants&nbsp;`JPEG`,&nbsp;`GIF`&nbsp;and&nbsp;`PNG`.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@ORM\Column(type="integer",&nbsp;nullable=true)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;integer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;</span><span class="hd">$type</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@ORM\Column(type="integer",&nbsp;nullable=true)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;integer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;</span><span class="hd">$width</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@ORM\Column(type="integer",&nbsp;nullable=true)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;integer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;</span><span class="hd">$height</span><span class="hk">;<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">getHash</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">hash</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;string&nbsp;$hash<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;ImageEntity<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">setHash</span><span class="hk">(</span><span class="hd">$hash</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">hash&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">checkHash</span><span class="hk">(</span><span class="hd">$hash</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;integer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">getType</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">type</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Checks&nbsp;that&nbsp;the&nbsp;given&nbsp;string&nbsp;is&nbsp;valid&nbsp;SHA1&nbsp;hash&nbsp;and&nbsp;normalizes&nbsp;it&nbsp;to&nbsp;lower&nbsp;case.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;string&nbsp;$hash&nbsp;Image&nbsp;hash&nbsp;to&nbsp;validate<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;HashException&nbsp;If&nbsp;the&nbsp;hash&nbsp;is&nbsp;not&nbsp;valid&nbsp;image&nbsp;hash<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;valid&nbsp;image&nbsp;hash<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;function&nbsp;</span><span class="hd">checkHash</span><span class="hk">(</span><span class="hd">$hash</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span class="hd">is_string</span><span class="hk">(</span><span class="hd">$hash</span><span class="hk">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span class="hd">HashException</span><span class="hk">(</span><span class="hd">$hash</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$hash&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">Strings</span><span class="hk">::</span><span class="hd">lower</span><span class="hk">(</span><span class="hd">$hash</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span class="hd">preg_match</span><span class="hk">(</span><span class="hs">'/^[0-9a-f]{40}$/'</span><span class="hk">,&nbsp;</span><span class="hd">$hash</span><span class="hk">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span class="hd">HashException</span><span class="hk">(</span><span class="hd">$hash</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$hash</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;integer&nbsp;$type<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;ImageEntity<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">setType</span><span class="hk">(</span><span class="hd">$type</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">type&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">checkType</span><span class="hk">(</span><span class="hd">$type</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Checks&nbsp;the&nbsp;given&nbsp;image&nbsp;type&nbsp;to&nbsp;be&nbsp;one&nbsp;of&nbsp;the&nbsp;supported&nbsp;types.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;integer&nbsp;$type<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;integer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;ImageTypeException<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;function&nbsp;</span><span class="hd">checkType</span><span class="hk">(</span><span class="hd">$type</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span class="hd">in_array</span><span class="hk">(</span><span class="hd">$type</span><span class="hk">,&nbsp;array(</span><span class="hd">Image</span><span class="hk">::</span><span class="hd">JPEG</span><span class="hk">,&nbsp;</span><span class="hd">Image</span><span class="hk">::</span><span class="hd">PNG</span><span class="hk">,&nbsp;</span><span class="hd">Image</span><span class="hk">::</span><span class="hd">GIF</span><span class="hk">),&nbsp;</span><span class="hd">TRUE</span><span class="hk">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span class="hd">ImageTypeException</span><span class="hk">(</span><span class="hd">$type</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$type</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;integer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">getHeight</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">height</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;integer&nbsp;$height<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">setHeight</span><span class="hk">(</span><span class="hd">$height</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">height&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$height</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;integer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">getWidth</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">width</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;integer&nbsp;$width<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">setWidth</span><span class="hk">(</span><span class="hd">$width</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">width&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$width</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></span>
</span>
</code>		</div>
		</div>
	</div>
		<div>
		<table>
		<tr>
			<td class="number"><small>100 %</small></td>
			<td><div class="bar"><div style="width: 100%"></div></div></td>
			<td><a href="#F12" class="toggle">ImageStore/Entity/EmptyImage.php</a></td>
		</tr>
		</table>

		<div class="code" id="F12">
		<div>
			<aside>
			<div><a href='#F12L1' id='F12L1'>  1</a>
<a href='#F12L2' id='F12L2'>  2</a>
<a href='#F12L3' id='F12L3'>  3</a>
<a href='#F12L4' id='F12L4'>  4</a>
<a href='#F12L5' id='F12L5'>  5</a>
<a href='#F12L6' id='F12L6'>  6</a>
<a href='#F12L7' id='F12L7'>  7</a>
<a href='#F12L8' id='F12L8'>  8</a>
<a href='#F12L9' id='F12L9'>  9</a>
<a href='#F12L10' id='F12L10'> 10</a>
<a href='#F12L11' id='F12L11'> 11</a></div><div class='t'><a href='#F12L12' id='F12L12'> 12</a></div><div><a href='#F12L13' id='F12L13'> 13</a>
<a href='#F12L14' id='F12L14'> 14</a>
<a href='#F12L15' id='F12L15'> 15</a>
<a href='#F12L16' id='F12L16'> 16</a></div><div class='t'><a href='#F12L17' id='F12L17'> 17</a></div><div class='dead'><a href='#F12L18' id='F12L18'> 18</a></div><div><a href='#F12L19' id='F12L19'> 19</a>
<a href='#F12L20' id='F12L20'> 20</a>
<a href='#F12L21' id='F12L21'> 21</a>
<a href='#F12L22' id='F12L22'> 22</a></div><div class='t'><a href='#F12L23' id='F12L23'> 23</a></div><div class='dead'><a href='#F12L24' id='F12L24'> 24</a></div><div><a href='#F12L25' id='F12L25'> 25</a>
<a href='#F12L26' id='F12L26'> 26</a>
<a href='#F12L27' id='F12L27'> 27</a>
<a href='#F12L28' id='F12L28'> 28</a></div><div class='t'><a href='#F12L29' id='F12L29'> 29</a></div><div class='dead'><a href='#F12L30' id='F12L30'> 30</a></div><div><a href='#F12L31' id='F12L31'> 31</a>
<a href='#F12L32' id='F12L32'> 32</a>
<a href='#F12L33' id='F12L33'> 33</a>
<a href='#F12L34' id='F12L34'> 34</a></div><div class='t'><a href='#F12L35' id='F12L35'> 35</a></div><div class='dead'><a href='#F12L36' id='F12L36'> 36</a></div><div><a href='#F12L37' id='F12L37'> 37</a>
<a href='#F12L38' id='F12L38'> 38</a>
<a href='#F12L39' id='F12L39'> 39</a>
<a href='#F12L40' id='F12L40'> 40</a></div><div class='t'><a href='#F12L41' id='F12L41'> 41</a></div><div class='dead'><a href='#F12L42' id='F12L42'> 42</a></div><div><a href='#F12L43' id='F12L43'> 43</a>
<a href='#F12L44' id='F12L44'> 44</a>
<a href='#F12L45' id='F12L45'> 45</a>
<a href='#F12L46' id='F12L46'> 46</a></div><div class='t'><a href='#F12L47' id='F12L47'> 47</a></div><div class='dead'><a href='#F12L48' id='F12L48'> 48</a></div><div><a href='#F12L49' id='F12L49'> 49</a>
<a href='#F12L50' id='F12L50'> 50</a>
</div>			</aside>
			<code style='margin-left: 3em'><span class="hh">
<span class="hd">&lt;?php<br /><br /></span><span class="hk">namespace&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Entity</span><span class="hk">;<br /><br /><br />use&nbsp;</span><span class="hd">Nette</span><span class="hk">\</span><span class="hd">Utils</span><span class="hk">\</span><span class="hd">Image</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Meta</span><span class="hk">;<br /><br /></span><span class="hc">/**<br />&nbsp;*&nbsp;"Image&nbsp;not&nbsp;found"&nbsp;entity<br />&nbsp;*/<br /></span><span class="hk">class&nbsp;</span><span class="hd">EmptyImage&nbsp;</span><span class="hk">implements&nbsp;</span><span class="hd">Meta<br /></span><span class="hk">{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span class="hd">getHash</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hs">'_empty'</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span class="hd">getType</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">Image</span><span class="hk">::</span><span class="hd">PNG</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span class="hd">setHash</span><span class="hk">(</span><span class="hd">$hash</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;\</span><span class="hd">LogicException</span><span class="hk">(</span><span class="hs">'Unavailable&nbsp;image&nbsp;hash&nbsp;cannot&nbsp;be&nbsp;changed.'</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span class="hd">setType</span><span class="hk">(</span><span class="hd">$type</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;\</span><span class="hd">LogicException</span><span class="hk">(</span><span class="hs">'Unavailable&nbsp;image&nbsp;hash&nbsp;cannot&nbsp;be&nbsp;changed.'</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span class="hd">getHeight</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">1080</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span class="hd">getWidth</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">1920</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />}<br /></span>
</span>
</code>		</div>
		</div>
	</div>
		<div>
		<table>
		<tr class='light'>
			<td class="number"><small>100 %</small></td>
			<td><div class="bar"><div style="width: 100%"></div></div></td>
			<td><a href="#F13" class="toggle">ImageStore/UploaderException.php</a></td>
		</tr>
		</table>

		<div class="code" id="F13">
		<div>
			<aside>
			<div><a href='#F13L1' id='F13L1'>  1</a>
<a href='#F13L2' id='F13L2'>  2</a>
<a href='#F13L3' id='F13L3'>  3</a>
<a href='#F13L4' id='F13L4'>  4</a>
<a href='#F13L5' id='F13L5'>  5</a>
<a href='#F13L6' id='F13L6'>  6</a>
<a href='#F13L7' id='F13L7'>  7</a>
<a href='#F13L8' id='F13L8'>  8</a>
<a href='#F13L9' id='F13L9'>  9</a>
<a href='#F13L10' id='F13L10'> 10</a>
<a href='#F13L11' id='F13L11'> 11</a></div><div class='t'><a href='#F13L12' id='F13L12'> 12</a></div><div><a href='#F13L13' id='F13L13'> 13</a>
<a href='#F13L14' id='F13L14'> 14</a>
<a href='#F13L15' id='F13L15'> 15</a>
<a href='#F13L16' id='F13L16'> 16</a>
<a href='#F13L17' id='F13L17'> 17</a>
<a href='#F13L18' id='F13L18'> 18</a>
<a href='#F13L19' id='F13L19'> 19</a>
<a href='#F13L20' id='F13L20'> 20</a>
<a href='#F13L21' id='F13L21'> 21</a>
<a href='#F13L22' id='F13L22'> 22</a>
<a href='#F13L23' id='F13L23'> 23</a>
<a href='#F13L24' id='F13L24'> 24</a>
<a href='#F13L25' id='F13L25'> 25</a>
<a href='#F13L26' id='F13L26'> 26</a>
<a href='#F13L27' id='F13L27'> 27</a>
<a href='#F13L28' id='F13L28'> 28</a>
<a href='#F13L29' id='F13L29'> 29</a>
<a href='#F13L30' id='F13L30'> 30</a>
<a href='#F13L31' id='F13L31'> 31</a>
<a href='#F13L32' id='F13L32'> 32</a>
<a href='#F13L33' id='F13L33'> 33</a>
<a href='#F13L34' id='F13L34'> 34</a>
<a href='#F13L35' id='F13L35'> 35</a></div><div class='t'><a href='#F13L36' id='F13L36'> 36</a>
<a href='#F13L37' id='F13L37'> 37</a></div><div><a href='#F13L38' id='F13L38'> 38</a>
<a href='#F13L39' id='F13L39'> 39</a>
<a href='#F13L40' id='F13L40'> 40</a>
</div>			</aside>
			<code style='margin-left: 3em'><span class="hh">
<span class="hd">&lt;?php<br /><br /></span><span class="hk">namespace&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">;<br /><br /><br />use&nbsp;</span><span class="hd">RuntimeException</span><span class="hk">;<br /><br /></span><span class="hc">/**<br />&nbsp;*&nbsp;Image&nbsp;upload&nbsp;error&nbsp;exception<br />&nbsp;*/<br /></span><span class="hk">class&nbsp;</span><span class="hd">UploaderException&nbsp;</span><span class="hk">extends&nbsp;</span><span class="hd">RuntimeException<br /></span><span class="hk">{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Upload&nbsp;error&nbsp;code&nbsp;-&gt;&nbsp;error&nbsp;message&nbsp;map<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;string[]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;</span><span class="hd">$messages&nbsp;</span><span class="hk">=&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">0&nbsp;</span><span class="hk">=&gt;&nbsp;</span><span class="hs">"There&nbsp;is&nbsp;no&nbsp;error,&nbsp;the&nbsp;file&nbsp;uploaded&nbsp;with&nbsp;success"</span><span class="hk">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">1&nbsp;</span><span class="hk">=&gt;&nbsp;</span><span class="hs">"The&nbsp;uploaded&nbsp;file&nbsp;exceeds&nbsp;the&nbsp;upload_max_filesize&nbsp;directive&nbsp;in&nbsp;php.ini"</span><span class="hk">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">2&nbsp;</span><span class="hk">=&gt;&nbsp;</span><span class="hs">"The&nbsp;uploaded&nbsp;file&nbsp;exceeds&nbsp;the&nbsp;MAX_FILE_SIZE&nbsp;directive&nbsp;that&nbsp;was&nbsp;specified&nbsp;in&nbsp;the&nbsp;HTML&nbsp;form"</span><span class="hk">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">3&nbsp;</span><span class="hk">=&gt;&nbsp;</span><span class="hs">"The&nbsp;uploaded&nbsp;file&nbsp;was&nbsp;only&nbsp;partially&nbsp;uploaded"</span><span class="hk">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">4&nbsp;</span><span class="hk">=&gt;&nbsp;</span><span class="hs">"No&nbsp;file&nbsp;was&nbsp;uploaded"</span><span class="hk">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">6&nbsp;</span><span class="hk">=&gt;&nbsp;</span><span class="hs">"Missing&nbsp;a&nbsp;temporary&nbsp;folder"</span><span class="hk">,<br />&nbsp;&nbsp;&nbsp;&nbsp;];<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;the&nbsp;upload&nbsp;error&nbsp;exception&nbsp;using&nbsp;the&nbsp;given&nbsp;upload&nbsp;error&nbsp;code.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;$code<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">__construct</span><span class="hk">(</span><span class="hd">$code</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">parent</span><span class="hk">::</span><span class="hd">__construct</span><span class="hk">(</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">messages</span><span class="hk">[</span><span class="hd">$code</span><span class="hk">],&nbsp;</span><span class="hd">$code</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />}<br /></span>
</span>
</code>		</div>
		</div>
	</div>
		<div>
		<table>
		<tr class='light'>
			<td class="number"><small>100 %</small></td>
			<td><div class="bar"><div style="width: 100%"></div></div></td>
			<td><a href="#F14" class="toggle">ImageStore/Storage.php</a></td>
		</tr>
		</table>

		<div class="code" id="F14">
		<div>
			<aside>
			<div><a href='#F14L1' id='F14L1'>  1</a>
<a href='#F14L2' id='F14L2'>  2</a>
<a href='#F14L3' id='F14L3'>  3</a>
<a href='#F14L4' id='F14L4'>  4</a>
<a href='#F14L5' id='F14L5'>  5</a>
<a href='#F14L6' id='F14L6'>  6</a>
<a href='#F14L7' id='F14L7'>  7</a>
<a href='#F14L8' id='F14L8'>  8</a>
<a href='#F14L9' id='F14L9'>  9</a>
<a href='#F14L10' id='F14L10'> 10</a></div><div class='t'><a href='#F14L11' id='F14L11'> 11</a></div><div><a href='#F14L12' id='F14L12'> 12</a>
<a href='#F14L13' id='F14L13'> 13</a>
<a href='#F14L14' id='F14L14'> 14</a>
<a href='#F14L15' id='F14L15'> 15</a>
<a href='#F14L16' id='F14L16'> 16</a>
<a href='#F14L17' id='F14L17'> 17</a>
<a href='#F14L18' id='F14L18'> 18</a>
<a href='#F14L19' id='F14L19'> 19</a>
<a href='#F14L20' id='F14L20'> 20</a>
<a href='#F14L21' id='F14L21'> 21</a>
<a href='#F14L22' id='F14L22'> 22</a>
<a href='#F14L23' id='F14L23'> 23</a>
<a href='#F14L24' id='F14L24'> 24</a>
<a href='#F14L25' id='F14L25'> 25</a>
<a href='#F14L26' id='F14L26'> 26</a>
<a href='#F14L27' id='F14L27'> 27</a>
<a href='#F14L28' id='F14L28'> 28</a>
<a href='#F14L29' id='F14L29'> 29</a>
<a href='#F14L30' id='F14L30'> 30</a>
<a href='#F14L31' id='F14L31'> 31</a>
<a href='#F14L32' id='F14L32'> 32</a>
<a href='#F14L33' id='F14L33'> 33</a>
<a href='#F14L34' id='F14L34'> 34</a>
<a href='#F14L35' id='F14L35'> 35</a>
<a href='#F14L36' id='F14L36'> 36</a>
<a href='#F14L37' id='F14L37'> 37</a>
<a href='#F14L38' id='F14L38'> 38</a>
<a href='#F14L39' id='F14L39'> 39</a>
<a href='#F14L40' id='F14L40'> 40</a>
<a href='#F14L41' id='F14L41'> 41</a>
<a href='#F14L42' id='F14L42'> 42</a>
<a href='#F14L43' id='F14L43'> 43</a>
<a href='#F14L44' id='F14L44'> 44</a>
<a href='#F14L45' id='F14L45'> 45</a>
<a href='#F14L46' id='F14L46'> 46</a>
<a href='#F14L47' id='F14L47'> 47</a>
<a href='#F14L48' id='F14L48'> 48</a>
<a href='#F14L49' id='F14L49'> 49</a>
<a href='#F14L50' id='F14L50'> 50</a>
<a href='#F14L51' id='F14L51'> 51</a>
<a href='#F14L52' id='F14L52'> 52</a>
<a href='#F14L53' id='F14L53'> 53</a>
<a href='#F14L54' id='F14L54'> 54</a>
<a href='#F14L55' id='F14L55'> 55</a>
<a href='#F14L56' id='F14L56'> 56</a>
<a href='#F14L57' id='F14L57'> 57</a>
<a href='#F14L58' id='F14L58'> 58</a>
<a href='#F14L59' id='F14L59'> 59</a>
<a href='#F14L60' id='F14L60'> 60</a>
<a href='#F14L61' id='F14L61'> 61</a>
<a href='#F14L62' id='F14L62'> 62</a>
<a href='#F14L63' id='F14L63'> 63</a>
<a href='#F14L64' id='F14L64'> 64</a>
<a href='#F14L65' id='F14L65'> 65</a>
<a href='#F14L66' id='F14L66'> 66</a>
<a href='#F14L67' id='F14L67'> 67</a>
<a href='#F14L68' id='F14L68'> 68</a>
<a href='#F14L69' id='F14L69'> 69</a>
<a href='#F14L70' id='F14L70'> 70</a>
<a href='#F14L71' id='F14L71'> 71</a>
<a href='#F14L72' id='F14L72'> 72</a>
<a href='#F14L73' id='F14L73'> 73</a>
<a href='#F14L74' id='F14L74'> 74</a>
<a href='#F14L75' id='F14L75'> 75</a>
<a href='#F14L76' id='F14L76'> 76</a>
<a href='#F14L77' id='F14L77'> 77</a>
<a href='#F14L78' id='F14L78'> 78</a>
<a href='#F14L79' id='F14L79'> 79</a>
<a href='#F14L80' id='F14L80'> 80</a>
<a href='#F14L81' id='F14L81'> 81</a>
<a href='#F14L82' id='F14L82'> 82</a>
<a href='#F14L83' id='F14L83'> 83</a>
<a href='#F14L84' id='F14L84'> 84</a>
<a href='#F14L85' id='F14L85'> 85</a>
<a href='#F14L86' id='F14L86'> 86</a>
<a href='#F14L87' id='F14L87'> 87</a>
<a href='#F14L88' id='F14L88'> 88</a>
</div>			</aside>
			<code style='margin-left: 3em'><span class="hh">
<span class="hd">&lt;?php<br /><br /></span><span class="hk">namespace&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">;<br /><br /><br />use&nbsp;</span><span class="hd">Nette</span><span class="hk">\</span><span class="hd">Http</span><span class="hk">\</span><span class="hd">FileUpload</span><span class="hk">;<br /><br /></span><span class="hc">/**<br />&nbsp;*&nbsp;Image&nbsp;Storage&nbsp;Interface<br />&nbsp;*/<br /></span><span class="hk">interface&nbsp;</span><span class="hd">Storage<br /></span><span class="hk">{<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;TRUE&nbsp;if&nbsp;the&nbsp;storage&nbsp;contains&nbsp;the&nbsp;given&nbsp;image.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;Meta&nbsp;$meta<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;boolean<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">contains</span><span class="hk">(</span><span class="hd">Meta&nbsp;$meta</span><span class="hk">);<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;requested&nbsp;image&nbsp;encapsulated&nbsp;in&nbsp;a&nbsp;HTTP&nbsp;response&nbsp;object.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;Request&nbsp;$request<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;IResponse<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">download</span><span class="hk">(</span><span class="hd">Request&nbsp;$request</span><span class="hk">);<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;requested&nbsp;image&nbsp;object.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;Request&nbsp;$request<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;mixed<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">fetch</span><span class="hk">(</span><span class="hd">Request&nbsp;$request</span><span class="hk">);<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;the&nbsp;URL&nbsp;of&nbsp;the&nbsp;requested&nbsp;image&nbsp;thumbnail.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;Request&nbsp;$request<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">link</span><span class="hk">(</span><span class="hd">Request&nbsp;$request</span><span class="hk">);<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Fetches&nbsp;the&nbsp;original&nbsp;stored&nbsp;image.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;Meta&nbsp;$meta<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;Image<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">original</span><span class="hk">(</span><span class="hd">Meta&nbsp;$meta</span><span class="hk">);<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Removes&nbsp;the&nbsp;requested&nbsp;image&nbsp;from&nbsp;the&nbsp;storage.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;Meta&nbsp;$meta<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;void<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">remove</span><span class="hk">(</span><span class="hd">Meta&nbsp;$meta</span><span class="hk">);<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Renders&nbsp;the&nbsp;requested&nbsp;image&nbsp;to&nbsp;the&nbsp;standard&nbsp;output.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;&nbsp;Request&nbsp;$request<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;void<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">send</span><span class="hk">(</span><span class="hd">Request&nbsp;$request</span><span class="hk">);<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Uploads&nbsp;an&nbsp;image&nbsp;to&nbsp;the&nbsp;storage&nbsp;and&nbsp;store&nbsp;it's&nbsp;meta&nbsp;information&nbsp;in&nbsp;the&nbsp;given&nbsp;image&nbsp;entity.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;FileUpload&nbsp;$file<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;Meta&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$meta<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;void<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">upload</span><span class="hk">(</span><span class="hd">FileUpload&nbsp;$file</span><span class="hk">,&nbsp;</span><span class="hd">Meta&nbsp;$meta</span><span class="hk">);<br /><br /><br />}<br /></span>
</span>
</code>		</div>
		</div>
	</div>
		<div>
		<table>
		<tr>
			<td class="number"><small>100 %</small></td>
			<td><div class="bar"><div style="width: 100%"></div></div></td>
			<td><a href="#F15" class="toggle">ImageStore/Requests/ImageRequest.php</a></td>
		</tr>
		</table>

		<div class="code" id="F15">
		<div>
			<aside>
			<div><a href='#F15L1' id='F15L1'>   1</a>
<a href='#F15L2' id='F15L2'>   2</a>
<a href='#F15L3' id='F15L3'>   3</a>
<a href='#F15L4' id='F15L4'>   4</a>
<a href='#F15L5' id='F15L5'>   5</a>
<a href='#F15L6' id='F15L6'>   6</a>
<a href='#F15L7' id='F15L7'>   7</a>
<a href='#F15L8' id='F15L8'>   8</a>
<a href='#F15L9' id='F15L9'>   9</a>
<a href='#F15L10' id='F15L10'>  10</a>
<a href='#F15L11' id='F15L11'>  11</a>
<a href='#F15L12' id='F15L12'>  12</a>
<a href='#F15L13' id='F15L13'>  13</a>
<a href='#F15L14' id='F15L14'>  14</a></div><div class='t'><a href='#F15L15' id='F15L15'>  15</a></div><div><a href='#F15L16' id='F15L16'>  16</a>
<a href='#F15L17' id='F15L17'>  17</a>
<a href='#F15L18' id='F15L18'>  18</a>
<a href='#F15L19' id='F15L19'>  19</a>
<a href='#F15L20' id='F15L20'>  20</a>
<a href='#F15L21' id='F15L21'>  21</a>
<a href='#F15L22' id='F15L22'>  22</a>
<a href='#F15L23' id='F15L23'>  23</a>
<a href='#F15L24' id='F15L24'>  24</a>
<a href='#F15L25' id='F15L25'>  25</a>
<a href='#F15L26' id='F15L26'>  26</a>
<a href='#F15L27' id='F15L27'>  27</a>
<a href='#F15L28' id='F15L28'>  28</a>
<a href='#F15L29' id='F15L29'>  29</a>
<a href='#F15L30' id='F15L30'>  30</a>
<a href='#F15L31' id='F15L31'>  31</a>
<a href='#F15L32' id='F15L32'>  32</a>
<a href='#F15L33' id='F15L33'>  33</a>
<a href='#F15L34' id='F15L34'>  34</a>
<a href='#F15L35' id='F15L35'>  35</a>
<a href='#F15L36' id='F15L36'>  36</a>
<a href='#F15L37' id='F15L37'>  37</a>
<a href='#F15L38' id='F15L38'>  38</a>
<a href='#F15L39' id='F15L39'>  39</a>
<a href='#F15L40' id='F15L40'>  40</a>
<a href='#F15L41' id='F15L41'>  41</a>
<a href='#F15L42' id='F15L42'>  42</a>
<a href='#F15L43' id='F15L43'>  43</a>
<a href='#F15L44' id='F15L44'>  44</a>
<a href='#F15L45' id='F15L45'>  45</a>
<a href='#F15L46' id='F15L46'>  46</a>
<a href='#F15L47' id='F15L47'>  47</a>
<a href='#F15L48' id='F15L48'>  48</a>
<a href='#F15L49' id='F15L49'>  49</a>
<a href='#F15L50' id='F15L50'>  50</a>
<a href='#F15L51' id='F15L51'>  51</a>
<a href='#F15L52' id='F15L52'>  52</a>
<a href='#F15L53' id='F15L53'>  53</a>
<a href='#F15L54' id='F15L54'>  54</a>
<a href='#F15L55' id='F15L55'>  55</a>
<a href='#F15L56' id='F15L56'>  56</a></div><div class='t'><a href='#F15L57' id='F15L57'>  57</a>
<a href='#F15L58' id='F15L58'>  58</a>
<a href='#F15L59' id='F15L59'>  59</a>
<a href='#F15L60' id='F15L60'>  60</a>
<a href='#F15L61' id='F15L61'>  61</a></div><div><a href='#F15L62' id='F15L62'>  62</a>
<a href='#F15L63' id='F15L63'>  63</a>
<a href='#F15L64' id='F15L64'>  64</a>
<a href='#F15L65' id='F15L65'>  65</a>
<a href='#F15L66' id='F15L66'>  66</a>
<a href='#F15L67' id='F15L67'>  67</a>
<a href='#F15L68' id='F15L68'>  68</a>
<a href='#F15L69' id='F15L69'>  69</a>
<a href='#F15L70' id='F15L70'>  70</a>
<a href='#F15L71' id='F15L71'>  71</a>
<a href='#F15L72' id='F15L72'>  72</a></div><div class='t'><a href='#F15L73' id='F15L73'>  73</a>
<a href='#F15L74' id='F15L74'>  74</a>
<a href='#F15L75' id='F15L75'>  75</a></div><div><a href='#F15L76' id='F15L76'>  76</a></div><div class='t'><a href='#F15L77' id='F15L77'>  77</a>
<a href='#F15L78' id='F15L78'>  78</a></div><div><a href='#F15L79' id='F15L79'>  79</a></div><div class='t'><a href='#F15L80' id='F15L80'>  80</a></div><div><a href='#F15L81' id='F15L81'>  81</a></div><div class='t'><a href='#F15L82' id='F15L82'>  82</a></div><div class='dead'><a href='#F15L83' id='F15L83'>  83</a></div><div><a href='#F15L84' id='F15L84'>  84</a>
<a href='#F15L85' id='F15L85'>  85</a>
<a href='#F15L86' id='F15L86'>  86</a>
<a href='#F15L87' id='F15L87'>  87</a>
<a href='#F15L88' id='F15L88'>  88</a>
<a href='#F15L89' id='F15L89'>  89</a>
<a href='#F15L90' id='F15L90'>  90</a>
<a href='#F15L91' id='F15L91'>  91</a>
<a href='#F15L92' id='F15L92'>  92</a>
<a href='#F15L93' id='F15L93'>  93</a>
<a href='#F15L94' id='F15L94'>  94</a></div><div class='t'><a href='#F15L95' id='F15L95'>  95</a>
<a href='#F15L96' id='F15L96'>  96</a>
<a href='#F15L97' id='F15L97'>  97</a></div><div><a href='#F15L98' id='F15L98'>  98</a></div><div class='t'><a href='#F15L99' id='F15L99'>  99</a></div><div class='dead'><a href='#F15L100' id='F15L100'> 100</a></div><div><a href='#F15L101' id='F15L101'> 101</a>
<a href='#F15L102' id='F15L102'> 102</a>
<a href='#F15L103' id='F15L103'> 103</a>
<a href='#F15L104' id='F15L104'> 104</a>
<a href='#F15L105' id='F15L105'> 105</a>
<a href='#F15L106' id='F15L106'> 106</a>
<a href='#F15L107' id='F15L107'> 107</a></div><div class='t'><a href='#F15L108' id='F15L108'> 108</a></div><div class='dead'><a href='#F15L109' id='F15L109'> 109</a></div><div><a href='#F15L110' id='F15L110'> 110</a>
<a href='#F15L111' id='F15L111'> 111</a>
<a href='#F15L112' id='F15L112'> 112</a>
<a href='#F15L113' id='F15L113'> 113</a>
<a href='#F15L114' id='F15L114'> 114</a>
<a href='#F15L115' id='F15L115'> 115</a>
<a href='#F15L116' id='F15L116'> 116</a></div><div class='t'><a href='#F15L117' id='F15L117'> 117</a></div><div class='dead'><a href='#F15L118' id='F15L118'> 118</a></div><div><a href='#F15L119' id='F15L119'> 119</a>
<a href='#F15L120' id='F15L120'> 120</a>
<a href='#F15L121' id='F15L121'> 121</a>
<a href='#F15L122' id='F15L122'> 122</a>
<a href='#F15L123' id='F15L123'> 123</a>
<a href='#F15L124' id='F15L124'> 124</a>
<a href='#F15L125' id='F15L125'> 125</a>
<a href='#F15L126' id='F15L126'> 126</a></div><div class='t'><a href='#F15L127' id='F15L127'> 127</a></div><div><a href='#F15L128' id='F15L128'> 128</a></div><div class='t'><a href='#F15L129' id='F15L129'> 129</a></div><div class='dead'><a href='#F15L130' id='F15L130'> 130</a></div><div><a href='#F15L131' id='F15L131'> 131</a>
<a href='#F15L132' id='F15L132'> 132</a>
<a href='#F15L133' id='F15L133'> 133</a>
<a href='#F15L134' id='F15L134'> 134</a>
<a href='#F15L135' id='F15L135'> 135</a>
<a href='#F15L136' id='F15L136'> 136</a>
<a href='#F15L137' id='F15L137'> 137</a></div><div class='t'><a href='#F15L138' id='F15L138'> 138</a></div><div class='dead'><a href='#F15L139' id='F15L139'> 139</a></div><div><a href='#F15L140' id='F15L140'> 140</a>
<a href='#F15L141' id='F15L141'> 141</a>
<a href='#F15L142' id='F15L142'> 142</a>
<a href='#F15L143' id='F15L143'> 143</a>
<a href='#F15L144' id='F15L144'> 144</a>
<a href='#F15L145' id='F15L145'> 145</a>
<a href='#F15L146' id='F15L146'> 146</a></div><div class='t'><a href='#F15L147' id='F15L147'> 147</a></div><div class='dead'><a href='#F15L148' id='F15L148'> 148</a></div><div><a href='#F15L149' id='F15L149'> 149</a>
<a href='#F15L150' id='F15L150'> 150</a>
</div>			</aside>
			<code style='margin-left: 4em'><span class="hh">
<span class="hd">&lt;?php<br /><br /></span><span class="hk">namespace&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Requests</span><span class="hk">;<br /><br /><br />use&nbsp;</span><span class="hd">Nette</span><span class="hk">\</span><span class="hd">Object</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Nette</span><span class="hk">\</span><span class="hd">Utils</span><span class="hk">\</span><span class="hd">Image</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Entity</span><span class="hk">\</span><span class="hd">EmptyImage</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Meta</span><span class="hk">;<br />use&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">\</span><span class="hd">Request</span><span class="hk">;<br /><br /></span><span class="hc">/**<br />&nbsp;*&nbsp;Image&nbsp;request&nbsp;encapsulation<br />&nbsp;*/<br /></span><span class="hk">class&nbsp;</span><span class="hd">ImageRequest&nbsp;</span><span class="hk">extends&nbsp;</span><span class="hd">Object&nbsp;</span><span class="hk">implements&nbsp;</span><span class="hd">Request<br /></span><span class="hk">{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;requested&nbsp;image&nbsp;meta&nbsp;information.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;Meta<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;</span><span class="hd">$meta</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;requested&nbsp;image&nbsp;thumbnail&nbsp;dimensions<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;</span><span class="hd">$dimensions</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;requested&nbsp;image&nbsp;thumbnail&nbsp;flags.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;integer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;</span><span class="hd">$flags</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;requested&nbsp;image&nbsp;thumbnail&nbsp;cropping&nbsp;flag.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;boolean<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">private&nbsp;</span><span class="hd">$crop&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">FALSE</span><span class="hk">;<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Constructs&nbsp;the&nbsp;image&nbsp;request&nbsp;from&nbsp;the&nbsp;given&nbsp;meta&nbsp;information,&nbsp;requested&nbsp;dimensions&nbsp;and&nbsp;flags.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;Meta&nbsp;&nbsp;&nbsp;&nbsp;$meta<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;integer&nbsp;$dimensions<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;integer&nbsp;$flags<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;boolean&nbsp;$crop<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">__construct</span><span class="hk">(</span><span class="hd">Meta&nbsp;$meta</span><span class="hk">,&nbsp;</span><span class="hd">$dimensions&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">Request</span><span class="hk">::</span><span class="hd">ORIGINAL</span><span class="hk">,&nbsp;</span><span class="hd">$flags&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">Request</span><span class="hk">::</span><span class="hd">ORIGINAL</span><span class="hk">,&nbsp;</span><span class="hd">$crop&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">FALSE</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">meta&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$meta</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">dimensions&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$dimensions</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">flags&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$flags</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">crop&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$crop</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;the&nbsp;image&nbsp;request&nbsp;from&nbsp;the&nbsp;crop&nbsp;macro&nbsp;arguments.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;Meta&nbsp;&nbsp;$image<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;array&nbsp;$args<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;ImageRequest<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;static&nbsp;function&nbsp;</span><span class="hd">crop</span><span class="hk">(</span><span class="hd">Meta&nbsp;$image&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">NULL</span><span class="hk">,&nbsp;</span><span class="hd">$args&nbsp;</span><span class="hk">=&nbsp;array())<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span class="hd">$image&nbsp;</span><span class="hk">===&nbsp;</span><span class="hd">NULL</span><span class="hk">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$image&nbsp;</span><span class="hk">=&nbsp;new&nbsp;</span><span class="hd">EmptyImage</span><span class="hk">();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$dimensions&nbsp;</span><span class="hk">=&nbsp;isset(</span><span class="hd">$args</span><span class="hk">[</span><span class="hd">0</span><span class="hk">])&nbsp;?&nbsp;</span><span class="hd">$args</span><span class="hk">[</span><span class="hd">0</span><span class="hk">]&nbsp;:&nbsp;</span><span class="hd">Request</span><span class="hk">::</span><span class="hd">ORIGINAL</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$flags&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">Image</span><span class="hk">::</span><span class="hd">FIT</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$request&nbsp;</span><span class="hk">=&nbsp;new&nbsp;</span><span class="hd">ImageRequest</span><span class="hk">(</span><span class="hd">$image</span><span class="hk">,&nbsp;</span><span class="hd">$dimensions</span><span class="hk">,&nbsp;</span><span class="hd">$flags</span><span class="hk">,&nbsp;</span><span class="hd">TRUE</span><span class="hk">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$request</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;the&nbsp;image&nbsp;request&nbsp;from&nbsp;the&nbsp;image&nbsp;macro&nbsp;arguments.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;Meta&nbsp;&nbsp;$image<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;array&nbsp;$args<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;ImageRequest<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;static&nbsp;function&nbsp;</span><span class="hd">fromMacro</span><span class="hk">(</span><span class="hd">Meta&nbsp;$image&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">NULL</span><span class="hk">,&nbsp;</span><span class="hd">$args&nbsp;</span><span class="hk">=&nbsp;array())<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span class="hd">$image&nbsp;</span><span class="hk">===&nbsp;</span><span class="hd">NULL</span><span class="hk">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$image&nbsp;</span><span class="hk">=&nbsp;new&nbsp;</span><span class="hd">EmptyImage</span><span class="hk">();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;</span><span class="hd">ImageRequest</span><span class="hk">(</span><span class="hd">$image</span><span class="hk">,&nbsp;isset(</span><span class="hd">$args</span><span class="hk">[</span><span class="hd">0</span><span class="hk">])&nbsp;?&nbsp;</span><span class="hd">$args</span><span class="hk">[</span><span class="hd">0</span><span class="hk">]&nbsp;:&nbsp;</span><span class="hd">Request</span><span class="hk">::</span><span class="hd">ORIGINAL</span><span class="hk">,&nbsp;isset(</span><span class="hd">$args</span><span class="hk">[</span><span class="hd">1</span><span class="hk">])&nbsp;?&nbsp;</span><span class="hd">$args</span><span class="hk">[</span><span class="hd">1</span><span class="hk">]&nbsp;:&nbsp;</span><span class="hd">Request</span><span class="hk">::</span><span class="hd">ORIGINAL</span><span class="hk">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;boolean<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">getCrop</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">crop</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;Meta<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">getMeta</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">meta</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;Meta&nbsp;$meta<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;Request<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">setMeta</span><span class="hk">(</span><span class="hd">Meta&nbsp;$meta</span><span class="hk">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">meta&nbsp;</span><span class="hk">=&nbsp;</span><span class="hd">$meta</span><span class="hk">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">getDimensions</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">dimensions</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;integer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">getFlags</span><span class="hk">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span class="hd">$this</span><span class="hk">-&gt;</span><span class="hd">flags</span><span class="hk">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />}<br /></span>
</span>
</code>		</div>
		</div>
	</div>
		<div>
		<table>
		<tr class='light'>
			<td class="number"><small>100 %</small></td>
			<td><div class="bar"><div style="width: 100%"></div></div></td>
			<td><a href="#F16" class="toggle">ImageStore/File.php</a></td>
		</tr>
		</table>

		<div class="code" id="F16">
		<div>
			<aside>
			<div><a href='#F16L1' id='F16L1'>  1</a>
<a href='#F16L2' id='F16L2'>  2</a>
<a href='#F16L3' id='F16L3'>  3</a>
<a href='#F16L4' id='F16L4'>  4</a>
<a href='#F16L5' id='F16L5'>  5</a>
<a href='#F16L6' id='F16L6'>  6</a>
<a href='#F16L7' id='F16L7'>  7</a>
<a href='#F16L8' id='F16L8'>  8</a></div><div class='t'><a href='#F16L9' id='F16L9'>  9</a></div><div><a href='#F16L10' id='F16L10'> 10</a>
<a href='#F16L11' id='F16L11'> 11</a>
<a href='#F16L12' id='F16L12'> 12</a>
<a href='#F16L13' id='F16L13'> 13</a>
<a href='#F16L14' id='F16L14'> 14</a>
<a href='#F16L15' id='F16L15'> 15</a>
<a href='#F16L16' id='F16L16'> 16</a>
<a href='#F16L17' id='F16L17'> 17</a>
<a href='#F16L18' id='F16L18'> 18</a>
<a href='#F16L19' id='F16L19'> 19</a>
<a href='#F16L20' id='F16L20'> 20</a>
<a href='#F16L21' id='F16L21'> 21</a>
<a href='#F16L22' id='F16L22'> 22</a>
<a href='#F16L23' id='F16L23'> 23</a>
<a href='#F16L24' id='F16L24'> 24</a>
<a href='#F16L25' id='F16L25'> 25</a>
<a href='#F16L26' id='F16L26'> 26</a>
<a href='#F16L27' id='F16L27'> 27</a>
<a href='#F16L28' id='F16L28'> 28</a>
<a href='#F16L29' id='F16L29'> 29</a>
<a href='#F16L30' id='F16L30'> 30</a>
<a href='#F16L31' id='F16L31'> 31</a>
<a href='#F16L32' id='F16L32'> 32</a>
<a href='#F16L33' id='F16L33'> 33</a>
<a href='#F16L34' id='F16L34'> 34</a>
<a href='#F16L35' id='F16L35'> 35</a>
<a href='#F16L36' id='F16L36'> 36</a>
<a href='#F16L37' id='F16L37'> 37</a>
<a href='#F16L38' id='F16L38'> 38</a>
<a href='#F16L39' id='F16L39'> 39</a>
<a href='#F16L40' id='F16L40'> 40</a>
<a href='#F16L41' id='F16L41'> 41</a>
<a href='#F16L42' id='F16L42'> 42</a>
<a href='#F16L43' id='F16L43'> 43</a>
<a href='#F16L44' id='F16L44'> 44</a>
<a href='#F16L45' id='F16L45'> 45</a>
</div>			</aside>
			<code style='margin-left: 3em'><span class="hh">
<span class="hd">&lt;?php<br /><br /></span><span class="hk">namespace&nbsp;</span><span class="hd">Rostenkowski</span><span class="hk">\</span><span class="hd">ImageStore</span><span class="hk">;<br /><br /><br /></span><span class="hc">/**<br />&nbsp;*&nbsp;Image&nbsp;file&nbsp;interface<br />&nbsp;*/<br /></span><span class="hk">interface&nbsp;</span><span class="hd">File<br /></span><span class="hk">{<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;image&nbsp;filename.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">getName</span><span class="hk">();<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;image&nbsp;type.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;integer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">getType</span><span class="hk">();<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Sets&nbsp;the&nbsp;image&nbsp;filename.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;$name<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">setName</span><span class="hk">(</span><span class="hd">$name</span><span class="hk">);<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hc">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Sets&nbsp;the&nbsp;image&nbsp;type.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;integer&nbsp;$type<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hk">public&nbsp;function&nbsp;</span><span class="hd">setType</span><span class="hk">(</span><span class="hd">$type</span><span class="hk">);<br /><br /><br />}<br /></span>
</span>
</code>		</div>
		</div>
	</div>
	
	<footer>
		<p>Generated by <a href="https://tester.nette.org">Nette Tester</a> at 2016/05/08 11:48:16</p>
	</footer>

	<script>
	document.body.addEventListener('click', function (e) {
		if (e.target.className === 'toggle') {
			var el = document.getElementById(e.target.href.split('#')[1]);
			if (el.style.display === 'block') {
				el.style.display = 'none';
			} else {
				el.style.display = 'block';
			}
			e.preventDefault();
		}
	});

	if (el = document.getElementById(window.location.hash.replace(/^#|L\d+$/g, ''))) {
		el.style.display = 'block';
	}
	</script>
</body>
</html>
